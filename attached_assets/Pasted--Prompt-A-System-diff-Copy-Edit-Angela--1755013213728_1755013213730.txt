大模型 Prompt 构造器（核心，务必照此实现）
A) System（角色设定）
diff
Copy
Edit
你是“Angela”，专精“非劳务收入路径设计”的高级策略顾问。
原则：
- 只输出可执行的方案，不空话。每条方案都要能立刻行动。
- 明确“谁先动、动什么、怎么动”，提供最小可验证原型（MVP）。
- 严格区分【关键人物资源（需换取/打动）】与【外部资源（可直接动用）】的用法。
- 发现信息缺口时，提出【建议补齐的关键角色类型】与可行获取路径（去哪找、用什么话术）。
- 输出结构固定，字段齐全，便于前端渲染。
B) User（注入表单数据 + 知识库摘录）
css
Copy
Edit
【项目名称】{{project_name}}
【项目背景】{{project_description}}
【当前阶段】{{project_stage}}

【关键人物】（含角色、资源、动机）
{% for p in key_persons %}
- 人物：{{p.name}}｜角色：{{", ".join(p.roles)}}
  资源：{{", ".join(p.resources)}}
  动机标签（如何让TA高兴）：{{format_make_happy(p.make_happy)}}
  备注：{{p.notes}}
{% endfor %}

【外部资源（可直接使用的资源池）】
{{format_external_resources(external_resources)}}

【知识库要点】（只给要点，避免冗长）
{{kb_snippets}}
C) Assistant（要求输出固定结构）
javascript
Copy
Edit
请输出 JSON，字段与格式严格如下：
{
  "overview": {
    "situation": "当前已掌握资源与限制的总结（<=120字）",
    "gaps": ["缺少的关键角色或环节1","..."],
    "suggested_roles_to_hunt": [
      {"role":"渠道方/推广方","why":"理由","where_to_find":"去哪里找","outreach_script":"简短话术（<=80字）"}
    ]
  },
  "paths": [
    {
      "id": "path_1",
      "name": "路径名（<=16字）",
      "scene": "在哪个场景/媒介下操作（如：微信群直播/线下小沙龙/联名推文）",
      "who_moves_first": "由谁先出手（如：你先约KOL/先找品牌运营）",
      "action_steps": [
        {"owner":"你","step":"做什么动作（具体到渠道/频次/形式）","why_it_works":"满足谁的动机/资源如何串联"},
        {"owner":"关键人物A","step":"做什么","why_it_works":"..."}
      ],
      "use_key_person_resources": ["引用到的人与其具体资源清单..."],
      "use_external_resources": ["直接动用的外部资源..."],
      "revenue_trigger": "非劳务收益触发点（如分成/倒流/授权/转介绍）",
      "mvp": "一天内可完成的最小验证动作（含成功判据，如报名数≥30/转化≥2%）",
      "risks": ["风险点1","风险点2"],
      "plan_b": "最关键风险的替代方案（具体）",
      "kpis": ["行动KPI1","KPI2（含口径）"]
    }
  ],
  "notes": "补充建议（可为空）"
}
注意：
- 最多返回3条路径，少而精。
- 每个 action_steps 至少3步，尽量具体到“在哪个平台、用什么形式、频率多少”。
- 用项目现有资源优先，其次才建议补齐角色。
🖥️ 结果页 UI/交互规范
1) 顶部区
项目名 + 简短“局势总结”（overview.situation）

缺口胶囊（overview.gaps）+「去找人」按钮（展开 suggested_roles_to_hunt 列表，含“去哪找+话术”）

2) 路径卡片（1–3 组）
卡片结构（逐条渲染 paths[]）：

标题：name + 标签：场景（scene）/ 收益触发（revenue_trigger）

动作时间线（action_steps）：按顺序渲染，显示owner徽标（你/某人物/外部）

资源使用：分两栏

使用关键人物资源（高亮人物名与资源）

使用外部资源（chip 样式）

MVP：以强调框展示 + “一键生成待办”按钮（写入本地或导出）

风险 & Plan B：折叠展开

KPI：列表+口径说明

3) 侧栏操作（固定）
[🔁 细化此路径]（调用/refine，传selected_path_id与增量条件）

[➕ 补充关键人物]（弹窗：快速添加1人卡片 → 回传 /refine）

[📝 生成私信/邀请话术]（从suggested_roles_to_hunt[].outreach_script快速合成 3 条）

[⬇️ 导出]：MD / PDF / JSON

4) 加载与异常
骨架屏（3张卡片骨架）+ 进度条（阶段：解析 → 检索 → 生成 → 结构化）

失败提示：可“重试/降级为仅本地规则生成/反馈日志ID”

超时策略：30s 超时降级（不查KB仅按表单生成），显式标注“降级”徽章

🧪 前端数据示例（LLM返回）
json
Copy
Edit
{
  "overview": {
    "situation": "已有人物A（渠道）与人物B（内容），缺品牌买单侧与场地；外部有行业协会与媒体位可用。",
    "gaps": ["需求方/采购方","线下场地","赞助预算"],
    "suggested_roles_to_hunt": [
      {"role":"需求方/采购方","why":"形成闭环变现","where_to_find":"行业协会企业会员名录","outreach_script":"我们有KOL+社群+媒体位，可做低成本试跑，您仅提供试用名额与抽成，风险可控。"}
    ]
  },
  "paths": [
    {
      "id": "path_1",
      "name": "社群测款联动",
      "scene": "微信群直播+视频号预热",
      "who_moves_first": "你先对接A总（渠道）敲定直播档期",
      "action_steps": [
        {"owner":"你","step":"与A总确定直播主题与嘉宾，输出大纲与分工","why_it_works":"满足A总‘主导/不当工具人’动机"},
        {"owner":"人物B","step":"预录3段短视频做内容预热","why_it_works":"满足B‘打造人设/曝光圈层’"},
        {"owner":"你","step":"向行业协会申请群内转发权限与媒体位","why_it_works":"外部资源直接可用，扩大触达"},
        {"owner":"A总","step":"直播当日私域引流与群内抽奖","why_it_works":"触发粉丝活跃与留资"},
        {"owner":"你","step":"对接产品方配置专属链接与抽成","why_it_works":"形成非劳务分成收益"}
      ],
      "use_key_person_resources": ["A总：视频号8万粉、社群2个","B：内容制作团队"],
      "use_external_resources": ["行业协会媒体位","媒体专栏推荐"],
      "revenue_trigger": "专属链接分成+后续转介绍返佣",
      "mvp": "一场私域直播+短链统计，报名≥50且点击转化≥2%",
      "risks": ["KOL不愿硬带货","群活跃不足"],
      "plan_b": "改为‘主题内容联名+试用券’软转化，次日推文接力",
      "kpis": ["报名数/观看数/点击率/转化率","新增线索成本（=投放/报名）"]
    }
  ],
  "notes": ""
}
🧩 细化接口 /refine 规则
入参：

json
Copy
Edit
{
  "selected_path_id": "path_1",
  "add_personas": [
    {"role":"product","resources":["试用码100个","API授权14天"],"make_happy":["brand_exposure","share_revenue"]}
  ],
  "constraints": "预算0；两周内必须验证；不允许硬广",
  "tweaks": "更偏向B端线索，不要C端售卖"
}
输出：与 /generate 相同结构，仅返回被细化路径的更新版本（保留原ID）。

⬇️ 导出规则
MD：按卡片顺序输出，附带 KPI 表格与行动清单（Task list）

PDF：A4，卡片分隔，自动分页，含页眉项目名与生成时间

JSON：直接回传 LLM 结果（含版本号与生成时间）

✅ 验收标准（DoD）
 /generate 能在 10–20s 内返回结构化 JSON，字段齐全，1–3 条路径。

 结果页按规范渲染：概览 + 缺口 + 路径卡片 + MVP/KPI/PlanB。

 “去找人”面板包含：建议角色、理由、去哪找、外联话术。

 “细化此路径”可提交增量信息并刷新该卡片。

 导出 MD/PDF/JSON 可用。

 失败/超时有降级与重试；日志含 traceId。

 前端与后端字段命名与本规范一致，便于持续集成。

🧷 实现提示
LLM 提示长度控制：表单数据与 KB 片段总字数 ≤ 4k tokens；超出时先做摘要。

KB 检索：基于关键词（角色、资源、场景词）+ BM25/向量混合，返回 3–6 条短要点（不回整篇）。

评分去重：若两条路径scene与核心资源 70% 相似，保留得分更高者。

时间口径：KPI 口径写清楚（分母分子），MVP 判据必须可测量。