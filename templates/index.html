<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angela · 非劳务收入管道设计师</title>
    
    <!-- 预加载关键字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/elegant-light.css') }}" rel="stylesheet">
    
    <!-- 性能优化: 预加载关键资源 -->
    <link rel="prefetch" href="{{ url_for('static', filename='js/form.js') }}">
    
    <!-- 性能优化: 初始页面加载时禁用动画 -->
    <style>
        .preload * {
            -webkit-transition: none !important;
            -moz-transition: none !important;
            -ms-transition: none !important;
            -o-transition: none !important;
            transition: none !important;
        }
    </style>
    
    <!-- SEO 优化 -->
    <meta name="description" content="Angela - 顶级AI驱动的非劳务收入管道设计工具，智能生成创新收入方案">
    <meta name="keywords" content="AI收入设计,非劳务收入,智能管道,商业策略">
</head>
<body class="preload">
    <!-- 清新优雅主标题区域 -->
    <div class="main-title fade-in-up">
        <div class="container position-relative">
            <h1><i class="fas fa-brain me-3"></i>Angela</h1>
            <p>非劳务收入管道设计师 · 智能创新解决方案</p>
            
            <!-- 历史记录链接 -->
            <div class="position-absolute top-0 end-0 mt-3">
                <a href="{{ url_for('analysis_history') }}" class="btn btn-outline-light btn-sm" style="border-radius: 20px; backdrop-filter: blur(10px); background: rgba(255,255,255,0.1);">
                    <i class="fas fa-history me-2"></i>历史记录
                </a>
            </div>
        </div>
    </div>

    <div class="container">

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'info' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('generate') }}" id="mainForm">
            <!-- Module A: Project Basic Information -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-rocket me-2"></i>项目基础信息
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="project_name" class="form-label">项目名称 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="project_name" name="project_name" required 
                                   placeholder="请输入项目名称">
                        </div>
                        <div class="col-md-6">
                            <label for="project_stage" class="form-label">当前阶段</label>
                            <select class="form-select" id="project_stage" name="project_stage">
                                <option value="">选择项目阶段</option>
                                <option value="初步接触">初步接触</option>
                                <option value="认识关键人但未推动">认识关键人但未推动</option>
                                <option value="资源具备，等待设计整合">资源具备，等待设计整合</option>
                                <option value="项目已启动部分内容">项目已启动部分内容</option>
                                <option value="项目进入执行阶段">项目进入执行阶段</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label for="project_description" class="form-label">项目背景描述 <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="project_description" name="project_description" rows="4" required
                                      placeholder="请详细描述项目背景、现状和目标"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module B: Key Persons Cards -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-users-gear me-2"></i>关键人物清单
                    </h3>
                </div>
                <div class="card-body">
                    <div id="personsContainer">
                        <!-- Person cards will be added here dynamically -->
                    </div>
                    <div class="text-muted mb-3" id="noPersonsMsg">
                        <i class="fas fa-info-circle me-2"></i>点击下方按钮开始添加项目相关的重要人员
                    </div>
                    <!-- 添加关键人物按钮 - 固定在模块底部 -->
                    <div class="text-center">
                        <button type="button" class="btn btn-primary" id="addPersonBtn" style="border-radius: 20px; padding: 10px 24px;">
                            <i class="fas fa-plus me-2"></i>添加关键人物
                        </button>
                    </div>
                </div>
            </div>

            <!-- Module C: External Resources -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-layer-group me-2"></i>可用资源配置
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">您还有哪些外部资源可以用在这个项目里的？（可选）</p>
                    <div class="row g-2" id="resourceTags">
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource1" name="external_resources" value="自媒体资源">
                            <label class="btn btn-outline-secondary btn-sm" for="resource1">自媒体资源</label>
                        </div>
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource2" name="external_resources" value="合作方产品">
                            <label class="btn btn-outline-secondary btn-sm" for="resource2">合作方产品</label>
                        </div>
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource3" name="external_resources" value="渠道入口">
                            <label class="btn btn-outline-secondary btn-sm" for="resource3">渠道入口</label>
                        </div>
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource4" name="external_resources" value="顾问背书">
                            <label class="btn btn-outline-secondary btn-sm" for="resource4">顾问背书</label>
                        </div>
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource5" name="external_resources" value="内容产能">
                            <label class="btn btn-outline-secondary btn-sm" for="resource5">内容产能</label>
                        </div>
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource6" name="external_resources" value="分发账号">
                            <label class="btn btn-outline-secondary btn-sm" for="resource6">分发账号</label>
                        </div>
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource7" name="external_resources" value="SaaS 工具">
                            <label class="btn btn-outline-secondary btn-sm" for="resource7">SaaS 工具</label>
                        </div>
                        <div class="col-auto">
                            <input type="checkbox" class="btn-check" id="resource8" name="other_resource_checkbox">
                            <label class="btn btn-outline-secondary btn-sm" for="resource8">其他资源</label>
                        </div>
                    </div>
                    <!-- 其他资源输入框 -->
                    <div class="mt-3" id="otherResourceInput" style="display: none;">
                        <label for="other_resource_text" class="form-label">请输入其他资源：</label>
                        <input type="text" class="form-control" id="other_resource_text" name="other_resource_text" 
                               placeholder="请输入您拥有的其他资源">
                    </div>
                </div>
            </div>

            <!-- 现代化提交按钮 -->
            <div class="text-center mt-5">
                <button type="submit" class="btn btn-primary btn-lg px-5 py-3" style="font-size: 1.2rem; border-radius: 20px; min-width: 280px; position: relative; overflow: hidden;">
                    <i class="fas fa-brain me-2"></i>
                    <span class="fw-bold">启动AI智能分析</span>
                </button>
                <p class="text-muted mt-3 small">我们的AI将在30秒内为您生成专业的收入管道方案</p>
            </div>
        </form>
    </div>

    <!-- Person Card Template (Hidden) -->
    <template id="personCardTemplate">
        <div class="person-card mb-4 position-relative">
            <button type="button" class="btn-remove position-absolute top-0 end-0 m-3 remove-person-btn" title="移除此人物">
                <i class="fas fa-times"></i>
            </button>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">人物代号/姓名</label>
                    <input type="text" class="form-control" name="person_name[]" placeholder="例如：A总">
                </div>
                <div class="col-md-6">
                    <label class="form-label">身份角色</label>
                    <select class="form-select" name="person_role[]">
                        <option value="">选择身份角色</option>
                        <option value="品牌方代表">品牌方代表</option>
                        <option value="投资方（或投资人）">投资方（或投资人）</option>
                        <option value="渠道资源持有者">渠道资源持有者</option>
                        <option value="平台运营方">平台运营方</option>
                        <option value="社群/流量掌控者">社群/流量掌控者</option>
                        <option value="IP/内容方">IP/内容方</option>
                        <option value="产品方">产品方</option>
                        <option value="外部专家顾问">外部专家顾问</option>
                    </select>
                </div>
                <div class="col-12">
                    <label class="form-label">掌握的资源</label>
                    <input type="text" class="form-control" name="person_resources[]" 
                           placeholder="请用逗号分隔多个资源，例如：品牌内容资源,产品分销权限">
                </div>
                <div class="col-12">
                    <label class="form-label">如何让此人开心（需求/痛点）</label>
                    <div class="needs-selection-container">
                        <!-- 默认显示的前两个分类 -->
                        <div class="needs-visible-section">
                            <!-- 结果回报 -->
                            <div class="tag-group mb-3">
                                <h6 class="text-primary mb-2"><span class="badge bg-primary me-2">🔵</span>想看到回报 / 实际效果</h6>
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="拿到分成" id="need_profit_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_profit_${personId}">拿到分成</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="带来客户" id="need_customers_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_customers_${personId}">带来客户</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="尽快落地" id="need_fast_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_fast_${personId}">项目尽快落地</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="持续收益" id="need_sustainable_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_sustainable_${personId}">能长期持续赚钱</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 曝光影响 -->
                            <div class="tag-group mb-3">
                                <h6 class="text-success mb-2"><span class="badge bg-success me-2">🟢</span>想被看见 / 被宣传</h6>
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="品牌曝光" id="need_exposure_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_exposure_${personId}">有品牌曝光</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="打造人设" id="need_persona_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_persona_${personId}">打造人设 / 专家身份</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="圈层精准" id="need_precise_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_precise_${personId}">曝光圈子精准</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="成为发起人" id="need_leader_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_leader_${personId}">项目以他为主导</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 展开时显示的其他分类 -->
                        <div class="needs-expandable-section" style="display: none;">
                            <!-- 主导控制 -->
                            <div class="tag-group mb-3">
                                <h6 class="text-warning mb-2"><span class="badge bg-warning me-2">🟡</span>想主导项目 / 有话语权</h6>
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="自己决定节奏" id="need_pace_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_pace_${personId}">自己决定节奏</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="不想被工具化" id="need_not_tool_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_not_tool_${personId}">不想只是资源人</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="决定合作人" id="need_choose_partner_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_choose_partner_${personId}">想决定和谁合作</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="想策划包装" id="need_planning_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_planning_${personId}">想参与内容策划</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 风险规避 -->
                            <div class="tag-group mb-3">
                                <h6 class="text-danger mb-2"><span class="badge bg-danger me-2">🟠</span>不想冒风险</h6>
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="不担责" id="need_no_risk_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_no_risk_${personId}">不出钱不担责</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="不公开露脸" id="need_no_public_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_no_public_${personId}">不公开露脸</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="避开冲突" id="need_avoid_conflict_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_avoid_conflict_${personId}">不影响已有合作方</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="信息保密" id="need_confidential_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_confidential_${personId}">希望信息保密</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 被尊重 -->
                            <div class="tag-group mb-3">
                                <h6 class="text-info mb-2"><span class="badge bg-info me-2">🔴</span>想被尊重 / 有地位</h6>
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="成为顾问" id="need_advisor_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_advisor_${personId}">成为顾问/专家</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="体现价值" id="need_valuable_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_valuable_${personId}">体现出他很重要</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="圈子有地位" id="need_status_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_status_${personId}">提升圈子里的地位</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="自己组的局" id="need_own_game_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_own_game_${personId}">像是他发起的局</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 人脉情绪 -->
                            <div class="tag-group mb-3">
                                <h6 class="text-dark mb-2"><span class="badge bg-dark me-2">🟣</span>在乎人脉 / 感受</h6>
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="拓展人脉" id="need_network_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_network_${personId}">拓展人脉</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="有参与感" id="need_involvement_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_involvement_${personId}">有参与感 / 成就感</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="能当谈资" id="need_talking_point_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_talking_point_${personId}">项目能当谈资</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="checkbox" class="btn-check" name="person_needs[]" value="被邀请的感觉" id="need_invited_${personId}">
                                        <label class="btn btn-outline-secondary btn-sm" for="need_invited_${personId}">有被邀请的感觉</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 其他自定义 -->
                            <div class="tag-group">
                                <h6 class="text-muted mb-2"><span class="badge bg-secondary me-2">✍️</span>其他（可补充描述）</h6>
                                <textarea class="form-control" name="person_needs_extra[]" rows="2" 
                                          placeholder="还有什么特别的点会让他愿意参与？比如：老板刚批预算，或者最近想冲数据..."></textarea>
                            </div>
                        </div>

                        <!-- 展开/收起按钮 -->
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-outline-secondary btn-sm expand-toggle-btn">
                                <i class="fas fa-angle-down me-1"></i>展开更多选项
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/form.js') }}"></script>
    
    <!-- 性能优化: 页面加载完成后启用动画 -->
    <script>
        window.addEventListener('load', function() {
            // 移除预加载类以启用动画
            document.body.classList.remove('preload');
            
            // 检测低性能设备并调整
            if (navigator.hardwareConcurrency <= 2 || window.innerWidth <= 768) {
                document.body.classList.add('low-performance');
            }
            
            // 检测用户是否喜欢减少动画
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.body.classList.add('reduce-motion');
            }
        });
        
        // 优化滚动性能
        let isScrolling = false;
        window.addEventListener('scroll', function() {
            if (!isScrolling) {
                window.requestAnimationFrame(function() {
                    // 在这里处理滚动相关的操作
                    isScrolling = false;
                });
                isScrolling = true;
            }
        });
    </script>
</body>
</html>
