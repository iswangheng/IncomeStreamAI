<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI收入路径设计方案 - Angela AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/apple-design-system.css') }}" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Apple级别结果展示页面样式 */
        :root {
            --page-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --accent-gradient: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--page-bg);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* 导航栏样式 */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-6);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: rgba(0, 122, 255, 0.1);
            color: var(--color-primary);
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-weight: var(--font-medium);
            font-size: var(--text-sm);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 122, 255, 0.2);
        }

        .back-btn:hover {
            background: rgba(0, 122, 255, 0.15);
            color: var(--color-primary-dark);
            text-decoration: none;
            transform: translateX(-2px);
        }

        .navbar-brand {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            text-decoration: none;
        }

        .navbar-brand:hover {
            color: var(--color-primary);
            text-decoration: none;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .navbar-action {
            padding: var(--space-2) var(--space-3);
            background: transparent;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .navbar-action:hover {
            background: var(--color-gray-100);
            color: var(--color-text-primary);
            text-decoration: none;
        }

        /* 为主内容添加顶部间距避免被导航栏遮挡 */
        .result-page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: calc(60px + var(--space-8)) var(--space-4) var(--space-8);
            min-height: 100vh;
        }

        /* 主容器 - 已移动到导航栏样式部分 */

        /* 页面头部 */
        .result-hero {
            text-align: center;
            margin-bottom: var(--space-12);
            padding: var(--space-8) 0;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-full);
            padding: var(--space-2) var(--space-4);
            margin-bottom: var(--space-4);
            backdrop-filter: blur(20px);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--color-primary);
        }

        .hero-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            color: white;
            margin-bottom: var(--space-3);
            line-height: 1.2;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
        }

        .hero-subtitle {
            font-size: var(--text-xl);
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: var(--space-8);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        /* 卡片系统 */
        .glass-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-6);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-xl);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        /* 概览卡片 */
        .overview-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .overview-title {
            display: flex;
            align-items: center;
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-6);
            color: white;
        }

        .overview-title i {
            margin-right: var(--space-3);
            padding: var(--space-2);
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
        }

        .situation-text {
            font-size: var(--text-lg);
            line-height: 1.7;
            margin-bottom: var(--space-6);
            color: rgba(255, 255, 255, 0.95);
        }

        /* 差距标签 */
        .gaps-container {
            margin-bottom: var(--space-6);
        }

        .gaps-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-4);
            color: rgba(255, 255, 255, 0.9);
        }

        .gap-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-3);
        }

        .gap-tag {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* 路径卡片 */
        .path-card {
            position: relative;
            overflow: hidden;
        }

        .path-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
        }

        .path-number {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            color: white;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-bold);
            font-size: var(--text-lg);
        }

        .path-title {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            margin: 0;
            flex: 1;
            margin-left: var(--space-4);
        }

        .path-scene {
            background: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
        }

        /* 行动步骤 */
        .action-steps {
            margin: var(--space-6) 0;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--space-4);
            padding: var(--space-4);
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--color-primary);
        }

        .step-owner {
            min-width: 80px;
            font-weight: var(--font-semibold);
            color: var(--color-primary);
            margin-right: var(--space-4);
        }

        .step-content {
            flex: 1;
        }

        .step-action {
            font-size: var(--text-base);
            color: var(--color-text-primary);
            line-height: 1.6;
        }



        /* MVP区域 */
        .mvp-section {
            background: linear-gradient(135deg, var(--color-success), #28a745);
            color: white;
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            margin: var(--space-6) 0;
        }

        .mvp-title {
            display: flex;
            align-items: center;
            font-weight: var(--font-bold);
            margin-bottom: var(--space-3);
        }

        .mvp-title i {
            margin-right: var(--space-2);
        }

        /* 资源和风险 */
        .resources-risks {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
            margin: var(--space-6) 0;
        }

        @media (max-width: 768px) {
            .resources-risks {
                grid-template-columns: 1fr;
            }
        }

        .info-section {
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-gray-200);
        }

        .info-title {
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-3);
        }

        .info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-list li {
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--color-gray-100);
            color: var(--color-text-secondary);
        }

        .info-list li:last-child {
            border-bottom: none;
        }

        /* 操作按钮 */
        .action-buttons {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
            margin-top: var(--space-12);
            flex-wrap: wrap;
        }

        .action-btn {
            padding: var(--space-4) var(--space-8);
            border-radius: var(--radius-xl);
            font-weight: var(--font-semibold);
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .btn-primary-custom {
            background: var(--accent-gradient);
            color: white;
            border: none;
        }

        .btn-secondary-custom {
            background: var(--glass-bg);
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* 动画效果 */
        .fade-in-up {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-delay-1 { animation-delay: 0.1s; }
        .animate-delay-2 { animation-delay: 0.2s; }
        .animate-delay-3 { animation-delay: 0.3s; }
        .animate-delay-4 { animation-delay: 0.4s; }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .result-page-container {
                padding: calc(60px + var(--space-4)) var(--space-3) var(--space-4);
            }
            
            .navbar {
                padding: 0 var(--space-3);
            }
            
            .navbar-brand {
                font-size: var(--text-base);
            }
            
            .glass-card {
                padding: var(--space-6);
            }
            
            .path-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-4);
            }
            
            .path-title {
                margin-left: 0;
            }
        }

        /* 分享模态框样式 */
        .share-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .share-overlay.show {
            opacity: 1;
        }

        .share-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            min-width: 400px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            z-index: 1001;
            display: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .share-modal.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .share-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            border-bottom: 1px solid var(--color-gray-200);
            padding-bottom: var(--space-4);
        }

        .share-title {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: var(--text-xl);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-lg);
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--color-gray-100);
            color: var(--color-text-primary);
        }

        .share-options {
            display: grid;
            gap: var(--space-4);
        }

        .share-section {
            margin-bottom: var(--space-6);
        }

        .section-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-4);
        }

        .copy-link-section {
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
        }

        .copy-link-btn {
            width: 100%;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            padding: var(--space-3) var(--space-4);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .copy-link-btn:hover {
            background: var(--color-primary-dark);
            transform: translateY(-1px);
        }

        .social-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-3);
        }

        .social-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-4);
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-lg);
            background: white;
            text-decoration: none;
            color: var(--color-text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--color-primary);
        }

        .social-icon {
            width: 32px;
            height: 32px;
            margin-bottom: var(--space-2);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wechat { color: #07C160; }
        .weibo { color: #E6162D; }
        .qq { color: #12B7F5; }
        .qzone { color: #FCCA03; }

        .wechat-qr {
            display: none;
            background: white;
            border-radius: var(--radius-lg);
            margin-top: var(--space-4);
        }

        /* 骨架屏样式 */
        .skeleton-container {
            padding-top: 80px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .thinking-header {
            text-align: center;
            margin-bottom: var(--space-8);
            opacity: 0;
            animation: fadeInUp 1s ease-out forwards;
        }

        .ai-icon {
            font-size: 4rem;
            color: white;
            margin-bottom: var(--space-4);
            animation: pulse 2s ease-in-out infinite;
        }

        .thinking-title {
            font-size: var(--text-4xl);
            font-weight: var(--font-bold);
            color: white;
            margin-bottom: var(--space-2);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .thinking-subtitle {
            font-size: var(--text-lg);
            color: rgba(255, 255, 255, 0.9);
            font-weight: var(--font-medium);
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
        }

        .skeleton-cards {
            max-width: 800px;
            width: 100%;
            padding: 0 var(--space-4);
            opacity: 0;
            animation: fadeInUp 1s ease-out 0.5s forwards;
        }

        .skeleton-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: var(--space-6);
            margin-bottom: var(--space-4);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .skeleton-header {
            display: flex;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .skeleton-icon {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            margin-right: var(--space-3);
            animation: shimmer 2s ease-in-out infinite;
        }

        .skeleton-title {
            height: 20px;
            width: 200px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            animation: shimmer 2s ease-in-out infinite;
        }

        .skeleton-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .skeleton-line {
            height: 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            animation: shimmer 2s ease-in-out infinite;
        }

        .skeleton-line:nth-child(1) { width: 100%; }
        .skeleton-line:nth-child(2) { width: 80%; }
        .skeleton-line:nth-child(3) { width: 60%; }

        .progress-indicator {
            margin-top: var(--space-6);
            text-align: center;
            padding: var(--space-4);
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
        }

        .progress-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: var(--text-sm);
            margin-bottom: var(--space-2);
        }

        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, white, rgba(255, 255, 255, 0.8));
            border-radius: 2px;
            width: 0%;
            transition: width 0.8s ease-out;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 20px;
            height: 100%;
            background: linear-gradient(90deg, transparent, white);
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        @keyframes shimmer {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* 错误状态样式 */
        .error-container {
            padding-top: 80px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .error-icon {
            font-size: 4rem;
            color: #ff6b6b;
            margin-bottom: var(--space-4);
        }

        .error-title {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            color: white;
            margin-bottom: var(--space-2);
        }

        .error-message {
            font-size: var(--text-lg);
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: var(--space-6);
            max-width: 500px;
        }

        .retry-btn {
            padding: var(--space-3) var(--space-6);
            background: var(--color-primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-weight: var(--font-medium);
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            background: var(--color-primary-dark);
            color: white;
            text-decoration: none;
            transform: translateY(-2px);
        }

        @media (max-width: 640px) {
            .share-modal {
                min-width: 0;
                width: 90%;
                padding: var(--space-6);
            }
            
            .social-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .skeleton-cards {
                padding: 0 var(--space-2);
            }

            .thinking-title {
                font-size: var(--text-2xl);
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="navbar-left">
            <a href="/" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                <span>重新设计方案</span>
            </a>
            <a href="/" class="navbar-brand">Angela AI</a>
        </div>
        <div class="navbar-right">
            <a href="/admin" class="navbar-action">
                <i class="fas fa-cog me-1"></i>
                管理后台
            </a>
        </div>
    </nav>

    {% if status == 'loading' %}
    <!-- 加载状态：显示骨架屏 -->
    <div class="skeleton-container">
        <div class="thinking-header">
            <div class="ai-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h1 class="thinking-title">Angela AI正在为您定制方案</h1>
            <p class="thinking-subtitle">正在深度分析您的项目信息，生成个性化收入路径方案...</p>
        </div>

        <div class="skeleton-cards">
            <!-- 项目概览骨架 -->
            <div class="skeleton-card">
                <div class="skeleton-header">
                    <div class="skeleton-icon"></div>
                    <div class="skeleton-title"></div>
                </div>
                <div class="skeleton-content">
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                </div>
            </div>

            <!-- 路径方案骨架 -->
            <div class="skeleton-card">
                <div class="skeleton-header">
                    <div class="skeleton-icon"></div>
                    <div class="skeleton-title"></div>
                </div>
                <div class="skeleton-content">
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                </div>
            </div>

            <div class="skeleton-card">
                <div class="skeleton-header">
                    <div class="skeleton-icon"></div>
                    <div class="skeleton-title"></div>
                </div>
                <div class="skeleton-content">
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                </div>
            </div>

            <!-- 进度指示器 -->
            <div class="progress-indicator">
                <div class="progress-text" id="progressText">Angela AI正在智能分析中...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </div>

    {% elif status == 'error' %}
    <!-- 错误状态 -->
    <div class="error-container">
        <div class="error-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h1 class="error-title">分析遇到问题</h1>
        <p class="error-message">{{ error_message or '分析过程中发生错误，请稍后重试' }}</p>
        <a href="/" class="retry-btn">
            <i class="fas fa-redo me-2"></i>
            重新开始
        </a>
    </div>

    {% else %}
    <!-- 完成状态：显示完整结果 -->

    <div class="result-page-container">
        <!-- 页面头部 -->
        <div class="result-hero fade-in-up">
            <div class="hero-badge">
                <i class="fas fa-magic me-2"></i>
                AI智能分析完成
            </div>
            <h1 class="hero-title">非劳务收入路径设计方案</h1>
            <p class="hero-subtitle">基于您提供的项目信息和关键人物资源，我们为您生成了专业的收入管道设计方案</p>
        </div>

        <!-- 概览卡片 -->
        <div class="glass-card overview-card fade-in-up animate-delay-1">
            <h2 class="overview-title">
                <i class="fas fa-chart-line"></i>
                项目概览与分析
            </h2>
            <div class="situation-text">
                {{ result.overview.situation if result and result.overview else "当前已掌握资源集中在关键人物的渠道和影响力，需要进一步整合变现路径。" }}
            </div>
            
            {% if result and result.overview and result.overview.gaps %}
            <div class="gaps-container">
                <div class="gaps-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    需要补齐的关键环节
                </div>
                <div class="gap-tags">
                    {% for gap in result.overview.gaps %}
                    <span class="gap-tag">{{ gap }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- 路径方案 -->
        {% if result and result.paths %}
        {% for path in result.paths %}
        <div class="glass-card path-card fade-in-up animate-delay-{{ loop.index + 1 }}">
            <div class="path-header">
                <div style="display: flex; align-items: center;">
                    <div class="path-number">{{ loop.index }}</div>
                    <h3 class="path-title">{{ path.name }}</h3>
                </div>
                <div class="path-scene">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    {{ path.scene }}
                </div>
            </div>

            <!-- 执行顺序 -->
            <div style="margin-bottom: var(--space-6);">
                <div style="display: flex; align-items: center; margin-bottom: var(--space-3);">
                    <i class="fas fa-play-circle" style="color: var(--color-primary); margin-right: var(--space-2);"></i>
                    <strong>启动策略：</strong>
                </div>
                <div style="color: var(--color-text-secondary); font-size: var(--text-lg);">
                    {{ path.who_moves_first }}
                </div>
            </div>

            <!-- 行动步骤 -->
            <div class="action-steps">
                <h4 style="display: flex; align-items: center; margin-bottom: var(--space-4);">
                    <i class="fas fa-list-ol me-2"></i>
                    执行步骤
                </h4>
                {% for step in path.action_steps %}
                <div class="step-item">
                    <div class="step-owner">{{ step.owner }}</div>
                    <div class="step-content">
                        <div class="step-action">{{ step.step }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- MVP验证 -->
            {% if path.mvp %}
            <div class="mvp-section">
                <div class="mvp-title">
                    <i class="fas fa-rocket"></i>
                    最小可验证原型 (MVP)
                </div>
                <div>{{ path.mvp }}</div>
            </div>
            {% endif %}

            <!-- 资源使用和风险管理 -->
            <div class="resources-risks">
                <div class="info-section">
                    <div class="info-title">
                        <i class="fas fa-users me-2"></i>
                        关键人物资源
                    </div>
                    <ul class="info-list">
                        {% for resource in path.use_key_person_resources %}
                        <li>{{ resource }}</li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="info-section">
                    <div class="info-title">
                        <i class="fas fa-shield-alt me-2"></i>
                        风险与应对
                    </div>
                    <ul class="info-list">
                        {% for risk in path.risks %}
                        <li>{{ risk }}</li>
                        {% endfor %}
                        {% if path.plan_b %}
                        <li><strong>备选方案：</strong>{{ path.plan_b }}</li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <!-- 收益触发点 -->
            {% if path.revenue_trigger %}
            <div style="background: linear-gradient(135deg, var(--color-accent), #ff7043); color: white; padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-4);">
                <div style="display: flex; align-items: center; font-weight: var(--font-semibold);">
                    <i class="fas fa-coins me-2"></i>
                    收益触发点
                </div>
                <div style="margin-top: var(--space-2);">{{ path.revenue_trigger }}</div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
        {% else %}
        <!-- 示例数据展示 -->
        <div class="glass-card path-card fade-in-up animate-delay-2">
            <div class="path-header">
                <div style="display: flex; align-items: center;">
                    <div class="path-number">1</div>
                    <h3 class="path-title">视频号带货分成</h3>
                </div>
                <div class="path-scene">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    通过张三的视频号进行商品推广
                </div>
            </div>

            <div style="margin-bottom: var(--space-6);">
                <div style="display: flex; align-items: center; margin-bottom: var(--space-3);">
                    <i class="fas fa-play-circle" style="color: var(--color-primary); margin-right: var(--space-2);"></i>
                    <strong>启动策略：</strong>
                </div>
                <div style="color: var(--color-text-secondary); font-size: var(--text-lg);">
                    你先与张三对接分成模式
                </div>
            </div>

            <div class="action-steps">
                <h4 style="display: flex; align-items: center; margin-bottom: var(--space-4);">
                    <i class="fas fa-list-ol me-2"></i>
                    执行步骤
                </h4>
                <div class="step-item">
                    <div class="step-owner">你</div>
                    <div class="step-content">
                        <div class="step-action">联系张三，商讨视频号推广分成模式，确定商品类型和分成比例</div>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-owner">张三</div>
                    <div class="step-content">
                        <div class="step-action">发布带货视频内容（每周2条），并在视频中附带商品购买链接</div>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-owner">你</div>
                    <div class="step-content">
                        <div class="step-action">通过电商平台联系小商家，获取试用品或样品以备推广</div>
                    </div>
                </div>
            </div>

            <div class="mvp-section">
                <div class="mvp-title">
                    <i class="fas fa-rocket"></i>
                    最小可验证原型 (MVP)
                </div>
                <div>联系3个商家，成功完成至少1个商品推广视频并获得首批订单（目标≥10单）</div>
            </div>

            <div class="resources-risks">
                <div class="info-section">
                    <div class="info-title">
                        <i class="fas fa-users me-2"></i>
                        关键人物资源
                    </div>
                    <ul class="info-list">
                        <li>张三的视频号粉丝5万</li>
                        <li>张三的3个微信群</li>
                    </ul>
                </div>
                <div class="info-section">
                    <div class="info-title">
                        <i class="fas fa-shield-alt me-2"></i>
                        风险与应对
                    </div>
                    <ul class="info-list">
                        <li>商品质量不佳导致负面评价</li>
                        <li>视频号带货效果不理想</li>
                        <li><strong>备选方案：</strong>若商品效果不佳，改为推广虚拟商品或服务，如课程或会员卡</li>
                    </ul>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, var(--color-accent), #ff7043); color: white; padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-4);">
                <div style="display: flex; align-items: center; font-weight: var(--font-semibold);">
                    <i class="fas fa-coins me-2"></i>
                    收益触发点
                </div>
                <div style="margin-top: var(--space-2);">通过视频号带货产生销售分成</div>
            </div>
        </div>
        {% endif %}

        <!-- 操作按钮 -->
        <div class="action-buttons fade-in-up animate-delay-4">
            <button class="action-btn btn-primary-custom" onclick="exportToPDF()">
                <i class="fas fa-download"></i>
                导出PDF报告
            </button>
            <button class="action-btn btn-secondary-custom" onclick="shareResult()">
                <i class="fas fa-share-alt"></i>
                分享方案
            </button>
        </div>
    </div>

    <!-- 分享模态框 -->
    <div class="share-overlay" id="shareOverlay" onclick="hideShareModal()"></div>
    <div class="share-modal" id="shareModal">
        <div class="share-header">
            <h3 class="share-title">分享方案</h3>
            <button class="close-btn" onclick="hideShareModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="share-options">
            <!-- 复制链接 -->
            <div class="share-section">
                <div class="section-title">
                    <i class="fas fa-link me-2"></i>
                    复制链接
                </div>
                <div class="copy-link-section">
                    <button class="copy-link-btn" onclick="copyShareLink()">
                        <i class="fas fa-copy me-2"></i>
                        复制链接到剪贴板
                    </button>
                </div>
            </div>

            <!-- 社交媒体分享 -->
            <div class="share-section">
                <div class="section-title">
                    <i class="fas fa-share-alt me-2"></i>
                    社交媒体分享
                </div>
                <div class="social-buttons">
                    <div class="social-btn" onclick="shareToSocial('wechat')">
                        <div class="social-icon wechat">
                            <i class="fab fa-weixin"></i>
                        </div>
                        <span>微信</span>
                    </div>
                    <div class="social-btn" onclick="shareToSocial('weibo')">
                        <div class="social-icon weibo">
                            <i class="fab fa-weibo"></i>
                        </div>
                        <span>微博</span>
                    </div>
                    <div class="social-btn" onclick="shareToSocial('qq')">
                        <div class="social-icon qq">
                            <i class="fab fa-qq"></i>
                        </div>
                        <span>QQ</span>
                    </div>
                    <div class="social-btn" onclick="shareToSocial('qzone')">
                        <div class="social-icon qzone">
                            <i class="fas fa-star"></i>
                        </div>
                        <span>QQ空间</span>
                    </div>
                </div>
                
                <!-- 微信二维码区域 -->
                <div class="wechat-qr" id="wechatQR"></div>
            </div>
        </div>
    </div>

    {% endif %}

    <!-- JavaScript -->
    <script>
        // 状态轮询功能 - 仅在加载状态时运行
        {% if status == 'loading' %}
        let pollAttempts = 0;
        let maxPollAttempts = 60; // 最多轮询5分钟（每5秒一次）
        let progressValue = 10;

        function pollAnalysisStatus() {
            pollAttempts++;
            
            // 更新进度条和文本
            updateProgressDisplay();
            
            console.log(`Polling analysis status, attempt: ${pollAttempts}`);
            
            fetch('/check_analysis_status')
                .then(response => response.json())
                .then(data => {
                    console.log('Analysis status response:', data);
                    
                    if (data.status === 'completed') {
                        // 分析完成，刷新页面显示结果
                        updateProgress(100, '分析完成！正在加载结果...');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    } else if (data.status === 'error') {
                        // 分析出错，显示错误并停止轮询
                        updateProgress(0, '分析遇到错误，请刷新页面重试');
                        console.error('Analysis error:', data.message);
                        setTimeout(() => {
                            window.location.reload();
                        }, 3000);
                    } else if (pollAttempts >= maxPollAttempts) {
                        // 超时，显示错误信息
                        updateProgress(0, '分析超时，请刷新页面重试');
                        setTimeout(() => {
                            window.location.reload();
                        }, 3000);
                    } else {
                        // 继续轮询
                        setTimeout(pollAnalysisStatus, 3000); // 3秒后再次检查
                    }
                })
                .catch(error => {
                    console.error('Analysis status check failed:', error);
                    if (pollAttempts >= maxPollAttempts) {
                        updateProgress(0, '网络错误，请刷新页面重试');
                        setTimeout(() => {
                            window.location.reload();
                        }, 3000);
                    } else {
                        setTimeout(pollAnalysisStatus, 5000); // 出错时5秒后重试
                    }
                });
        }

        function updateProgressDisplay() {
            const progressMessages = [
                '正在收集项目信息...',
                '正在分析关键人物资源...',
                '正在查询知识库...',
                '正在生成收入路径...',
                '正在制定执行方案...',
                '正在整合分析结果...'
            ];
            
            // 根据轮询次数更新进度
            const messageIndex = Math.min(Math.floor(pollAttempts / 3), progressMessages.length - 1);
            const message = progressMessages[messageIndex];
            
            // 计算进度百分比（最大90%，留10%给最终完成）
            progressValue = Math.min(10 + (pollAttempts * 3), 90);
            
            updateProgress(progressValue, message);
        }

        function updateProgress(percent, message) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            if (progressFill) {
                progressFill.style.width = percent + '%';
            }
            
            if (progressText) {
                progressText.textContent = message;
            }
        }

        // 启动轮询
        document.addEventListener('DOMContentLoaded', function() {
            // 立即开始第一次轮询
            setTimeout(pollAnalysisStatus, 1000);
        });
        {% endif %}
        function exportToPDF() {
            // 显示导出进度
            const exportBtn = document.querySelector('.action-btn.btn-primary-custom');
            const originalText = exportBtn.innerHTML;
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>正在生成PDF...';
            exportBtn.disabled = true;

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // 设置字体和基本样式
                doc.setFont('helvetica');
                
                let yPos = 20;
                const pageWidth = 210; // A4宽度
                const margin = 20;
                const contentWidth = pageWidth - 2 * margin;
                
                // 标题
                doc.setFontSize(24);
                doc.setTextColor(0, 122, 255); // iOS蓝色
                doc.text('Angela AI - 非劳务收入路径设计方案', margin, yPos);
                yPos += 15;
                
                // 副标题
                doc.setFontSize(14);
                doc.setTextColor(109, 109, 112); // 灰色
                doc.text('基于AI智能分析生成的个性化收入管道设计', margin, yPos);
                yPos += 20;
                
                // 生成时间
                doc.setFontSize(10);
                doc.setTextColor(174, 174, 178);
                const currentDate = new Date().toLocaleString('zh-CN');
                doc.text(`生成时间: ${currentDate}`, margin, yPos);
                yPos += 15;
                
                // 分割线
                doc.setDrawColor(229, 229, 234);
                doc.line(margin, yPos, pageWidth - margin, yPos);
                yPos += 10;
                
                // 项目概览
                doc.setFontSize(16);
                doc.setTextColor(0, 0, 0);
                doc.text('项目概览与分析', margin, yPos);
                yPos += 10;
                
                doc.setFontSize(12);
                doc.setTextColor(60, 60, 60);
                
                // 获取概览内容
                const overviewText = document.querySelector('.situation-text')?.textContent || '当前已掌握资源集中在关键人物的渠道和影响力，需要进一步整合变现路径。';
                const splitText = doc.splitTextToSize(overviewText, contentWidth);
                doc.text(splitText, margin, yPos);
                yPos += splitText.length * 6 + 10;
                
                // 需要补齐的关键环节
                const gapTags = document.querySelectorAll('.gap-tag');
                if (gapTags.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(255, 59, 48); // 红色
                    doc.text('需要补齐的关键环节:', margin, yPos);
                    yPos += 8;
                    
                    doc.setFontSize(11);
                    doc.setTextColor(80, 80, 80);
                    gapTags.forEach((tag, index) => {
                        doc.text(`• ${tag.textContent}`, margin + 5, yPos);
                        yPos += 6;
                    });
                    yPos += 10;
                }
                
                // 收入路径方案
                const pathCards = document.querySelectorAll('.path-card');
                pathCards.forEach((card, index) => {
                    // 检查是否需要新页面
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    // 路径标题
                    doc.setFontSize(16);
                    doc.setTextColor(0, 122, 255);
                    const pathTitle = card.querySelector('.path-title')?.textContent || `路径方案 ${index + 1}`;
                    doc.text(`${index + 1}. ${pathTitle}`, margin, yPos);
                    yPos += 10;
                    
                    // 场景描述
                    doc.setFontSize(12);
                    doc.setTextColor(109, 109, 112);
                    const pathScene = card.querySelector('.path-scene')?.textContent || '';
                    if (pathScene) {
                        doc.text(`场景: ${pathScene}`, margin, yPos);
                        yPos += 8;
                    }
                    
                    // 启动策略
                    doc.setFontSize(11);
                    doc.setTextColor(0, 0, 0);
                    const whoMovesFirst = card.querySelector('div[style*="color: var(--color-text-secondary)"]')?.textContent || '';
                    if (whoMovesFirst) {
                        doc.text(`启动策略: ${whoMovesFirst}`, margin, yPos);
                        yPos += 8;
                    }
                    
                    // 执行步骤
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    doc.text('执行步骤:', margin, yPos);
                    yPos += 6;
                    
                    const stepItems = card.querySelectorAll('.step-item');
                    stepItems.forEach((step, stepIndex) => {
                        const owner = step.querySelector('.step-owner')?.textContent || '';
                        const action = step.querySelector('.step-action')?.textContent || '';
                        
                        doc.setFontSize(10);
                        doc.setTextColor(0, 122, 255);
                        doc.text(`${stepIndex + 1}. ${owner}:`, margin + 5, yPos);
                        yPos += 5;
                        
                        doc.setFontSize(10);
                        doc.setTextColor(60, 60, 60);
                        const actionText = doc.splitTextToSize(action, contentWidth - 10);
                        doc.text(actionText, margin + 10, yPos);
                        yPos += actionText.length * 4 + 2;
                    });
                    
                    // MVP验证
                    const mvpSection = card.querySelector('.mvp-section');
                    if (mvpSection) {
                        yPos += 5;
                        doc.setFontSize(12);
                        doc.setTextColor(52, 199, 89); // 绿色
                        doc.text('最小可验证原型 (MVP):', margin, yPos);
                        yPos += 6;
                        
                        doc.setFontSize(10);
                        doc.setTextColor(60, 60, 60);
                        const mvpText = mvpSection.textContent.replace('最小可验证原型 (MVP)', '').trim();
                        const mvpLines = doc.splitTextToSize(mvpText, contentWidth - 5);
                        doc.text(mvpLines, margin + 5, yPos);
                        yPos += mvpLines.length * 4 + 5;
                    }
                    
                    // 资源和风险
                    const resourcesSection = card.querySelector('.info-section .info-title');
                    if (resourcesSection && resourcesSection.textContent.includes('关键人物资源')) {
                        doc.setFontSize(11);
                        doc.setTextColor(0, 0, 0);
                        doc.text('关键人物资源:', margin, yPos);
                        yPos += 5;
                        
                        const resourceItems = card.querySelectorAll('.info-section .info-list li');
                        resourceItems.forEach(item => {
                            doc.setFontSize(9);
                            doc.setTextColor(80, 80, 80);
                            doc.text(`• ${item.textContent}`, margin + 5, yPos);
                            yPos += 4;
                        });
                        yPos += 5;
                    }
                    
                    yPos += 15; // 路径间距
                });
                
                // 页脚
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(174, 174, 178);
                    doc.text(`Angela AI 收入路径设计方案 - 第 ${i} 页，共 ${pageCount} 页`, margin, 287);
                    doc.text(`生成时间: ${currentDate}`, pageWidth - margin - 60, 287);
                }
                
                // 保存PDF
                const fileName = `Angela_AI_收入路径方案_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                // 恢复按钮状态
                setTimeout(() => {
                    exportBtn.innerHTML = originalText;
                    exportBtn.disabled = false;
                }, 1000);
                
            } catch (error) {
                console.error('PDF导出失败:', error);
                alert('PDF导出失败，请重试');
                exportBtn.innerHTML = originalText;
                exportBtn.disabled = false;
            }
        }

        function shareResult() {
            showShareModal();
        }

        function showShareModal() {
            const modal = document.getElementById('shareModal');
            const overlay = document.getElementById('shareOverlay');
            modal.style.display = 'block';
            overlay.style.display = 'block';
            setTimeout(() => {
                modal.classList.add('show');
                overlay.classList.add('show');
            }, 10);
        }

        function hideShareModal() {
            const modal = document.getElementById('shareModal');
            const overlay = document.getElementById('shareOverlay');
            modal.classList.remove('show');
            overlay.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                overlay.style.display = 'none';
            }, 300);
        }

        function copyShareLink() {
            const shareUrl = window.location.href;
            navigator.clipboard.writeText(shareUrl).then(() => {
                const copyBtn = document.querySelector('.copy-link-btn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check me-2"></i>已复制';
                copyBtn.style.background = 'var(--color-success)';
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = '';
                }, 2000);
            });
        }

        function shareToSocial(platform) {
            const shareUrl = encodeURIComponent(window.location.href);
            const shareTitle = encodeURIComponent('Angela AI - 我的非劳务收入设计方案');
            const shareText = encodeURIComponent('通过AI智能分析生成的个性化收入路径方案');
            
            let url = '';
            switch(platform) {
                case 'wechat':
                    // 微信分享需要特殊处理，显示二维码
                    showWechatQR();
                    return;
                case 'weibo':
                    url = `https://service.weibo.com/share/share.php?url=${shareUrl}&title=${shareText}&pic=`;
                    break;
                case 'qq':
                    url = `https://connect.qq.com/widget/shareqq/index.html?url=${shareUrl}&title=${shareTitle}&summary=${shareText}`;
                    break;
                case 'qzone':
                    url = `https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=${shareUrl}&title=${shareTitle}&summary=${shareText}`;
                    break;
            }
            
            if (url) {
                window.open(url, '_blank', 'width=600,height=400');
            }
        }

        function showWechatQR() {
            const qrContainer = document.getElementById('wechatQR');
            const shareUrl = window.location.href;
            
            // 使用免费的二维码API生成二维码
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shareUrl)}`;
            
            qrContainer.innerHTML = `
                <div style="text-align: center; padding: var(--space-4);">
                    <img src="${qrUrl}" alt="二维码" style="width: 200px; height: 200px; border-radius: var(--radius-lg);">
                    <p style="margin-top: var(--space-3); color: var(--color-text-secondary);">
                        使用微信扫描二维码分享
                    </p>
                </div>
            `;
            qrContainer.style.display = 'block';
        }

        // 页面加载动画
        document.addEventListener('DOMContentLoaded', function() {
            const elements = document.querySelectorAll('.fade-in-up');
            elements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';
                
                setTimeout(() => {
                    el.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>