<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI收入路径设计方案 - Angela AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/apple-design-system.css') }}" rel="stylesheet">
    <!-- 世界一流导航设计 -->
    <link href="{{ url_for('static', filename='css/navigation-redesign.css') }}" rel="stylesheet">
    <!-- 用户菜单下拉设计 -->
    <link href="{{ url_for('static', filename='css/user-menu-dropdown.css') }}" rel="stylesheet">
    <!-- 导航栏间距修复 - 解决顶部空白问题 -->
    <link href="{{ url_for('static', filename='css/navigation-spacing-fix.css') }}" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Apple级别结果展示页面样式 */
        :root {
            --page-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --accent-gradient: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--page-bg);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* 导航栏样式 */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-6);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: rgba(0, 122, 255, 0.1);
            color: var(--color-primary);
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-weight: var(--font-medium);
            font-size: var(--text-sm);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 122, 255, 0.2);
        }

        .back-btn:hover {
            background: rgba(0, 122, 255, 0.15);
            color: var(--color-primary-dark);
            text-decoration: none;
            transform: translateX(-2px);
        }

        .navbar-brand {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            text-decoration: none;
        }

        .navbar-brand:hover {
            color: var(--color-primary);
            text-decoration: none;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .navbar-action {
            padding: var(--space-2) var(--space-3);
            background: transparent;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .navbar-action:hover {
            background: var(--color-gray-100);
            color: var(--color-text-primary);
            text-decoration: none;
        }

        /* 为主内容添加顶部间距避免被导航栏遮挡 */
        .result-page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: calc(60px + var(--space-8)) var(--space-4) var(--space-8);
            min-height: 100vh;
        }

        /* 主容器 - 已移动到导航栏样式部分 */

        /* 页面头部 */
        .result-hero {
            text-align: center;
            margin-bottom: var(--space-12);
            padding: var(--space-8) 0;
        }

        /* 分析概览卡片 */
        .analysis-overview {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-4);
            padding: var(--space-8);
            margin-bottom: var(--space-6);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .overview-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-5);
        }

        .overview-icon {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            border-radius: var(--radius-3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .overview-title {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .overview-subtitle {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            margin: 0;
        }

        .overview-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .overview-section {
            padding: var(--space-4);
            background: rgba(0, 122, 255, 0.05);
            border-radius: var(--radius-3);
            border-left: 4px solid var(--color-primary);
        }

        .overview-section h4 {
            font-size: var(--text-md);
            font-weight: var(--font-semibold);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .overview-section p {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            line-height: 1.6;
            margin: 0;
        }

        .income-type-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: linear-gradient(45deg, rgba(40, 167, 69, 0.1), rgba(32, 201, 151, 0.1));
            color: var(--color-success);
            border: 1px solid rgba(40, 167, 69, 0.3);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            margin-bottom: var(--space-4);
        }

        /* 缺失角色建议卡片 */
        .roles-suggestion {
            background: rgba(255, 248, 220, 0.8);
            border: 1px solid rgba(255, 193, 7, 0.4);
            border-radius: var(--radius-3);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            backdrop-filter: blur(10px);
        }

        .roles-suggestion h4 {
            color: #cc8800;
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .role-card {
            background: white;
            border-radius: var(--radius-2);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .role-card:last-child {
            margin-bottom: 0;
        }

        .role-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .role-name {
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            font-size: var(--text-md);
        }

        .role-where {
            font-size: var(--text-xs);
            color: var(--color-text-secondary);
            background: var(--color-gray-100);
            padding: 2px 8px;
            border-radius: var(--radius-1);
        }

        .role-why {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-2);
        }

        .role-script {
            background: var(--color-gray-50);
            border-left: 3px solid var(--color-primary);
            padding: var(--space-3);
            border-radius: 0 var(--radius-2) var(--radius-2) 0;
            font-size: var(--text-sm);
            font-style: italic;
        }

        /* 路径卡片增强 */
        .path-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-4);
            padding: var(--space-8);
            margin-bottom: var(--space-6);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .path-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-6);
        }

        .path-title-section {
            flex: 1;
        }

        .path-id {
            font-size: var(--text-xs);
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-1);
        }

        .path-name {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-2);
        }

        .income-mechanism {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: linear-gradient(45deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.1));
            color: var(--color-primary);
            border: 1px solid rgba(0, 122, 255, 0.3);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
        }

        /* 三方结构可视化 */
        .three-parties {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.05), rgba(88, 86, 214, 0.05));
            border-radius: var(--radius-3);
            padding: var(--space-6);
            margin: var(--space-6) 0;
        }

        /* 关系结构图样式 */
        .parties-network {
            position: relative;
            width: 100%;
            min-height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: var(--space-8);
        }

        .network-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .network-line {
            stroke: var(--color-primary);
            stroke-width: 2;
            stroke-dasharray: 5,5;
            opacity: 0.6;
            animation: dashMove 3s linear infinite;
        }

        @keyframes dashMove {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: 20; }
        }

        .network-nodes {
            position: relative;
            z-index: 2;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .center-node {
            position: absolute;
            transform: translate(-50%, -50%);
            z-index: 3;
        }

        .surrounding-nodes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .surrounding-node {
            position: absolute;
            transform: translate(-50%, -50%);
        }

        .party-node {
            background: white;
            border-radius: var(--radius-3);
            padding: var(--space-4);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            max-width: 280px;
            min-width: 240px;
        }

        .party-node:hover {
            transform: translateY(-2px) translate(-50%, -50%);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .party-node.designer {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.15), rgba(88, 86, 214, 0.15));
            box-shadow: 0 6px 25px rgba(0, 122, 255, 0.3);
            min-width: 320px;
        }

        .party-node.participant {
            border-color: rgba(88, 86, 214, 0.3);
            background: linear-gradient(135deg, rgba(88, 86, 214, 0.08), rgba(175, 82, 222, 0.08));
        }

        .party-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--color-primary);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0, 122, 255, 0.6);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(0, 122, 255, 0.6); }
            50% { box-shadow: 0 0 20px rgba(0, 122, 255, 0.8); }
            100% { box-shadow: 0 0 10px rgba(0, 122, 255, 0.6); }
        }

        .resource-tag {
            display: inline-block;
            background: rgba(0, 122, 255, 0.1);
            color: var(--color-primary);
            padding: 2px 8px;
            border-radius: var(--radius-1);
            font-size: var(--text-xs);
            margin: 2px;
        }

        .party-resources, .party-value, .party-happiness {
            margin-top: var(--space-2);
            font-size: var(--text-sm);
        }

        .party-value {
            font-weight: var(--font-medium);
            color: var(--color-text-primary);
        }

        .party-happiness {
            color: var(--color-success);
        }

        /* 劳动负担估算样式 */
        .labor-load-highlight {
            border-left: 4px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }

        .labor-load-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .labor-hours {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .hours-number {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--color-primary);
        }

        .hours-unit {
            font-size: var(--text-lg);
            color: var(--color-text-secondary);
        }

        .load-level {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
        }

        .level-轻度 {
            background: rgba(40, 167, 69, 0.1);
            color: var(--color-success);
        }

        .level-中度 {
            background: rgba(255, 193, 7, 0.1);
            color: #cc8800;
        }

        .level-过高 {
            background: rgba(220, 53, 69, 0.1);
            color: var(--color-danger);
        }

        .labor-alternative {
            background: var(--color-gray-50);
            border-radius: var(--radius-2);
            padding: var(--space-3);
            font-size: var(--text-sm);
        }

        /* 薄弱环节样式 */
        .weak-link-highlight {
            border-left: 4px solid #ff9500;
            background: rgba(255, 149, 0, 0.05);
        }

        /* 风险应对样式 */
        .risk-item {
            margin-bottom: var(--space-3);
            padding: var(--space-3);
            background: var(--color-gray-50);
            border-radius: var(--radius-2);
        }

        .risk-item:last-child {
            margin-bottom: 0;
        }

        .risk-description {
            margin-bottom: var(--space-2);
            color: var(--color-text-primary);
        }

        .risk-mitigation {
            color: var(--color-success);
        }

        .step-why {
            font-style: italic;
            background: rgba(0, 122, 255, 0.05);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-1);
            border-left: 2px solid var(--color-primary);
        }

        .parties-title {
            text-align: center;
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-4);
        }

        .parties-diagram {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .party-box {
            background: white;
            border-radius: var(--radius-2);
            padding: var(--space-4);
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .party-box.your-role {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.15), rgba(88, 86, 214, 0.15));
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.2);
        }

        .party-arrow {
            font-size: var(--text-xl);
            color: var(--color-primary);
        }

        .party-name {
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-2);
        }

        .party-desc {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            line-height: 1.4;
        }

        /* 行动步骤时间线 */
        .action-timeline {
            position: relative;
            padding: var(--space-4) 0;
        }

        .timeline-line {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--color-primary), var(--color-success));
        }

        .timeline-step {
            position: relative;
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-5);
            padding-left: var(--space-12);
        }

        .step-indicator {
            position: absolute;
            left: 16px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-content {
            flex: 1;
            background: rgba(0, 122, 255, 0.05);
            border-radius: var(--radius-3);
            padding: var(--space-4);
        }

        .step-owner {
            font-weight: var(--font-semibold);
            color: var(--color-primary);
            font-size: var(--text-sm);
            margin-bottom: var(--space-1);
        }

        .step-action {
            font-size: var(--text-md);
            color: var(--color-text-primary);
            margin-bottom: var(--space-2);
            line-height: 1.5;
        }

        .step-happiness {
            font-size: var(--text-sm);
            color: #0d6834;
            background: rgba(40, 167, 69, 0.1);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-2);
            border-left: 3px solid var(--color-success);
        }

        /* 详细信息网格 */
        .path-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }

        .detail-card {
            background: rgba(248, 249, 250, 0.8);
            border-radius: var(--radius-3);
            padding: var(--space-4);
            border-left: 4px solid var(--color-primary);
        }

        .detail-title {
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .detail-content {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            line-height: 1.5;
        }

        .detail-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .detail-list li {
            padding: var(--space-1) 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .detail-list li:last-child {
            border-bottom: none;
        }

        .mvp-highlight {
            background: linear-gradient(45deg, rgba(40, 167, 69, 0.1), rgba(32, 201, 151, 0.1));
            border-left-color: var(--color-success);
            border: 1px solid rgba(40, 167, 69, 0.2);
        }

        .revenue-highlight {
            background: linear-gradient(45deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
            border-left-color: var(--color-warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        @media (max-width: 768px) {
            .overview-content {
                grid-template-columns: 1fr;
            }
            
            .parties-diagram {
                grid-template-columns: 1fr;
                gap: var(--space-2);
            }
            
            .party-arrow {
                transform: rotate(90deg);
            }
            
            .path-details {
                grid-template-columns: 1fr;
            }
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: var(--radius-full);
            padding: var(--space-2) var(--space-4);
            margin-bottom: var(--space-4);
            backdrop-filter: blur(20px);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--color-primary);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .hero-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            color: white;
            margin-bottom: var(--space-3);
            line-height: 1.2;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }

        .hero-subtitle {
            font-size: var(--text-xl);
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: var(--space-8);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            text-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
        }

        /* 卡片系统 */
        .glass-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-6);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-xl);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        /* 概览卡片 - 修改为浅色背景提高可读性 */
        .overview-card {
            background: rgba(255, 255, 255, 0.95);
            color: var(--color-text-primary);
            border: 1px solid rgba(0, 122, 255, 0.2);
        }

        .overview-title {
            display: flex;
            align-items: center;
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-6);
            color: var(--color-text-primary);
        }

        .overview-title i {
            margin-right: var(--space-3);
            padding: var(--space-2);
            background: rgba(0, 122, 255, 0.1);
            color: var(--color-primary);
            border-radius: var(--radius-lg);
        }

        .situation-text {
            font-size: var(--text-lg);
            line-height: 1.7;
            margin-bottom: var(--space-6);
            color: var(--color-text-primary);
        }

        /* 差距标签 */
        .gaps-container {
            margin-bottom: var(--space-6);
        }

        .gaps-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-4);
            color: var(--color-text-primary);
        }

        .gap-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-3);
        }

        .gap-tag {
            display: inline-block;
            padding: var(--space-2) var(--space-3);
            background: rgba(255, 193, 7, 0.15);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            margin-right: var(--space-2);
            margin-bottom: var(--space-2);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #b8860b;
        }
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* 路径卡片 */
        .path-card {
            position: relative;
            overflow: hidden;
        }

        .path-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
        }

        .path-number {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            color: white;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-bold);
            font-size: var(--text-lg);
        }

        .path-title {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            margin: 0;
            flex: 1;
            margin-left: var(--space-4);
        }

        .path-scene {
            background: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
        }

        /* 行动步骤 */
        .action-steps {
            margin: var(--space-6) 0;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--space-4);
            padding: var(--space-4);
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--color-primary);
        }

        .step-owner {
            min-width: 80px;
            font-weight: var(--font-semibold);
            color: var(--color-primary);
            margin-right: var(--space-4);
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-action {
            font-size: var(--text-base);
            color: var(--color-text-primary);
            line-height: 1.6;
        }



        /* MVP区域 */
        .mvp-section {
            background: linear-gradient(135deg, var(--color-success), #28a745);
            color: white;
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            margin: var(--space-6) 0;
        }

        .mvp-title {
            display: flex;
            align-items: center;
            font-weight: var(--font-bold);
            margin-bottom: var(--space-3);
        }

        .mvp-title i {
            margin-right: var(--space-2);
        }

        /* 资源和风险 */
        .resources-risks {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
            margin: var(--space-6) 0;
        }

        @media (max-width: 768px) {
            .resources-risks {
                grid-template-columns: 1fr;
            }
        }

        .info-section {
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-gray-200);
        }

        .info-title {
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-3);
        }

        .info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-list li {
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--color-gray-100);
            color: var(--color-text-secondary);
        }

        .info-list li:last-child {
            border-bottom: none;
        }

        /* 操作按钮 */
        .action-buttons {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
            margin-top: var(--space-12);
            flex-wrap: wrap;
        }

        .action-btn {
            padding: var(--space-4) var(--space-8);
            border-radius: var(--radius-xl);
            font-weight: var(--font-semibold);
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .btn-primary-custom {
            background: var(--accent-gradient);
            color: white;
            border: none;
        }

        .btn-secondary-custom {
            background: var(--glass-bg);
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* 动画效果 */
        .fade-in-up {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-delay-1 { animation-delay: 0.1s; }
        .animate-delay-2 { animation-delay: 0.2s; }
        .animate-delay-3 { animation-delay: 0.3s; }
        .animate-delay-4 { animation-delay: 0.4s; }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .result-page-container {
                padding: calc(60px + var(--space-4)) var(--space-3) var(--space-4);
            }
            
            .navbar {
                padding: 0 var(--space-3);
            }
            
            .navbar-left {
                flex: 1;
                min-width: 0;
            }
            
            .navbar-right {
                flex-shrink: 0;
                gap: var(--space-2);
            }
            
            .navbar-action {
                padding: var(--space-2);
                font-size: 12px;
            }
            
            .navbar-brand {
                font-size: var(--text-base);
            }
            
            .back-btn span {
                display: none; /* 隐藏文字只显示图标 */
            }
            
            .glass-card {
                padding: var(--space-5);
                margin: var(--space-4) 0;
            }
            
            .path-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-4);
            }
            
            .path-title {
                margin-left: 0;
                font-size: var(--text-xl);
            }
            
            .hero-title {
                font-size: var(--text-3xl);
            }
            
            .hero-subtitle {
                font-size: var(--text-base);
            }
            
            /* 操作按钮移动端优化 */
            .action-buttons {
                flex-direction: column;
                gap: var(--space-3);
                margin-top: var(--space-8);
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
                padding: var(--space-4) var(--space-6);
                font-size: var(--text-base);
            }
            
            /* 步骤项移动端优化 */
            .step-item {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-2);
            }
            
            .step-owner {
                align-self: flex-start;
                margin-bottom: var(--space-2);
            }
            
            .step-content {
                width: 100%;
            }
            
            /* 资源和风险移动端优化 */
            .resources-risks {
                grid-template-columns: 1fr;
                gap: var(--space-4);
            }
            
            .mvp-section {
                margin: var(--space-4) 0;
            }
        }
        
        /* 超小屏幕优化 */
        @media (max-width: 480px) {
            .navbar {
                padding: 0 var(--space-2);
            }
            
            .result-page-container {
                padding: calc(60px + var(--space-3)) var(--space-2) var(--space-3);
            }
            
            .glass-card {
                padding: var(--space-4);
                margin: var(--space-3) 0;
            }
            
            .hero-title {
                font-size: var(--text-2xl);
            }
            
            .path-number {
                width: 32px;
                height: 32px;
                font-size: var(--text-base);
            }
            
            .navbar-right {
                gap: var(--space-1);
            }
            
            .navbar-action {
                padding: var(--space-1) var(--space-2);
                font-size: 11px;
            }
        }

        /* 分享模态框样式 */
        .share-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .share-overlay.show {
            opacity: 1;
        }

        .share-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            min-width: 400px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            z-index: 1001;
            display: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .share-modal.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .share-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            border-bottom: 1px solid var(--color-gray-200);
            padding-bottom: var(--space-4);
        }

        .share-title {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: var(--text-xl);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-lg);
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--color-gray-100);
            color: var(--color-text-primary);
        }

        .share-options {
            display: grid;
            gap: var(--space-4);
        }

        .share-section {
            margin-bottom: var(--space-6);
        }

        .section-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-4);
        }

        .copy-link-section {
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
        }

        .copy-link-btn {
            width: 100%;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            padding: var(--space-3) var(--space-4);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .copy-link-btn:hover {
            background: var(--color-primary-dark);
            transform: translateY(-1px);
        }

        .social-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-3);
        }

        .social-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-4);
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-lg);
            background: white;
            text-decoration: none;
            color: var(--color-text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--color-primary);
        }

        .social-icon {
            width: 32px;
            height: 32px;
            margin-bottom: var(--space-2);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wechat { color: #07C160; }
        .weibo { color: #E6162D; }
        .qq { color: #12B7F5; }
        .qzone { color: #FCCA03; }

        .wechat-qr {
            display: none;
            background: white;
            border-radius: var(--radius-lg);
            margin-top: var(--space-4);
        }

        /* 骨架屏样式已完全移除 */

        /* 错误状态样式 */
        .error-container {
            padding-top: 80px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .error-icon {
            font-size: 4rem;
            color: #ff6b6b;
            margin-bottom: var(--space-4);
        }

        .error-title {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            color: white;
            margin-bottom: var(--space-2);
        }

        .error-message {
            font-size: var(--text-lg);
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: var(--space-6);
            max-width: 500px;
        }

        .retry-btn {
            padding: var(--space-3) var(--space-6);
            background: var(--color-primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-weight: var(--font-medium);
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            background: var(--color-primary-dark);
            color: white;
            text-decoration: none;
            transform: translateY(-2px);
        }

        @media (max-width: 640px) {
            .share-modal {
                min-width: 0;
                width: 90%;
                padding: var(--space-6);
            }
            
            .social-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            /* 骨架屏响应式样式已移除 */

            .thinking-title {
                font-size: var(--text-2xl);
            }
        }
    </style>
</head>
<body>
    <!-- 引用公共导航栏组件 -->
    {% include 'components/navigation.html' %}

    {% if status == 'error' %}
    <!-- 错误状态 -->
    <div class="error-container">
        <div class="error-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h1 class="error-title">分析遇到问题</h1>
        <p class="error-message">{{ error_message or '分析过程中发生错误，请稍后重试' }}</p>
        <a href="/" class="retry-btn">
            <i class="fas fa-redo me-2"></i>
            重新开始
        </a>
    </div>

    {% else %}
    <!-- 完成状态：显示完整结果 -->

    <div class="result-page-container">
        <!-- 页面头部 -->
        <div class="result-hero fade-in-up">
            <div class="hero-badge">
                {% if history_mode and record_info %}
                <i class="fas fa-history me-2"></i>
                历史记录 - {{ record_info.created_at }}
                {% else %}
                <i class="fas fa-magic me-2"></i>
                AI智能分析完成
                {% endif %}
            </div>
            <h1 class="hero-title">非劳务收入路径设计方案</h1>
            <p class="hero-subtitle">
                {% if history_mode %}
                历史分析记录 - {{ record_info.analysis_type if record_info else '查看以往设计方案' }}
                {% else %}
                基于您提供的项目信息和关键人物资源，我们为您生成了专业的收入管道设计方案
                {% endif %}
            </p>
        </div>

        <!-- 分析概览卡片 -->
        {% if result and result.overview %}
        <div class="analysis-overview fade-in-up animate-delay-1">
            <div class="overview-header">
                <div class="overview-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div>
                    <h2 class="overview-title">项目深度分析概览</h2>
                    <p class="overview-subtitle">Angela AI基于非劳务收入理论的专业分析</p>
                </div>
            </div>

            {% if result.overview.income_type %}
            <div class="income-type-badge">
                <i class="fas fa-coins"></i>
                收入类型：{{ result.overview.income_type }}
            </div>
            {% endif %}

            <div class="overview-content">
                {% if result.overview.situation %}
                <div class="overview-section">
                    <h4><i class="fas fa-chart-line"></i>当前情况分析</h4>
                    <p>{{ result.overview.situation }}</p>
                </div>
                {% endif %}
                
                {% if result.overview.core_insight %}
                <div class="overview-section">
                    <h4><i class="fas fa-brain"></i>核心洞察</h4>
                    <p>{{ result.overview.core_insight }}</p>
                </div>
                {% endif %}
            </div>

            {% if result.overview.gaps %}
            <div class="gaps-container">
                <h4 class="gaps-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    需要补齐的关键环节
                </h4>
                <div class="gap-tags">
                    {% for gap in result.overview.gaps %}
                    <span class="gap-tag">{{ gap }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- 角色建议卡片 -->
        {% if result.overview.suggested_roles_to_hunt %}
        <div class="roles-suggestion fade-in-up animate-delay-2">
            <h4>
                <i class="fas fa-user-plus"></i>
                建议寻找的关键角色
            </h4>
            {% for role in result.overview.suggested_roles_to_hunt %}
            <div class="role-card">
                <div class="role-header">
                    <span class="role-name">{{ role.role }}</span>
                    <span class="role-where">{{ role.where_to_find }}</span>
                </div>
                <div class="role-why">{{ role.why }}</div>
                <div class="role-script">"{{ role.outreach_script }}"</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endif %}

        <!-- 路径方案 -->
        {% if result and result.paths %}
        {% for path in result.paths %}
        <div class="path-card fade-in-up animate-delay-{{ loop.index + 2 }}">
            <div class="path-header">
                <div class="path-title-section">
                    <div class="path-id">{{ path.id or 'PATH_' + loop.index|string }}</div>
                    <h3 class="path-name">{{ path.name }}</h3>
                    {% if path.income_mechanism %}
                    <div class="income-mechanism">
                        <i class="fas fa-money-bill-wave"></i>
                        {{ path.income_mechanism.type or path.income_mechanism }}
                        {% if path.income_mechanism.trigger %}
                        <div style="font-size: var(--text-xs); margin-top: var(--space-1); opacity: 0.8;">{{ path.income_mechanism.trigger }}</div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% if path.scene %}
                <div style="text-align: right; color: var(--color-text-secondary);">
                    <i class="fas fa-map-marker-alt me-1"></i>
                    {{ path.scene }}
                </div>
                {% endif %}
            </div>

            <!-- 关键参与方结构 - 按角色分区展示 -->
            {% if path.parties_structure %}
            <div class="parties-structure-layout" style="margin-top: 30px;">
                <h4 class="parties-title" style="text-align: center; margin-bottom: 30px; font-size: 1.3rem; color: #333;">
                    <i class="fas fa-sitemap"></i> 关键参与方结构
                </h4>
                
                <!-- 设计者卡片 - 最顶部 -->
                <div class="designer-section" style="margin-bottom: 30px;">
                    {% for party in path.parties_structure %}
                        {% if party.party == '设计者（你）' or '你' in party.party or 'designer' in party.party.lower() or 'Designer' in party.party %}
                        <div class="designer-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); text-align: center; margin: 0 auto; max-width: 500px;">
                            <div class="designer-crown" style="font-size: 2rem; margin-bottom: 10px;">
                                <i class="fas fa-crown" style="color: #ffd700;"></i>
                            </div>
                            <h5 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 10px;">{{ party.party }}</h5>
                            <div class="designer-resources" style="margin-bottom: 10px;">
                                <strong style="display: block; margin-bottom: 8px;">核心资源：</strong>
                                {% if party.resources %}
                                    {% for resource in party.resources %}
                                    <span style="display: inline-block; background: rgba(255, 255, 255, 0.2); padding: 4px 10px; border-radius: 15px; margin: 3px; font-size: 0.85rem;">{{ resource }}</span>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <div class="designer-value" style="background: rgba(255, 255, 255, 0.15); border-radius: 10px; padding: 8px; font-size: 0.95rem;">
                                <i class="fas fa-star"></i> {{ party.role_value }}
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <!-- 连接线装饰 -->
                <div style="text-align: center; margin: 25px 0;">
                    <div style="width: 2px; height: 30px; background: linear-gradient(180deg, #667eea 0%, transparent 100%); margin: 0 auto;"></div>
                    <div style="font-size: 1.1rem; color: #667eea;">
                        <i class="fas fa-arrows-alt-v"></i>
                    </div>
                </div>
                
                <!-- 三大角色区域容器 -->
                <div class="roles-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                    
                    <!-- 需求方区域 -->
                    <div class="demand-section" style="background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%); border-radius: 12px; padding: 15px; border: 2px solid #2196f3;">
                        <h5 style="color: #2196f3; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; text-align: center;">
                            <i class="fas fa-shopping-cart"></i> 需求方
                        </h5>
                        <div class="demand-parties">
                            {% for party in path.parties_structure %}
                                {% if not (party.party == '设计者（你）' or '你' in party.party or 'designer' in party.party.lower() or 'Designer' in party.party) %}
                                    {% if '需求' in party.role_value or '客户' in party.role_value or '用户' in party.role_value or '学生' in party.role_value or '家长' in party.role_value or '购买' in party.role_value %}
                                    <div class="party-card" style="background: white; border-radius: 10px; padding: 12px; margin-bottom: 12px; box-shadow: 0 3px 8px rgba(33, 150, 243, 0.1);">
                                        <div class="party-header" style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div class="party-icon" style="width: 35px; height: 35px; background: linear-gradient(135deg, #2196f3, #64b5f6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; margin-right: 10px; font-size: 0.9rem;">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h6 style="font-weight: 600; margin: 0; color: #333; font-size: 0.95rem;">{{ party.party }}</h6>
                                                <small style="color: #666; font-size: 0.8rem;">{{ party.role_value }}</small>
                                            </div>
                                        </div>
                                        <div class="party-resources" style="margin-bottom: 8px;">
                                            <strong style="color: #555; font-size: 0.85rem;">资源：</strong>
                                            {% if party.resources %}
                                                {% for resource in party.resources %}
                                                <span style="display: inline-block; background: #e3f2fd; color: #2196f3; padding: 2px 6px; border-radius: 10px; margin: 2px; font-size: 0.8rem;">{{ resource }}</span>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        <div class="party-happiness" style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 6px; padding: 8px; font-size: 0.85rem;">
                                            <i class="fas fa-smile" style="color: #4caf50; font-size: 0.8rem;"></i>
                                            <strong style="color: #2e7d32;">如何让TA高兴：</strong>
                                            <div style="margin-top: 3px; color: #555; font-size: 0.8rem;">{{ party.make_them_happy }}</div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- 交付方区域 -->
                    <div class="delivery-section" style="background: linear-gradient(135deg, #f3e5f5 0%, #ffffff 100%); border-radius: 12px; padding: 15px; border: 2px solid #9c27b0;">
                        <h5 style="color: #9c27b0; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; text-align: center;">
                            <i class="fas fa-truck"></i> 交付方
                        </h5>
                        <div class="delivery-parties">
                            {% for party in path.parties_structure %}
                                {% if not (party.party == '设计者（你）' or '你' in party.party or 'designer' in party.party.lower() or 'Designer' in party.party) %}
                                    {% if '交付' in party.role_value or '提供' in party.role_value or '服务' in party.role_value or '老师' in party.role_value or '教练' in party.role_value or '外教' in party.role_value or '规划' in party.role_value or '专业' in party.role_value %}
                                    <div class="party-card" style="background: white; border-radius: 10px; padding: 12px; margin-bottom: 12px; box-shadow: 0 3px 8px rgba(156, 39, 176, 0.1);">
                                        <div class="party-header" style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div class="party-icon" style="width: 35px; height: 35px; background: linear-gradient(135deg, #9c27b0, #ba68c8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; margin-right: 10px; font-size: 0.9rem;">
                                                <i class="fas fa-hands-helping"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h6 style="font-weight: 600; margin: 0; color: #333; font-size: 0.95rem;">{{ party.party }}</h6>
                                                <small style="color: #666; font-size: 0.8rem;">{{ party.role_value }}</small>
                                            </div>
                                        </div>
                                        <div class="party-resources" style="margin-bottom: 8px;">
                                            <strong style="color: #555; font-size: 0.85rem;">资源：</strong>
                                            {% if party.resources %}
                                                {% for resource in party.resources %}
                                                <span style="display: inline-block; background: #f3e5f5; color: #9c27b0; padding: 2px 6px; border-radius: 10px; margin: 2px; font-size: 0.8rem;">{{ resource }}</span>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        <div class="party-happiness" style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 6px; padding: 8px; font-size: 0.85rem;">
                                            <i class="fas fa-smile" style="color: #4caf50; font-size: 0.8rem;"></i>
                                            <strong style="color: #2e7d32;">如何让TA高兴：</strong>
                                            <div style="margin-top: 3px; color: #555; font-size: 0.8rem;">{{ party.make_them_happy }}</div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- 资金方区域 -->
                    <div class="funding-section" style="background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%); border-radius: 12px; padding: 15px; border: 2px solid #ff9800;">
                        <h5 style="color: #ff9800; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; text-align: center;">
                            <i class="fas fa-coins"></i> 资金方
                        </h5>
                        <div class="funding-parties">
                            {% for party in path.parties_structure %}
                                {% if not (party.party == '设计者（你）' or '你' in party.party or 'designer' in party.party.lower() or 'Designer' in party.party) %}
                                    {% if '资金' in party.role_value or '投资' in party.role_value or '付费' in party.role_value or '赞助' in party.role_value or '广告' in party.role_value or '支付' in party.role_value %}
                                    <div class="party-card" style="background: white; border-radius: 10px; padding: 12px; margin-bottom: 12px; box-shadow: 0 3px 8px rgba(255, 152, 0, 0.1);">
                                        <div class="party-header" style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div class="party-icon" style="width: 35px; height: 35px; background: linear-gradient(135deg, #ff9800, #ffb74d); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; margin-right: 10px; font-size: 0.9rem;">
                                                <i class="fas fa-dollar-sign"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h6 style="font-weight: 600; margin: 0; color: #333; font-size: 0.95rem;">{{ party.party }}</h6>
                                                <small style="color: #666; font-size: 0.8rem;">{{ party.role_value }}</small>
                                            </div>
                                        </div>
                                        <div class="party-resources" style="margin-bottom: 8px;">
                                            <strong style="color: #555; font-size: 0.85rem;">资源：</strong>
                                            {% if party.resources %}
                                                {% for resource in party.resources %}
                                                <span style="display: inline-block; background: #fff3e0; color: #ff9800; padding: 2px 6px; border-radius: 10px; margin: 2px; font-size: 0.8rem;">{{ resource }}</span>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        <div class="party-happiness" style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 6px; padding: 8px; font-size: 0.85rem;">
                                            <i class="fas fa-smile" style="color: #4caf50; font-size: 0.8rem;"></i>
                                            <strong style="color: #2e7d32;">如何让TA高兴：</strong>
                                            <div style="margin-top: 3px; color: #555; font-size: 0.8rem;">{{ party.make_them_happy }}</div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                </div>
            </div>
                
                <script>
                // 动态绘制连线
                document.addEventListener('DOMContentLoaded', function() {
                    const networkContainer = document.getElementById('partiesNetwork{{ loop.index }}');
                    const svg = document.getElementById('networkSvg{{ loop.index }}');
                    
                    if (!networkContainer || !svg) return;
                    
                    function drawConnections() {
                        const centerNode = networkContainer.querySelector('.designer');
                        const participantNodes = networkContainer.querySelectorAll('.participant');
                        
                        if (!centerNode || participantNodes.length === 0) return;
                        
                        // 清除现有连线
                        svg.innerHTML = '';
                        
                        const containerRect = networkContainer.getBoundingClientRect();
                        const centerRect = centerNode.getBoundingClientRect();
                        const centerX = (centerRect.left + centerRect.width/2 - containerRect.left) / containerRect.width * 100;
                        const centerY = (centerRect.top + centerRect.height/2 - containerRect.top) / containerRect.height * 100;
                        
                        participantNodes.forEach((node, index) => {
                            const nodeRect = node.getBoundingClientRect();
                            const nodeX = (nodeRect.left + nodeRect.width/2 - containerRect.left) / containerRect.width * 100;
                            const nodeY = (nodeRect.top + nodeRect.height/2 - containerRect.top) / containerRect.height * 100;
                            
                            // 创建连线
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', centerX + '%');
                            line.setAttribute('y1', centerY + '%');
                            line.setAttribute('x2', nodeX + '%');
                            line.setAttribute('y2', nodeY + '%');
                            line.setAttribute('stroke', '#007AFF');
                            line.setAttribute('stroke-width', '2');
                            line.setAttribute('stroke-dasharray', '5,5');
                            line.setAttribute('opacity', '0.7');
                            line.classList.add('network-connection');
                            svg.appendChild(line);
                            
                            // 添加动画
                            line.style.strokeDashoffset = '10';
                            line.style.animation = 'dash 2s linear infinite';
                        });
                    }
                    
                    // 延迟绘制确保布局完成
                    setTimeout(drawConnections, 200);
                    
                    // 响应式重绘
                    window.addEventListener('resize', () => {
                        setTimeout(drawConnections, 100);
                    });
                });
                </script>
            </div>
            {% elif path.three_parties_structure %}
            <div class="three-parties">
                <h4 class="parties-title">三方合作结构</h4>
                <div class="parties-diagram">
                    <div class="party-box">
                        <div class="party-name">甲方</div>
                        <div class="party-desc">{{ path.three_parties_structure.party_a }}</div>
                    </div>
                    <div class="party-arrow">→</div>
                    <div class="party-box your-role">
                        <div class="party-name">您的角色</div>
                        <div class="party-desc">{{ path.three_parties_structure.your_role }}</div>
                    </div>
                    <div class="party-arrow">→</div>
                    <div class="party-box">
                        <div class="party-name">乙方</div>
                        <div class="party-desc">{{ path.three_parties_structure.party_b }}</div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 启动动作 -->
            {% if path.first_step or path.who_moves_first %}
            <div style="background: rgba(0, 122, 255, 0.05); border-radius: var(--radius-3); padding: var(--space-4); margin: var(--space-4) 0; border-left: 4px solid var(--color-primary);">
                <div style="display: flex; align-items: center; margin-bottom: var(--space-2);">
                    <i class="fas fa-play-circle" style="color: var(--color-primary); margin-right: var(--space-2);"></i>
                    <strong>{{ '启动动作' if path.first_step else '启动策略' }}</strong>
                </div>
                <div>{{ path.first_step or path.who_moves_first }}</div>
            </div>
            {% endif %}

            <!-- 行动步骤时间线 -->
            {% if path.action_steps %}
            <div style="margin: var(--space-6) 0;">
                <h4 style="display: flex; align-items: center; margin-bottom: var(--space-4);">
                    <i class="fas fa-route me-2"></i>
                    行动步骤时间线
                </h4>
                <div class="action-timeline">
                    <div class="timeline-line"></div>
                    {% for step in path.action_steps %}
                    <div class="timeline-step">
                        <div class="step-indicator"></div>
                        <div class="step-content">
                            <div class="step-owner">{{ step.owner }}</div>
                            <div class="step-action">{{ step.action or step.step }}</div>
                            {% if step.why_it_works %}
                            <div class="step-why" style="font-size: var(--text-xs); color: var(--color-text-secondary); margin-top: var(--space-1);">{{ step.why_it_works }}</div>
                            {% endif %}
                            {% if step.make_who_happy %}
                            <div class="step-happiness">
                                <i class="fas fa-smile me-1"></i>
                                {{ step.make_who_happy }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- 详细信息网格 -->
            <div class="path-details">
                {% if path.mvp %}
                <div class="detail-card mvp-highlight">
                    <div class="detail-title">
                        <i class="fas fa-rocket"></i>
                        最小可验证原型 (MVP)
                    </div>
                    <div class="detail-content">{{ path.mvp }}</div>
                </div>
                {% endif %}

                {% if path.revenue_trigger %}
                <div class="detail-card revenue-highlight">
                    <div class="detail-title">
                        <i class="fas fa-money-bill-wave"></i>
                        收益触发机制
                    </div>
                    <div class="detail-content">{{ path.revenue_trigger }}</div>
                </div>
                {% endif %}

                {% if path.use_key_person_resources %}
                <div class="detail-card">
                    <div class="detail-title">
                        <i class="fas fa-users"></i>
                        关键人物资源
                    </div>
                    <ul class="detail-list">
                        {% for resource in path.use_key_person_resources %}
                        <li>{{ resource }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if path.use_external_resources %}
                <div class="detail-card">
                    <div class="detail-title">
                        <i class="fas fa-external-link-alt"></i>
                        外部资源
                    </div>
                    <ul class="detail-list">
                        {% for resource in path.use_external_resources %}
                        <li>{{ resource }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if path.avoid_being_bypassed %}
                <div class="detail-card">
                    <div class="detail-title">
                        <i class="fas fa-shield-alt"></i>
                        防跳过措施
                    </div>
                    <div class="detail-content">{{ path.avoid_being_bypassed }}</div>
                </div>
                {% endif %}

                {% if path.scaling_potential %}
                <div class="detail-card">
                    <div class="detail-title">
                        <i class="fas fa-expand-arrows-alt"></i>
                        规模化潜力
                    </div>
                    <div class="detail-content">{{ path.scaling_potential }}</div>
                </div>
                {% endif %}

                {% if path.weak_link %}
                <div class="detail-card weak-link-highlight">
                    <div class="detail-title">
                        <i class="fas fa-chain-broken"></i>
                        最薄弱环节
                    </div>
                    <div class="detail-content">{{ path.weak_link }}</div>
                </div>
                {% endif %}

                {% if path.risks_and_planB or path.risks %}
                <div class="detail-card">
                    <div class="detail-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        风险与应对
                    </div>
                    {% if path.risks_and_planB %}
                        {% for risk_item in path.risks_and_planB %}
                        <div class="risk-item">
                            <div class="risk-description"><strong>风险：</strong>{{ risk_item.risk }}</div>
                            <div class="risk-mitigation"><strong>应对：</strong>{{ risk_item.mitigation }}</div>
                        </div>
                        {% endfor %}
                    {% elif path.risks %}
                        <ul class="detail-list">
                            {% for risk in path.risks %}
                            <li>{{ risk }}</li>
                            {% endfor %}
                        </ul>
                        {% if path.plan_b %}
                        <div class="detail-content" style="margin-top: var(--space-3); padding-top: var(--space-3); border-top: 1px solid rgba(0, 0, 0, 0.1);">
                            <strong>备选方案：</strong>{{ path.plan_b }}
                        </div>
                        {% endif %}
                    {% endif %}
                </div>
                {% endif %}

                {% if path.labor_load_estimate %}
                <div class="detail-card labor-load-highlight">
                    <div class="detail-title">
                        <i class="fas fa-clock"></i>
                        劳动负担估算
                    </div>
                    <div class="labor-load-content">
                        <div class="labor-hours">
                            <span class="hours-number">{{ path.labor_load_estimate.hours_per_week }}</span>
                            <span class="hours-unit">小时/周</span>
                            <span class="load-level level-{{ path.labor_load_estimate.level.split('(')[0] if '(' in path.labor_load_estimate.level else path.labor_load_estimate.level }}">{{ path.labor_load_estimate.level }}</span>
                        </div>
                        {% if path.labor_load_estimate.alternative %}
                        <div class="labor-alternative">
                            <strong>降低方案：</strong>{{ path.labor_load_estimate.alternative }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>

        </div>
        {% endfor %}
        
        <!-- 实施优先级和建议 -->
        {% if result and (result.implementation_priority or result.notes) %}
        <div class="analysis-overview fade-in-up animate-delay-{{ (result.paths|length) + 3 }}">
            <div class="overview-header">
                <div class="overview-icon">
                    <i class="fas fa-list-alt"></i>
                </div>
                <div>
                    <h2 class="overview-title">实施建议</h2>
                    <p class="overview-subtitle">基于项目分析的专业建议</p>
                </div>
            </div>

            {% if result.implementation_priority %}
            <div class="overview-section" style="margin-bottom: var(--space-4);">
                <h4><i class="fas fa-sort-amount-down"></i>实施优先级</h4>
                <p>{{ result.implementation_priority }}</p>
            </div>
            {% endif %}

            {% if result.notes %}
            <div class="overview-section">
                <h4><i class="fas fa-sticky-note"></i>额外建议</h4>
                <p>{{ result.notes }}</p>
            </div>
            {% endif %}
        </div>
        {% endif %}
        {% else %}
        <!-- 示例数据展示 -->
        <div class="glass-card path-card fade-in-up animate-delay-2">
            <div class="path-header">
                <div style="display: flex; align-items: center;">
                    <div class="path-number">1</div>
                    <h3 class="path-title">视频号带货分成</h3>
                </div>
                <div class="path-scene">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    通过张三的视频号进行商品推广
                </div>
            </div>

            <div style="margin-bottom: var(--space-6);">
                <div style="display: flex; align-items: center; margin-bottom: var(--space-3);">
                    <i class="fas fa-play-circle" style="color: var(--color-primary); margin-right: var(--space-2);"></i>
                    <strong>启动策略：</strong>
                </div>
                <div style="color: var(--color-text-secondary); font-size: var(--text-lg);">
                    你先与张三对接分成模式
                </div>
            </div>

            <div class="action-steps">
                <h4 style="display: flex; align-items: center; margin-bottom: var(--space-4);">
                    <i class="fas fa-list-ol me-2"></i>
                    执行步骤
                </h4>
                <div class="step-item">
                    <div class="step-owner">你</div>
                    <div class="step-content">
                        <div class="step-action">联系张三，商讨视频号推广分成模式，确定商品类型和分成比例</div>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-owner">张三</div>
                    <div class="step-content">
                        <div class="step-action">发布带货视频内容（每周2条），并在视频中附带商品购买链接</div>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-owner">你</div>
                    <div class="step-content">
                        <div class="step-action">通过电商平台联系小商家，获取试用品或样品以备推广</div>
                    </div>
                </div>
            </div>

            <div class="mvp-section">
                <div class="mvp-title">
                    <i class="fas fa-rocket"></i>
                    最小可验证原型 (MVP)
                </div>
                <div>联系3个商家，成功完成至少1个商品推广视频并获得首批订单（目标≥10单）</div>
            </div>

            <div class="resources-risks">
                <div class="info-section">
                    <div class="info-title">
                        <i class="fas fa-users me-2"></i>
                        关键人物资源
                    </div>
                    <ul class="info-list">
                        <li>张三的视频号粉丝5万</li>
                        <li>张三的3个微信群</li>
                    </ul>
                </div>
                <div class="info-section">
                    <div class="info-title">
                        <i class="fas fa-shield-alt me-2"></i>
                        风险与应对
                    </div>
                    <ul class="info-list">
                        <li>商品质量不佳导致负面评价</li>
                        <li>视频号带货效果不理想</li>
                        <li><strong>备选方案：</strong>若商品效果不佳，改为推广虚拟商品或服务，如课程或会员卡</li>
                    </ul>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, var(--color-accent), #ff7043); color: white; padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-4);">
                <div style="display: flex; align-items: center; font-weight: var(--font-semibold);">
                    <i class="fas fa-coins me-2"></i>
                    收益触发点
                </div>
                <div style="margin-top: var(--space-2);">通过视频号带货产生销售分成</div>
            </div>
        </div>
        {% endif %}

        <!-- 操作按钮 -->
        <div class="action-buttons fade-in-up animate-delay-4">
            <button class="action-btn btn-primary-custom" onclick="exportToPDF()">
                <i class="fas fa-download"></i>
                导出PDF报告
            </button>
            <button class="action-btn btn-secondary-custom" onclick="shareResult()">
                <i class="fas fa-share-alt"></i>
                分享方案
            </button>
        </div>
    </div>

    <!-- 分享模态框 -->
    <div class="share-overlay" id="shareOverlay" onclick="hideShareModal()"></div>
    <div class="share-modal" id="shareModal">
        <div class="share-header">
            <h3 class="share-title">分享方案</h3>
            <button class="close-btn" onclick="hideShareModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="share-options">
            <!-- 复制链接 -->
            <div class="share-section">
                <div class="section-title">
                    <i class="fas fa-link me-2"></i>
                    复制链接
                </div>
                <div class="copy-link-section">
                    <button class="copy-link-btn" onclick="copyShareLink()">
                        <i class="fas fa-copy me-2"></i>
                        复制链接到剪贴板
                    </button>
                </div>
            </div>

            <!-- 社交媒体分享 -->
            <div class="share-section">
                <div class="section-title">
                    <i class="fas fa-share-alt me-2"></i>
                    社交媒体分享
                </div>
                <div class="social-buttons">
                    <div class="social-btn" onclick="shareToSocial('wechat')">
                        <div class="social-icon wechat">
                            <i class="fab fa-weixin"></i>
                        </div>
                        <span>微信</span>
                    </div>
                    <div class="social-btn" onclick="shareToSocial('weibo')">
                        <div class="social-icon weibo">
                            <i class="fab fa-weibo"></i>
                        </div>
                        <span>微博</span>
                    </div>
                    <div class="social-btn" onclick="shareToSocial('qq')">
                        <div class="social-icon qq">
                            <i class="fab fa-qq"></i>
                        </div>
                        <span>QQ</span>
                    </div>
                    <div class="social-btn" onclick="shareToSocial('qzone')">
                        <div class="social-icon qzone">
                            <i class="fas fa-star"></i>
                        </div>
                        <span>QQ空间</span>
                    </div>
                </div>
                
                <!-- 微信二维码区域 -->
                <div class="wechat-qr" id="wechatQR"></div>
            </div>
        </div>
    </div>

    {% endif %}



    <!-- JavaScript -->
    <script>
        // 轮询代码已移除 - 结果页面不再需要加载状态


        function exportToPDF() {
            // 显示导出进度
            const exportBtn = document.querySelector('.action-btn.btn-primary-custom');
            const originalText = exportBtn.innerHTML;
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>正在生成PDF...';
            exportBtn.disabled = true;

            try {
                // 创建一个专门用于PDF导出的容器
                const exportContainer = createPDFExportContainer();
                document.body.appendChild(exportContainer);

                // 使用html2canvas截图，然后转为PDF
                html2canvas(exportContainer, {
                    scale: 2, // 提高清晰度
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: 800,
                    height: exportContainer.scrollHeight
                }).then(canvas => {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 210; // A4宽度
                    const pageHeight = 295; // A4高度
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    // 添加第一页
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    // 如果内容超过一页，添加更多页面
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    // 保存PDF
                    const currentDate = new Date().toISOString().slice(0, 10);
                    pdf.save(`Angela-AI收入路径设计方案-${currentDate}.pdf`);
                    
                    // 清理临时容器
                    document.body.removeChild(exportContainer);
                    
                    // 恢复按钮状态
                    exportBtn.innerHTML = originalText;
                    exportBtn.disabled = false;
                }).catch(error => {
                    console.error('PDF生成失败:', error);
                    alert('PDF生成失败，请重试');
                    
                    // 清理和恢复
                    if (document.body.contains(exportContainer)) {
                        document.body.removeChild(exportContainer);
                    }
                    exportBtn.innerHTML = originalText;
                    exportBtn.disabled = false;
                });
                
            } catch (error) {
                console.error('PDF导出失败:', error);
                alert('PDF导出失败，请重试');
                exportBtn.innerHTML = originalText;
                exportBtn.disabled = false;
            }
        }

        // 创建用于PDF导出的简洁容器
        function createPDFExportContainer() {
            const container = document.createElement('div');
            container.style.cssText = `
                position: absolute;
                top: -9999px;
                left: -9999px;
                width: 800px;
                background: white;
                padding: 40px;
                font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
                color: #333;
                line-height: 1.6;
            `;

            // 添加标题
            const title = document.createElement('div');
            title.style.cssText = `
                text-align: center;
                margin-bottom: 40px;
                border-bottom: 2px solid #007AFF;
                padding-bottom: 20px;
            `;
            title.innerHTML = `
                <h1 style="color: #007AFF; font-size: 28px; margin: 0 0 10px 0;">Angela AI</h1>
                <h2 style="color: #666; font-size: 18px; margin: 0 0 10px 0;">非劳务收入路径设计方案</h2>
                <p style="color: #999; font-size: 14px; margin: 0;">生成时间: ${new Date().toLocaleString('zh-CN')}</p>
            `;
            container.appendChild(title);

            // 添加项目概览
            const overview = document.querySelector('.situation-text');
            if (overview) {
                const overviewSection = document.createElement('div');
                overviewSection.style.cssText = 'margin-bottom: 30px;';
                overviewSection.innerHTML = `
                    <h3 style="color: #007AFF; font-size: 20px; margin-bottom: 15px;">项目概览与分析</h3>
                    <p style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 0;">${overview.textContent}</p>
                `;
                container.appendChild(overviewSection);
            }

            // 添加需要补齐的关键环节
            const gapTags = document.querySelectorAll('.gap-tag');
            if (gapTags.length > 0) {
                const gapsSection = document.createElement('div');
                gapsSection.style.cssText = 'margin-bottom: 30px;';
                let gapsHtml = `<h3 style="color: #FF3B30; font-size: 18px; margin-bottom: 15px;">需要补齐的关键环节</h3><ul style="margin: 0; padding-left: 20px;">`;
                gapTags.forEach(tag => {
                    gapsHtml += `<li style="margin-bottom: 8px; color: #666;">${tag.textContent}</li>`;
                });
                gapsHtml += '</ul>';
                gapsSection.innerHTML = gapsHtml;
                container.appendChild(gapsSection);
            }

            // 添加收入路径方案
            const pathCards = document.querySelectorAll('.path-card');
            pathCards.forEach((card, index) => {
                const pathSection = document.createElement('div');
                pathSection.style.cssText = `
                    margin-bottom: 40px; 
                    padding: 25px; 
                    border: 1px solid #e0e0e0; 
                    border-radius: 12px;
                    background: #fafafa;
                `;

                let pathHtml = '';
                
                // 路径标题
                const pathTitle = card.querySelector('.path-title')?.textContent || `路径方案 ${index + 1}`;
                pathHtml += `<h3 style="color: #007AFF; font-size: 20px; margin: 0 0 15px 0;">${index + 1}. ${pathTitle}</h3>`;

                // 场景描述
                const pathScene = card.querySelector('.path-scene')?.textContent;
                if (pathScene) {
                    pathHtml += `<p style="color: #666; font-style: italic; margin-bottom: 15px;"><strong>场景:</strong> ${pathScene}</p>`;
                }

                // 启动策略
                const whoMovesFirst = card.querySelector('div[style*="color: var(--color-text-secondary)"]')?.textContent;
                if (whoMovesFirst) {
                    pathHtml += `<p style="color: #333; margin-bottom: 15px;"><strong>启动策略:</strong> ${whoMovesFirst}</p>`;
                }

                // 执行步骤
                const stepItems = card.querySelectorAll('.step-item');
                if (stepItems.length > 0) {
                    pathHtml += '<h4 style="color: #333; margin: 20px 0 10px 0;">执行步骤:</h4><ol style="margin: 0; padding-left: 20px;">';
                    stepItems.forEach(step => {
                        const owner = step.querySelector('.step-owner')?.textContent || '';
                        const action = step.querySelector('.step-action')?.textContent || '';
                        pathHtml += `<li style="margin-bottom: 12px;"><strong style="color: #007AFF;">${owner}:</strong><br><span style="color: #666;">${action}</span></li>`;
                    });
                    pathHtml += '</ol>';
                }

                // MVP验证
                const mvpSection = card.querySelector('.mvp-section');
                if (mvpSection) {
                    const mvpText = mvpSection.textContent.replace('最小可验证原型 (MVP)', '').trim();
                    pathHtml += `<div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4 style="color: #34C759; margin: 0 0 10px 0;">最小可验证原型 (MVP)</h4>
                        <p style="margin: 0; color: #333;">${mvpText}</p>
                    </div>`;
                }

                pathSection.innerHTML = pathHtml;
                container.appendChild(pathSection);
            });

            return container;
        }

        function shareResult() {
            showShareModal();
        }

        function showShareModal() {
            const modal = document.getElementById('shareModal');
            const overlay = document.getElementById('shareOverlay');
            modal.style.display = 'block';
            overlay.style.display = 'block';
            setTimeout(() => {
                modal.classList.add('show');
                overlay.classList.add('show');
            }, 10);
        }

        function hideShareModal() {
            const modal = document.getElementById('shareModal');
            const overlay = document.getElementById('shareOverlay');
            modal.classList.remove('show');
            overlay.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                overlay.style.display = 'none';
            }, 300);
        }

        function copyShareLink() {
            const shareUrl = window.location.href;
            navigator.clipboard.writeText(shareUrl).then(() => {
                const copyBtn = document.querySelector('.copy-link-btn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check me-2"></i>已复制';
                copyBtn.style.background = 'var(--color-success)';
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = '';
                }, 2000);
            });
        }

        function shareToSocial(platform) {
            const shareUrl = encodeURIComponent(window.location.href);
            const shareTitle = encodeURIComponent('Angela AI - 我的非劳务收入设计方案');
            const shareText = encodeURIComponent('通过AI智能分析生成的个性化收入路径方案');
            
            let url = '';
            switch(platform) {
                case 'wechat':
                    // 微信分享需要特殊处理，显示二维码
                    showWechatQR();
                    return;
                case 'weibo':
                    url = `https://service.weibo.com/share/share.php?url=${shareUrl}&title=${shareText}&pic=`;
                    break;
                case 'qq':
                    url = `https://connect.qq.com/widget/shareqq/index.html?url=${shareUrl}&title=${shareTitle}&summary=${shareText}`;
                    break;
                case 'qzone':
                    url = `https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=${shareUrl}&title=${shareTitle}&summary=${shareText}`;
                    break;
            }
            
            if (url) {
                window.open(url, '_blank', 'width=600,height=400');
            }
        }

        function showWechatQR() {
            const qrContainer = document.getElementById('wechatQR');
            const shareUrl = window.location.href;
            
            // 使用免费的二维码API生成二维码
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shareUrl)}`;
            
            qrContainer.innerHTML = `
                <div style="text-align: center; padding: var(--space-4);">
                    <img src="${qrUrl}" alt="二维码" style="width: 200px; height: 200px; border-radius: var(--radius-lg);">
                    <p style="margin-top: var(--space-3); color: var(--color-text-secondary);">
                        使用微信扫描二维码分享
                    </p>
                </div>
            `;
            qrContainer.style.display = 'block';
        }

        // 页面加载动画
        document.addEventListener('DOMContentLoaded', function() {
            const elements = document.querySelectorAll('.fade-in-up');
            elements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';
                
                setTimeout(() => {
                    el.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/user-menu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mobile-menu.js') }}"></script>
</body>
</html>