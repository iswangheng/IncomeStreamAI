<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>非劳务收入管道设计方案 - Angela AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/apple-design-system.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/navigation-redesign.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/user-menu-dropdown.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/navigation-spacing-fix.css') }}" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* 全新管道设计结果页面样式 */
        :root {
            --pipeline-primary: #667eea;
            --pipeline-secondary: #764ba2;
            --framework-gradient: linear-gradient(135deg, var(--pipeline-primary) 0%, var(--pipeline-secondary) 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --role-need: #FF6B6B;        /* 需求方 - 红色 */
            --role-deliver: #4ECDC4;     /* 交付方 - 青色 */
            --role-fund: #45B7D1;        /* 资金方 - 蓝色 */
            --role-coordinate: #96CEB4;   /* 统筹方 - 绿色 */
            --framework-accent: #FFA726;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--framework-gradient);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }


        /* 主容器 */
        .main-container {
            margin-top: 80px;
            padding: var(--space-2) var(--space-3);
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* 页面标题 - 优化版本 */
        .page-header {
            text-align: center;
            margin-bottom: var(--space-3);
            padding: var(--space-3) var(--space-2);
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius-xl);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: var(--color-text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .page-title i {
            color: var(--pipeline-primary);
            font-size: 1.6rem;
        }

        .page-subtitle {
            font-size: 0.95rem;
            margin-bottom: var(--space-2);
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .formula-display {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            background: linear-gradient(135deg, var(--pipeline-primary), var(--pipeline-secondary));
            color: white;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .formula-display i {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        /* 概览卡片 */
        .overview-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid var(--glass-border);
        }

        .overview-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--pipeline-primary);
        }

        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .insight-item {
            padding: var(--space-4);
            background: rgba(102, 126, 234, 0.08);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--pipeline-primary);
        }

        .insight-item h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: var(--pipeline-primary);
        }

        .insight-item p {
            margin: 0;
            line-height: 1.6;
            color: var(--color-text-secondary);
        }

        /* 缺口提示 */
        .gaps-section {
            background: linear-gradient(45deg, #FFF3CD, #F8D7DA);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .gap-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-top: var(--space-2);
        }

        .gap-tag {
            background: #FFF;
            color: #721C24;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* 角色建议 */
        .roles-suggestion {
            background: linear-gradient(135deg, #E3F2FD, #F3E5F5);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .role-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .role-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .role-name {
            font-weight: 600;
            color: var(--pipeline-primary);
        }

        .role-type-badge {
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 500;
            background: var(--role-need);
            color: white;
        }

        .role-script {
            background: rgba(102, 126, 234, 0.05);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            font-style: italic;
            margin-top: var(--space-2);
            border-left: 3px solid var(--pipeline-primary);
        }

        /* 管道卡片 */
        .pipeline-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .pipeline-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--framework-gradient);
        }

        .pipeline-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
        }

        .pipeline-title-section {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .pipeline-id {
            background: var(--framework-gradient);
            color: white;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: var(--text-sm);
        }

        .pipeline-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-text-primary);
            margin: 0;
        }

        .income-mechanism {
            text-align: right;
            padding: var(--space-3);
            background: linear-gradient(45deg, #E8F5E8, #FFF9C4);
            border-radius: var(--radius-lg);
            border: 2px solid var(--framework-accent);
        }

        .income-type {
            font-weight: 600;
            color: var(--framework-accent);
            font-size: 1.1rem;
            margin-bottom: var(--space-1);
        }

        .income-trigger {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-1);
        }

        .income-settlement {
            font-size: var(--text-xs);
            color: var(--color-text-secondary);
        }

        /* 参与方结构 */
        .parties-section {
            margin: var(--space-8) 0;
        }

        .parties-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: var(--space-6);
            color: var(--color-text-primary);
        }

        .parties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-4);
        }

        .party-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            position: relative;
            transition: all 0.3s ease;
        }

        .party-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .party-card.role-需求方 { border-color: var(--role-need); }
        .party-card.role-交付方 { border-color: var(--role-deliver); }
        .party-card.role-资金方 { border-color: var(--role-fund); }
        .party-card.role-统筹方 { 
            border-color: var(--role-coordinate);
            background: linear-gradient(135deg, #F8F9FA, #E8F5E8);
        }

        .party-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .party-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--color-text-primary);
        }

        .party-role-badge {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 600;
            color: white;
        }

        .party-role-badge.需求方 { background: var(--role-need); }
        .party-role-badge.交付方 { background: var(--role-deliver); }
        .party-role-badge.资金方 { background: var(--role-fund); }
        .party-role-badge.统筹方 { background: var(--role-coordinate); }

        .party-content {
            line-height: 1.6;
        }

        .party-section {
            margin-bottom: var(--space-3);
        }

        .party-section-title {
            font-weight: 600;
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .resources-list {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-1);
        }

        .resource-tag {
            background: rgba(102, 126, 234, 0.1);
            color: var(--pipeline-primary);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        /* 框架逻辑 */
        .framework-logic {
            background: linear-gradient(135deg, #FFF8E1, #F3E5F5);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin: var(--space-6) 0;
            border: 2px solid var(--framework-accent);
        }

        .framework-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: var(--space-4);
            color: var(--framework-accent);
        }

        .framework-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-4);
        }

        .framework-item {
            background: white;
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .framework-item h5 {
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: var(--framework-accent);
            font-size: var(--text-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* MVP 和其他关键信息 */
        .key-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-4);
            margin: var(--space-6) 0;
        }

        .info-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .info-card-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-weight: 600;
            margin-bottom: var(--space-3);
            color: var(--color-text-primary);
        }

        .info-card-header i {
            color: var(--pipeline-primary);
            font-size: 1.2rem;
        }

        /* 风险和方案 */
        .risks-section {
            background: linear-gradient(135deg, #FFF3E0, #FFEBEE);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin: var(--space-6) 0;
        }

        .risk-item {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .risk-header {
            font-weight: 600;
            color: #D32F2F;
            margin-bottom: var(--space-2);
        }

        .risk-mitigation {
            color: var(--color-text-secondary);
            padding-left: var(--space-4);
            border-left: 3px solid #4CAF50;
            background: rgba(76, 175, 80, 0.05);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
        }

        /* 劳动量估算 */
        .labor-estimate {
            background: linear-gradient(135deg, #E8F5E8, #E3F2FD);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .labor-level {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            background: var(--framework-gradient);
            color: white;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            font-weight: 600;
            margin: var(--space-2) 0;
        }

        /* 操作按钮 */
        .action-buttons {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
            margin-top: var(--space-8);
            flex-wrap: wrap;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-full);
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .action-btn.primary {
            background: var(--framework-gradient);
            color: white;
        }

        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.9);
            color: var(--pipeline-primary);
            border: 2px solid var(--pipeline-primary);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-container {
                padding: var(--space-4) var(--space-2);
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .page-header {
                margin-bottom: var(--space-2);
                padding: var(--space-2) var(--space-2);
            }
            
            .main-container {
                margin-top: 70px;
                padding: var(--space-1) var(--space-2);
            }
            
            .formula-display {
                font-size: 0.8rem;
                padding: var(--space-1) var(--space-2);
            }
            
            .pipeline-name {
                font-size: 1.5rem;
            }
            
            .framework-grid {
                grid-template-columns: 1fr;
            }
            
            .pipeline-header {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-4);
            }
            
            .parties-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 动画效果 */
        .fade-in-up {
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .animate-delay-1 { animation-delay: 0.1s; }
        .animate-delay-2 { animation-delay: 0.2s; }
        .animate-delay-3 { animation-delay: 0.3s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- 引用公共导航栏组件 -->
    {% include 'components/navigation.html' %}

    <!-- 主内容 -->
    <div class="main-container">
        <!-- 页面标题 -->
        <div class="page-header fade-in-up">
            <h1 class="page-title">
                <i class="fas fa-sitemap"></i>
                非劳务收入管道设计方案
            </h1>
            <div class="page-subtitle">基于框架性思维的系统化收入管道构建</div>
            <div class="formula-display">
                <span>意识</span> <i class="fas fa-plus"></i>
                <span>能量</span> <i class="fas fa-plus"></i>
                <span>能力</span> <i class="fas fa-equals"></i>
                <span>结果</span>
            </div>
        </div>

        <!-- 整体分析概览 -->
        {% if result and result.overview %}
        <div class="overview-card fade-in-up animate-delay-1">
            <div class="overview-header">
                <i class="fas fa-eye"></i>
                整体局势分析
            </div>
            
            <div class="insight-grid">
                <div class="insight-item">
                    <h4><i class="fas fa-chess-board"></i> 当前局势</h4>
                    <p>{{ result.overview.situation }}</p>
                </div>
                <div class="insight-item">
                    <h4><i class="fas fa-coins"></i> 收入类型</h4>
                    <p>{{ result.overview.income_type }}</p>
                </div>
                <div class="insight-item">
                    <h4><i class="fas fa-lightbulb"></i> 核心洞察</h4>
                    <p>{{ result.overview.core_insight }}</p>
                </div>
            </div>

            <!-- 缺口提示 -->
            {% if result.overview.gaps %}
            <div class="gaps-section">
                <h4><i class="fas fa-exclamation-triangle"></i> 需要完善的环节</h4>
                <div class="gap-tags">
                    {% for gap in result.overview.gaps %}
                    <span class="gap-tag">{{ gap }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- 角色建议 -->
            {% if result.overview.suggested_roles_to_hunt %}
            <div class="roles-suggestion">
                <h4><i class="fas fa-user-plus"></i> 建议寻找的关键角色</h4>
                {% for role in result.overview.suggested_roles_to_hunt %}
                <div class="role-card">
                    <div class="role-header">
                        <span class="role-name">{{ role.role }}</span>
                        <span class="role-type-badge">{{ role.role_type }}</span>
                    </div>
                    <div style="margin-bottom: var(--space-2);">
                        <strong>为什么需要：</strong>{{ role.why }}
                    </div>
                    <div style="margin-bottom: var(--space-2);">
                        <strong>去哪里找：</strong>{{ role.where_to_find }}
                    </div>
                    <div class="role-script">
                        <strong>开场话术：</strong>"{{ role.outreach_script }}"
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- 管道方案 -->
        {% if result and result.pipelines %}
        {% for pipeline in result.pipelines %}
        <div class="pipeline-card fade-in-up animate-delay-{{ loop.index + 1 }}">
            <!-- 管道标题 -->
            <div class="pipeline-header">
                <div class="pipeline-title-section">
                    <div class="pipeline-id">
                        {% if pipeline.id and not pipeline.id.startswith('pipeline_') %}
                            {{ pipeline.id }}
                        {% else %}
                            管道{{ ['一', '二', '三', '四', '五'][loop.index0] if loop.index0 < 5 else loop.index|string }}
                        {% endif %}
                    </div>
                    <h2 class="pipeline-name">{{ pipeline.name }}</h2>
                </div>
                {% if pipeline.income_mechanism %}
                <div class="income-mechanism">
                    <div class="income-type">
                        <i class="fas fa-money-bill-wave"></i>
                        {{ pipeline.income_mechanism.type }}
                    </div>
                    <div class="income-trigger">{{ pipeline.income_mechanism.trigger }}</div>
                    <div class="income-settlement">{{ pipeline.income_mechanism.settlement }}</div>
                </div>
                {% endif %}
            </div>

            <!-- 参与方结构 -->
            {% if pipeline.parties_structure %}
            <div class="parties-section">
                <div class="parties-title">
                    <i class="fas fa-users"></i>
                    关键参与方结构
                </div>
                <div class="parties-grid">
                    {% for party in pipeline.parties_structure %}
                    <div class="party-card role-{{ party.role_type }}">
                        <div class="party-header">
                            <div class="party-name">{{ party.party }}</div>
                            <div class="party-role-badge {{ party.role_type }}">{{ party.role_type }}</div>
                        </div>
                        <div class="party-content">
                            <div class="party-section">
                                <div class="party-section-title">提供资源</div>
                                <div class="resources-list">
                                    {% for resource in party.resources %}
                                    <span class="resource-tag">{{ resource }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="party-section">
                                <div class="party-section-title">在闭环中的价值</div>
                                <div>{{ party.role_value }}</div>
                            </div>
                            <div class="party-section">
                                <div class="party-section-title">如何让TA高兴</div>
                                <div>{{ party.make_them_happy }}</div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- 框架逻辑 -->
            {% if pipeline.framework_logic %}
            <div class="framework-logic">
                <div class="framework-title">
                    <i class="fas fa-project-diagram"></i>
                    框架逻辑设计
                </div>
                <div class="framework-grid">
                    <div class="framework-item">
                        <h5><i class="fas fa-link"></i> 资源串联链条</h5>
                        <p>{{ pipeline.framework_logic.resource_chain }}</p>
                    </div>
                    <div class="framework-item">
                        <h5><i class="fas fa-heart"></i> 动机匹配</h5>
                        <p>{{ pipeline.framework_logic.motivation_match }}</p>
                    </div>
                    <div class="framework-item">
                        <h5><i class="fas fa-shield-alt"></i> 设计者地位</h5>
                        <p>{{ pipeline.framework_logic.designer_position }}</p>
                    </div>
                    <div class="framework-item">
                        <h5><i class="fas fa-piggy-bank"></i> 设计者收益</h5>
                        <p>{{ pipeline.framework_logic.designer_income }}</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 关键信息网格 -->
            <div class="key-info-grid">
                {% if pipeline.mvp %}
                <div class="info-card">
                    <div class="info-card-header">
                        <i class="fas fa-rocket"></i>
                        最小闭环（MVP）
                    </div>
                    <p>{{ pipeline.mvp }}</p>
                </div>
                {% endif %}

                {% if pipeline.weak_link %}
                <div class="info-card">
                    <div class="info-card-header">
                        <i class="fas fa-chain-broken"></i>
                        最脆弱环节
                    </div>
                    <p>{{ pipeline.weak_link }}</p>
                </div>
                {% endif %}

                {% if pipeline.revenue_trigger %}
                <div class="info-card">
                    <div class="info-card-header">
                        <i class="fas fa-bolt"></i>
                        收益触发点
                    </div>
                    <p>{{ pipeline.revenue_trigger }}</p>
                </div>
                {% endif %}

                {% if pipeline.first_step %}
                <div class="info-card">
                    <div class="info-card-header">
                        <i class="fas fa-play"></i>
                        启动第一步
                    </div>
                    <p>{{ pipeline.first_step }}</p>
                </div>
                {% endif %}
            </div>

            <!-- 风险与应对方案 -->
            {% if pipeline.risks_and_planB %}
            <div class="risks-section">
                <h4><i class="fas fa-exclamation-triangle"></i> 风险分析与应对方案</h4>
                {% for risk in pipeline.risks_and_planB %}
                <div class="risk-item">
                    <div class="risk-header">
                        <i class="fas fa-warning"></i>
                        {{ risk.risk }}
                    </div>
                    <div class="risk-mitigation">
                        <i class="fas fa-shield-check"></i>
                        {{ risk.mitigation }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- 劳动量估算 -->
            {% if pipeline.labor_load_estimate %}
            <div class="labor-estimate">
                <h4><i class="fas fa-clock"></i> 劳动量估算</h4>
                <div>
                    <strong>每周投入：</strong>{{ pipeline.labor_load_estimate.hours_per_week }} 小时/周
                </div>
                <div class="labor-level">
                    <i class="fas fa-gauge-high"></i>
                    {{ pipeline.labor_load_estimate.level.replace('<5h', '<5小时').replace('5-10h', '5-10小时').replace('>10h', '>10小时') }}
                </div>
                <div style="margin-top: var(--space-3); font-size: var(--text-sm); color: var(--color-text-secondary);">
                    <strong>降低劳动量方案：</strong>{{ pipeline.labor_load_estimate.alternative }}
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
        {% endif %}

        <!-- 操作按钮 -->
        <div class="action-buttons fade-in-up">
            <button class="action-btn primary" onclick="exportToPDF()">
                <i class="fas fa-download"></i>
                导出PDF
            </button>
            <a href="{{ url_for('index') }}" class="action-btn secondary">
                <i class="fas fa-plus"></i>
                设计新管道
            </a>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/user-menu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mobile-menu.js') }}"></script>
    <script>
        // PDF导出功能
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // 添加中文字体支持
            doc.setFont("helvetica");
            doc.setFontSize(16);
            doc.text("非劳务收入管道设计方案", 20, 20);
            
            // 使用html2canvas截图
            const element = document.querySelector('.main-container');
            const canvas = await html2canvas(element, {
                scale: 1,
                useCORS: true,
                allowTaint: true
            });
            
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 190;
            const pageHeight = 297;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            let position = 30;
            
            doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= pageHeight - position;
            
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight + 30;
                doc.addPage();
                doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }
            
            doc.save('非劳务收入管道设计方案.pdf');
        }
        
        
        
        // 页面加载动画
        document.addEventListener('DOMContentLoaded', function() {
            const elements = document.querySelectorAll('.fade-in-up');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationPlayState = 'running';
                    }
                });
            });
            
            elements.forEach(el => {
                observer.observe(el);
                el.style.animationPlayState = 'paused';
            });
        });
    </script>
</body>
</html>