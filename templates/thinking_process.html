<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angela AIæ­£åœ¨æ€è€ƒä¸­... - Matrix Analysis</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #00ff41;
            font-family: 'Fira Code', 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
        }
        
        /* Sci-Fi Background Effect */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at center, rgba(0, 255, 65, 0.08) 0%, transparent 50%),
                linear-gradient(45deg, #000000 25%, #001100 25%, #001100 50%, #000000 50%, #000000 75%, #001100 75%),
                linear-gradient(180deg, #000000 0%, #002200 50%, #000500 100%);
            background-size: 300px 300px, 60px 60px, 100% 100%;
            animation: bg-shift 25s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        .matrix-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(0, 255, 65, 0.02) 50%, transparent 100%);
            animation: scan-sweep 12s linear infinite;
        }
        

        
        @keyframes bg-shift {
            0%, 100% {
                background-position: 0px 0px, 0px 0px, 0% 0%;
            }
            50% {
                background-position: 60px 60px, 30px 30px, 0% 0%;
            }
        }
        
        @keyframes scan-sweep {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Main Container */
        .thinking-container {
            position: relative;
            z-index: 10 !important;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: transparent;
            pointer-events: auto;
        }
        
        /* Header */
        .ai-header {
            text-align: center;
            margin-bottom: 40px;
            animation: glow-pulse 2s ease-in-out infinite alternate;
            z-index: 15;
            position: relative;
        }
        
        .ai-title {
            font-size: 3.5rem;
            font-weight: 500;
            text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            margin-bottom: 10px;
            letter-spacing: 3px;
        }
        
        .ai-subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .brain-icon {
            font-size: 4rem;
            animation: brain-pulse 1.5s ease-in-out infinite;
            text-shadow: 0 0 30px #00ff41;
        }
        
        /* Thinking Process Display */
        .thinking-display {
            width: 90%;
            max-width: 900px;
            height: 500px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.3);
            backdrop-filter: blur(2px);
            z-index: 15;
        }
        
        .thinking-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 65, 0.1), transparent);
            animation: scan-line 3s linear infinite;
        }
        
        @keyframes scan-line {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Terminal Header */
        .terminal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #00ff41;
        }
        
        .terminal-buttons {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }
        
        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff5f56;
        }
        
        .terminal-button:nth-child(2) {
            background: #ffbd2e;
        }
        
        .terminal-button:nth-child(3) {
            background: #27ca3f;
        }
        
        .terminal-title {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* Thinking Content */
        .thinking-content {
            height: 400px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.4;
            position: relative;
            z-index: 5;
        }
        
        .thinking-line {
            margin-bottom: 8px;
            opacity: 0;
            animation: type-in 0.5s ease-out forwards;
        }
        
        .thinking-line.system {
            color: #00ff41;
        }
        
        .thinking-line.process {
            color: #40ff40;
            margin-left: 20px;
        }
        
        .thinking-line.analysis {
            color: #80ff80;
            margin-left: 40px;
        }
        
        .thinking-line.conclusion {
            color: #00ff41;
            font-weight: 500;
            margin-left: 20px;
        }
        
        .cursor {
            animation: blink 1s infinite;
        }
        
        @keyframes type-in {
            0% {
                opacity: 0;
                transform: translateX(-10px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes blink {
            0%, 50% {
                opacity: 1;
            }
            51%, 100% {
                opacity: 0;
            }
        }
        
        @keyframes glow-pulse {
            0% {
                text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            }
            100% {
                text-shadow: 0 0 30px #00ff41, 0 0 60px #00ff41, 0 0 80px #00ff41;
            }
        }
        
        @keyframes brain-pulse {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.1);
                filter: brightness(1.3);
            }
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px 20px;
            border: 1px solid #00ff41;
            border-radius: 25px;
            z-index: 100;
            margin-bottom: 20px;
            max-width: 400px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff41;
            animation: pulse-dot 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% {
                opacity: 0.5;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .matrix-column {
                font-size: 8px;
                line-height: 1.0;
            }
            
            .ai-title {
                font-size: 2rem;
            }
            
            .ai-subtitle {
                font-size: 1rem;
            }
            
            .thinking-display {
                width: 95%;
                height: 350px;
                padding: 12px;
            }
            
            .thinking-content {
                height: 270px;
                font-size: 11px;
                line-height: 1.3;
            }
            
            .terminal-header {
                margin-bottom: 15px;
            }
            
            .terminal-title {
                font-size: 12px;
            }
            
            .status-bar {
                bottom: 10px;
                padding: 8px 16px;
            }
        }
        
        @media (max-width: 480px) {
            .matrix-column {
                font-size: 6px;
                line-height: 0.9;
            }
            
            .thinking-container {
                padding: 10px;
            }
            
            .ai-title {
                font-size: 1.5rem;
            }
            
            .ai-subtitle {
                font-size: 0.8rem;
            }
            
            .thinking-display {
                height: 300px;
                padding: 10px;
            }
            
            .thinking-content {
                height: 220px;
                font-size: 10px;
            }
            
            .terminal-title {
                font-size: 10px;
            }
            
            .status-bar {
                padding: 6px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Layer -->
    <div class="matrix-bg" id="matrixBg"></div>
    
    <!-- Content Layer -->
    <div class="thinking-container">
        <!-- Header -->
        <div class="ai-header">
            <div class="brain-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h1 class="ai-title">ANGELA AI</h1>
            <p class="ai-subtitle">Neural Network Analysis In Progress...</p>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">åˆå§‹åŒ–ç¥ç»ç½‘ç»œ...</span>
            </div>
            <div class="status-indicator">
                <span id="progressText">0%</span>
            </div>
        </div>
        
        <!-- Main Thinking Display -->
        <div class="thinking-display">
            <div class="terminal-header">
                <div class="terminal-buttons">
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                </div>
                <div class="terminal-title">angela_ai_core.py - Neural Analysis Terminal</div>
            </div>
            
            <div class="thinking-content" id="thinkingContent">
                <!-- Thinking process will be inserted here dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Simple Sci-Fi Background Effect  
        function createSciFiBackground() {
            const matrixBg = document.getElementById('matrixBg');
            if (!matrixBg) {
                console.error('Background element not found!');
                return;
            }
            
            console.log('Sci-fi background initialized');
        }
            

        
        // AI Thinking Process with Real Backend Sync
        const genericThinkingSteps = [
            { type: 'system', text: '>>> å¯åŠ¨ Angela AI ç¥ç»ç½‘ç»œåˆ†æå¼•æ“...', duration: 800 },
            { type: 'system', text: '>>> åŠ è½½éåŠ³åŠ¡æ”¶å…¥çŸ¥è¯†åº“... [âœ“]', duration: 600 },
            { type: 'system', text: '>>> åˆå§‹åŒ–é¡¹ç›®åˆ†ææ¨¡å—... [âœ“]', duration: 500 },
            { type: 'process', text: 'def analyze_project_data():', duration: 400 },
            { type: 'analysis', text: '# è§£æé¡¹ç›®èƒŒæ™¯å’Œæ ¸å¿ƒé—®é¢˜...', duration: 800 },
            { type: 'analysis', text: '# è¯†åˆ«å…³é”®åˆ©ç›Šç›¸å…³æ–¹...', duration: 700 },
            { type: 'analysis', text: '# æ£€æµ‹æ½œåœ¨å•†ä¸šæœºä¼š...', duration: 600 },
            { type: 'process', text: 'def evaluate_key_persons():', duration: 400 },
            { type: 'analysis', text: '# åˆ†æå…³é”®äººç‰©èµ„æºé…ç½®...', duration: 900 },
            { type: 'analysis', text: '# è¯„ä¼°èµ„æºåŒ¹é…åº¦å’ŒååŒæ½œåŠ›...', duration: 800 },
            { type: 'process', text: 'def search_income_patterns():', duration: 400 },
            { type: 'analysis', text: '# æŸ¥è¯¢çŸ¥è¯†åº“ä¸­çš„æˆåŠŸæ¡ˆä¾‹...', duration: 1000 },
            { type: 'analysis', text: '# åŒ¹é…é€‚åˆçš„æ”¶å…¥æ¨¡å¼ç±»å‹...', duration: 900 },
            { type: 'analysis', text: '# è¯†åˆ«æ ¸å¿ƒä»·å€¼åˆ›é€ æœºåˆ¶...', duration: 700 },
            { type: 'process', text: 'def design_revenue_pipeline():', duration: 400 },
            { type: 'analysis', text: '# è®¾è®¡ä¸‰æ–¹åŠä»¥ä¸Šé—­ç¯ç»“æ„...', duration: 1200 },
            { type: 'analysis', text: '# åˆ¶å®šå…·ä½“æ”¶å…¥è§¦å‘æœºåˆ¶...', duration: 800 },
            { type: 'analysis', text: '# è®¾è®¡MVPéªŒè¯æ–¹æ¡ˆ...', duration: 600 },
            { type: 'process', text: 'def generate_action_plan():', duration: 400 },
            { type: 'analysis', text: '# åˆ¶å®šè¯¦ç»†æ‰§è¡Œæ­¥éª¤...', duration: 1000 },
            { type: 'analysis', text: '# è®¾è®¡é£é™©é˜²æ§æªæ–½...', duration: 700 },
            { type: 'analysis', text: '# è¯„ä¼°è§„æ¨¡åŒ–æ‰©å±•æ½œåŠ›...', duration: 600 }
        ];
        
        let currentStep = 0;
        let startTime = Date.now();
        let analysisStarted = false;
        let realAnalysisCompleted = false;
        
        function addThinkingLine(text, type) {
            const content = document.getElementById('thinkingContent');
            const line = document.createElement('div');
            line.className = `thinking-line ${type}`;
            line.textContent = text;
            content.appendChild(line);
            
            // Auto scroll to bottom
            content.scrollTop = content.scrollHeight;
            
            // Add cursor effect to last line
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            cursor.textContent = 'â–ˆ';
            line.appendChild(cursor);
            
            // Remove cursor from previous line
            const prevLines = content.querySelectorAll('.thinking-line');
            if (prevLines.length > 1) {
                const prevCursor = prevLines[prevLines.length - 2].querySelector('.cursor');
                if (prevCursor) {
                    prevCursor.remove();
                }
            }
        }
        
        function updateStatusDisplay(realProgress = null, realStage = null) {
            let displayProgress, displayStage;
            
            if (realProgress !== null && window.realProgressStarted) {
                // ä½¿ç”¨çœŸå®è¿›åº¦
                displayProgress = realProgress;
                displayStage = realStage || 'åˆ†ææ­£åœ¨è¿›è¡Œä¸­...';
            } else {
                // ä½¿ç”¨æ¨¡æ‹Ÿè¿›åº¦ï¼Œå…è®¸è¾¾åˆ°100%
                const simulationProgress = Math.min((currentStep / genericThinkingSteps.length) * 100, 100);
                
                if (window.realProgressStarted && realProgress !== null) {
                    // æ··åˆæ¨¡å¼ï¼šä½¿ç”¨çœŸå®è¿›åº¦ï¼Œä½†ä¿æŒæ¨¡æ‹Ÿçš„é˜¶æ®µæè¿°æµç•…æ€§
                    displayProgress = Math.max(simulationProgress, realProgress);
                } else {
                    displayProgress = simulationProgress;
                }
                
                // ä½¿ç”¨æ¨¡æ‹Ÿé˜¶æ®µä¿¡æ¯ï¼ˆæ›´ä¸°å¯Œçš„æè¿°ï¼‰
                if (displayProgress < 15) {
                    displayStage = 'åˆå§‹åŒ–ç¥ç»ç½‘ç»œ...';
                } else if (displayProgress < 25) {
                    displayStage = 'è§£æé¡¹ç›®æ•°æ®ä¸­...';
                } else if (displayProgress < 35) {
                    displayStage = 'åˆ†æå…³é”®äººç‰©èµ„æº...';
                } else if (displayProgress < 45) {
                    displayStage = 'è¯†åˆ«èµ„æºè¿æ¥ç‚¹...';
                } else if (displayProgress < 55) {
                    displayStage = 'åŒ¹é…æ”¶å…¥æ¨¡å¼ä¸­...';
                } else if (displayProgress < 65) {
                    displayStage = 'è®¾è®¡æ”¶å…¥ç®¡é“...';
                } else if (displayProgress < 75) {
                    displayStage = 'ä¼˜åŒ–ä¸‰æ–¹ç»“æ„...';
                } else if (displayProgress < 85) {
                    displayStage = 'ç”Ÿæˆæ‰§è¡Œæ–¹æ¡ˆ...';
                } else if (displayProgress < 95) {
                    displayStage = 'ç”Ÿæˆåˆ†ææŠ¥å‘Š...';
                } else {
                    displayStage = 'åˆ†æå®Œæˆï¼';
                }
                
                // å¦‚æœæœ‰çœŸå®é˜¶æ®µä¿¡æ¯ä¸”çœŸå®è¿›åº¦å·²å¼€å§‹ï¼Œä¼˜å…ˆä½¿ç”¨çœŸå®é˜¶æ®µ
                if (realStage && window.realProgressStarted) {
                    displayStage = realStage;
                }
            }
            
            document.getElementById('progressText').textContent = Math.round(displayProgress) + '%';
            document.getElementById('statusText').textContent = displayStage;
        }
        
        function showGenericThinking() {
            if (currentStep < genericThinkingSteps.length && !realAnalysisCompleted) {
                const step = genericThinkingSteps[currentStep];
                
                addThinkingLine(step.text, step.type);
                
                // å¦‚æœæœ‰çœŸå®è¿›åº¦ï¼Œä½¿ç”¨çœŸå®è¿›åº¦ï¼›å¦åˆ™ä½¿ç”¨æ¨¡æ‹Ÿè¿›åº¦
                if (!window.realProgressStarted) {
                    updateStatusDisplay();
                }
                currentStep++;
                
                // ç»§ç»­æ˜¾ç¤ºæ€è€ƒæ­¥éª¤ï¼Œä½†å½“æœ‰çœŸå®è¿›åº¦æ—¶è°ƒæ•´é€Ÿåº¦
                const delay = window.realProgressStarted ? Math.min(step.duration, 1000) : step.duration;
                setTimeout(showGenericThinking, delay);
            } else if (!realAnalysisCompleted) {
                // æ¨¡æ‹Ÿæ­¥éª¤å®Œæˆï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦å¼ºåˆ¶å®Œæˆ
                const currentProgress = Math.min((currentStep / genericThinkingSteps.length) * 100, 100);
                if (currentProgress >= 100 && !window.forceCompletionTriggered) {
                    window.forceCompletionTriggered = true;
                    addThinkingLine('>>> âœ… åˆ†æå®Œæˆï¼æ­£åœ¨è·³è½¬...', 'conclusion');
                    updateStatusDisplay(100, 'åˆ†æå®Œæˆï¼');
                    setTimeout(() => {
                        window.location.href = '/results';
                    }, 2000);
                } else {
                    // ç»§ç»­æ˜¾ç¤ºç­‰å¾…ä¿¡æ¯
                    addThinkingLine('# æ·±åº¦åˆ†æä¸­ï¼Œè¯·ç¨å€™...', 'analysis');
                    setTimeout(showGenericThinking, 2000);
                }
            }
        }
        
        // Real backend analysis polling with synchronized display
        function startRealAnalysisPolling() {
            let pollCount = 0;
            const maxPolls = 60; // Maximum 1 minute pollingï¼Œç¼©çŸ­è½®è¯¢æ—¶é—´
            
            function poll() {
                pollCount++;
                console.log(`Polling real analysis status, attempt: ${pollCount}`);
                
                fetch('/check_analysis_status')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Real analysis status:', data);
                        
                        if (data.status === 'completed' && data.redirect_url) {
                            // åç«¯åˆ†æå®Œæˆï¼Œç«‹å³å¤„ç†è·³è½¬
                            realAnalysisCompleted = true;
                            console.log('åˆ†æå®Œæˆï¼Œå‡†å¤‡è·³è½¬åˆ°:', data.redirect_url);
                            
                            addThinkingLine('>>> âœ… åˆ†æå®Œæˆï¼æ£€æµ‹åˆ°ä¸“ä¸šæ”¶å…¥ç®¡é“æ–¹æ¡ˆ', 'conclusion');
                            updateStatusDisplay(100);
                            
                            addThinkingLine('>>> ğŸš€ æ­£åœ¨è·³è½¬åˆ°ç»“æœé¡µé¢...', 'system');
                            console.log('æ‰§è¡Œè·³è½¬...');
                            
                            // ç›´æ¥è·³è½¬ï¼Œå‡å°‘å»¶è¿Ÿ
                            setTimeout(() => {
                                window.location.href = data.redirect_url;
                            }, 1000);
                            
                        } else if (data.status === 'error' || data.status === 'timeout') {
                            realAnalysisCompleted = true;
                            if (data.status === 'timeout') {
                                addThinkingLine('>>> â° ç½‘ç»œè¿æ¥è¶…æ—¶ï¼Œå¯ç”¨å¤‡ç”¨æ–¹æ¡ˆ', 'system');
                                addThinkingLine('>>> ğŸ”„ æ­£åœ¨ç”ŸæˆåŸºç¡€å»ºè®®...', 'system');
                                // å¯¹äºè¶…æ—¶ï¼Œä»ç„¶è·³è½¬åˆ°ç»“æœé¡µé¢ï¼Œåç«¯ä¼šå¤„ç†å¤‡ç”¨æ–¹æ¡ˆ
                                updateStatusDisplay(100, 'åˆ†æå®Œæˆï¼');
                                setTimeout(() => {
                                    addThinkingLine('>>> âœ… è·³è½¬åˆ°ç»“æœé¡µé¢...', 'conclusion');
                                    setTimeout(() => {
                                        window.location.href = '/results';
                                    }, 1000);
                                }, 2000);
                            } else if (data.error_code === 'NO_FORM_DATA') {
                                addThinkingLine('>>> ğŸ”„ æ£€æµ‹åˆ°ä¼šè¯ä¸­æ–­ï¼Œé‡æ–°åˆå§‹åŒ–...', 'system');
                                // å¦‚æœæ˜¯NO_FORM_DATAé”™è¯¯ï¼Œè¿”å›é¦–é¡µé‡æ–°å¼€å§‹
                                setTimeout(() => {
                                    window.location.href = '/';
                                }, 2000);
                                return;
                            } else {
                                addThinkingLine('>>> âŒ åˆ†æè¿‡ç¨‹é‡åˆ°é—®é¢˜', 'system');
                                addThinkingLine(`>>> ${data.message || 'æœªçŸ¥é”™è¯¯'}`, 'system');
                                
                                // å¯¹äºä¸€èˆ¬é”™è¯¯ï¼Œä¹Ÿè·³è½¬åˆ°ç»“æœé¡µé¢æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                                setTimeout(() => {
                                    addThinkingLine('>>> ğŸš€ è·³è½¬åˆ°ç»“æœé¡µé¢...', 'system');
                                    setTimeout(() => {
                                        window.location.href = '/results';
                                    }, 1000);
                                }, 2000);
                            }
                            
                        } else if (data.status === 'processing') {
                            // æ ‡è®°çœŸå®è¿›åº¦å·²å¼€å§‹
                            window.realProgressStarted = true;
                            
                            // ä½¿ç”¨åç«¯çœŸå®è¿›åº¦ä¿¡æ¯
                            const progress = data.progress || Math.min(80 + (pollCount / maxPolls * 15), 95);
                            const stage = data.stage || data.message || 'åˆ†ææ­£åœ¨è¿›è¡Œä¸­...';
                            updateStatusDisplay(progress, stage); // åŒæ—¶æ›´æ–°è¿›åº¦å’Œé˜¶æ®µä¿¡æ¯
                            
                            // æ ¹æ®çœŸå®è¿›åº¦æ·»åŠ å…³é”®èŠ‚ç‚¹çš„æ€è€ƒè¡Œï¼ˆä¸å¹²æ‰°å¸¸è§„æ¨¡æ‹Ÿæ­¥éª¤ï¼‰
                            if (progress >= 50 && !window.stage50Shown) {
                                addThinkingLine('>>> ğŸ§  AIæ ¸å¿ƒå¼•æ“å·²æ¿€æ´»ï¼Œå¼€å§‹æ·±åº¦åˆ†æ...', 'system');
                                window.stage50Shown = true;
                            }
                            if (progress >= 90 && !window.stage90Shown) {
                                addThinkingLine('>>> âš¡ AIåˆ†æå¼•æ“å®Œæˆæ ¸å¿ƒè®¡ç®—...', 'system');
                                window.stage90Shown = true;
                            }
                            
                            if (pollCount < maxPolls) {
                                setTimeout(poll, 500); // æ›´é¢‘ç¹çš„è½®è¯¢ï¼Œå‡å°‘å»¶è¿Ÿ
                            } else {
                                addThinkingLine('>>> â° åˆ†æè¶…æ—¶ï¼Œæ­£åœ¨è·³è½¬...', 'system');
                                setTimeout(() => {
                                    window.location.href = '/results';
                                }, 2000);
                            }
                            
                        } else {
                            // Status is 'not_started' or other - trigger analysis start
                            if (pollCount < maxPolls) {
                                setTimeout(poll, 1000);
                            } else {
                                addThinkingLine('>>> â° è¿æ¥è¶…æ—¶ï¼Œæ­£åœ¨é‡è¯•...', 'system');
                                // è¶…æ—¶åï¼Œå¼ºåˆ¶æ˜¾ç¤ºå®ŒæˆçŠ¶æ€å¹¶è·³è½¬
                                updateStatusDisplay(100, 'åˆ†æå®Œæˆï¼');
                                addThinkingLine('>>> âœ… åˆ†æå®Œæˆï¼Œè·³è½¬åˆ°ç»“æœé¡µé¢...', 'conclusion');
                                setTimeout(() => {
                                    window.location.href = '/results';
                                }, 2000);
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Polling error:', error);
                        if (pollCount < maxPolls) {
                            setTimeout(poll, 3000); // Longer delay on error
                        } else {
                            addThinkingLine('>>> âš ï¸ ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ­£åœ¨è·³è½¬...', 'system');
                            setTimeout(() => {
                                window.location.href = '/results';
                            }, 2000);
                        }
                    });
            }
            
            // Start polling immediately
            poll();
        }
        
        // Initialize everything with synchronized analysis
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing sci-fi background and thinking process...');
            
            // Initialize simple sci-fi background
            createSciFiBackground();
            
            // Start thinking process immediately
            setTimeout(() => {
                console.log('Starting thinking process...');
                showGenericThinking();
            }, 100);
            
            // Start real analysis polling with shorter delay
            setTimeout(() => {
                console.log('Starting real analysis polling...');
                startRealAnalysisPolling();
            }, 2000); // ç¼©çŸ­å»¶è¿Ÿï¼Œæ›´å¿«å¼€å§‹çœŸå®åˆ†æ
        });
    </script>
</body>
</html>