<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angela AIæ­£åœ¨æ€è€ƒä¸­... - Matrix Analysis</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #00ff41;
            font-family: 'Fira Code', 'Courier New', monospace;
            overflow-x: hidden;
            overflow-y: auto;
            min-height: 100vh;
        }
        
        /* Sci-Fi Background Effect */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at center, rgba(0, 255, 65, 0.08) 0%, transparent 50%),
                linear-gradient(45deg, #000000 25%, #001100 25%, #001100 50%, #000000 50%, #000000 75%, #001100 75%),
                linear-gradient(180deg, #000000 0%, #002200 50%, #000500 100%);
            background-size: 300px 300px, 60px 60px, 100% 100%;
            animation: bg-shift 25s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        .matrix-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(0, 255, 65, 0.02) 50%, transparent 100%);
            animation: scan-sweep 12s linear infinite;
        }
        

        
        @keyframes bg-shift {
            0%, 100% {
                background-position: 0px 0px, 0px 0px, 0% 0%;
            }
            50% {
                background-position: 60px 60px, 30px 30px, 0% 0%;
            }
        }
        
        @keyframes scan-sweep {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Main Container */
        .thinking-container {
            position: relative;
            z-index: 100 !important;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: transparent;
            pointer-events: auto;
            padding-top: 40px;
        }
        
        /* Header */
        .ai-header {
            text-align: center;
            margin-bottom: 15px;
            animation: glow-pulse 2s ease-in-out infinite alternate;
            z-index: 200 !important;
            position: relative;
        }
        
        .ai-title {
            font-size: 2.8rem;
            font-weight: 500;
            text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        .ai-subtitle {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .brain-icon {
            font-size: 3rem;
            animation: brain-pulse 1.5s ease-in-out infinite;
            text-shadow: 0 0 30px #00ff41;
            margin-bottom: 8px;
        }
        
        /* Thinking Process Display */
        .thinking-display {
            width: 90%;
            max-width: 900px;
            height: 60vh;
            min-height: 400px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.3);
            backdrop-filter: blur(2px);
            z-index: 15;
            margin-bottom: 40px;
        }
        
        .thinking-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 65, 0.1), transparent);
            animation: scan-line 3s linear infinite;
        }
        
        @keyframes scan-line {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Terminal Header */
        .terminal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #00ff41;
        }
        
        .terminal-buttons {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }
        
        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff5f56;
        }
        
        .terminal-button:nth-child(2) {
            background: #ffbd2e;
        }
        
        .terminal-button:nth-child(3) {
            background: #27ca3f;
        }
        
        .terminal-title {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* Thinking Content */
        .thinking-content {
            height: calc(60vh - 120px);
            min-height: 320px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.4;
            position: relative;
            z-index: 5;
        }
        
        .thinking-line {
            margin-bottom: 1px; /* æœ€å°è¡Œé—´è· */
            opacity: 0;
            animation: type-in 0.5s ease-out forwards;
            line-height: 1.2; /* ç´§å‡‘è¡Œé«˜ */
            white-space: pre-line; /* ä¿æŒå¿…è¦çš„æ¢è¡Œä½†å»é™¤å¤šä½™ç©ºç™½ */
            word-wrap: break-word; /* é•¿å•è¯è‡ªåŠ¨æ¢è¡Œ */
        }
        
        /* ç¡®ä¿ç©ºè¡Œå’Œæ— å†…å®¹è¡Œè¢«å®Œå…¨éšè— - ä½†ä¿æŠ¤AIæ€è€ƒæµ */
        .thinking-line:empty:not(.ai-stream),
        .thinking-line[data-empty="true"]:not(.ai-stream) {
            display: none !important;
            height: 0;
            margin: 0;
            padding: 0;
        }
        
        /* é¢å¤–ä¿æŠ¤ï¼šç¡®ä¿æœ‰ç©ºç™½å†…å®¹çš„éAIæ€è€ƒæµå…ƒç´ è¢«éšè— */
        .thinking-line:not(.ai-stream):has(:empty),
        .thinking-line:not(.ai-stream)[data-content=""]:not([data-content="true"]) {
            display: none !important;
        }
        
        .thinking-line.system {
            color: #00ff41;
        }
        
        .thinking-line.process {
            color: #40ff40;
            margin-left: 20px;
        }
        
        .thinking-line.analysis {
            color: #80ff80;
            margin-left: 40px;
        }
        
        .thinking-line.conclusion {
            color: #00ff41;
            font-weight: 500;
            margin-left: 20px;
        }
        
        /* AIæ€è€ƒæµç‰¹æ®Šæ ·å¼ - ç¡®ä¿å¯è§æ€§å’Œçªå‡ºæ˜¾ç¤º */
        .thinking-line.ai-stream {
            color: #00d4ff !important;  /* å¼ºåˆ¶è“è‰²è°ƒï¼ŒåŒºåˆ«äºå…¶ä»–ç±»å‹ */
            margin-left: 20px;
            margin-bottom: 3px !important; /* ç¡®ä¿æœ‰è¶³å¤Ÿé—´è· */
            font-weight: 500 !important;
            border-left: 3px solid #00d4ff;
            padding-left: 15px;
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.15) 0%, transparent 100%) !important;
            border-radius: 0 8px 8px 0;
            position: relative;
            display: block !important; /* å¼ºåˆ¶æ˜¾ç¤º */
            visibility: visible !important; /* å¼ºåˆ¶å¯è§ */
            opacity: 1 !important; /* å¼ºåˆ¶ä¸é€æ˜ */
            min-height: 20px !important; /* ç¡®ä¿æœ€å°é«˜åº¦ */
            line-height: 1.4 !important;
        }
        
        .thinking-line.ai-stream::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(45deg, #00d4ff, #0066ff, #00d4ff);
            animation: stream-flow 1.5s linear infinite;
        }
        
        @keyframes ai-stream-glow {
            0% {
                text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
                box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
            }
            100% {
                text-shadow: 0 0 20px rgba(0, 212, 255, 0.8), 0 0 30px rgba(0, 212, 255, 0.4);
                box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
            }
        }
        
        @keyframes stream-flow {
            0% {
                background: linear-gradient(45deg, transparent, #00d4ff, transparent);
                transform: translateY(-100%);
            }
            50% {
                background: linear-gradient(45deg, #00d4ff, #0066ff, #00d4ff);
                transform: translateY(0%);
            }
            100% {
                background: linear-gradient(45deg, transparent, #00d4ff, transparent);
                transform: translateY(100%);
            }
        }
        
        .cursor {
            animation: blink 1s infinite;
        }
        
        @keyframes type-in {
            0% {
                opacity: 0;
                transform: translateX(-10px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes blink {
            0%, 50% {
                opacity: 1;
            }
            51%, 100% {
                opacity: 0;
            }
        }
        
        @keyframes glow-pulse {
            0% {
                text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            }
            100% {
                text-shadow: 0 0 30px #00ff41, 0 0 60px #00ff41, 0 0 80px #00ff41;
            }
        }
        
        @keyframes brain-pulse {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.1);
                filter: brightness(1.3);
            }
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 8px 16px;
            border: 1px solid #00ff41;
            border-radius: 25px;
            z-index: 100;
            margin-bottom: 15px;
            max-width: 400px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff41;
            animation: pulse-dot 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% {
                opacity: 0.5;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .matrix-column {
                font-size: 8px;
                line-height: 1.0;
            }
            
            .ai-title {
                font-size: 1.8rem;
            }
            
            .ai-subtitle {
                font-size: 0.9rem;
            }
            
            .brain-icon {
                font-size: 2.5rem;
                margin-bottom: 6px;
            }
            
            .ai-header {
                margin-bottom: 10px;
            }
            
            .thinking-display {
                width: 95%;
                height: 350px;
                padding: 12px;
            }
            
            .thinking-content {
                height: 270px;
                font-size: 11px;
                line-height: 1.3;
            }
            
            .terminal-header {
                margin-bottom: 15px;
            }
            
            .terminal-title {
                font-size: 12px;
            }
            
            .status-bar {
                bottom: 10px;
                padding: 8px 16px;
            }
        }
        
        @media (max-width: 480px) {
            .matrix-column {
                font-size: 6px;
                line-height: 0.9;
            }
            
            .thinking-container {
                padding: 10px;
            }
            
            .ai-title {
                font-size: 1.3rem;
            }
            
            .ai-subtitle {
                font-size: 0.75rem;
            }
            
            .brain-icon {
                font-size: 2rem;
                margin-bottom: 4px;
            }
            
            .ai-header {
                margin-bottom: 8px;
            }
            
            .thinking-display {
                height: 300px;
                padding: 10px;
            }
            
            .thinking-content {
                height: 220px;
                font-size: 10px;
            }
            
            .terminal-title {
                font-size: 10px;
            }
            
            .status-bar {
                padding: 6px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Layer -->
    <div class="matrix-bg" id="matrixBg"></div>
    
    <!-- Content Layer -->
    <div class="thinking-container">
        <!-- Header -->
        <div class="ai-header">
            <div class="brain-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h1 class="ai-title">ANGELA AI</h1>
            <p class="ai-subtitle">Neural Network Analysis In Progress...</p>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">åˆå§‹åŒ–ç¥ç»ç½‘ç»œ...</span>
            </div>
            <div class="status-indicator">
                <span id="progressText">0%</span>
            </div>
        </div>
        
        <!-- Main Thinking Display -->
        <div class="thinking-display">
            <div class="terminal-header">
                <div class="terminal-buttons">
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                </div>
                <div class="terminal-title">angela_ai_core.py - Neural Analysis Terminal</div>
            </div>
            
            <div class="thinking-content" id="thinkingContent">
                <!-- Thinking process will be inserted here dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Simple Sci-Fi Background Effect  
        function createSciFiBackground() {
            const matrixBg = document.getElementById('matrixBg');
            if (!matrixBg) {
                console.error('Background element not found!');
                return;
            }
            
            console.log('Sci-fi background initialized');
        }
            

        
        // Real AI Analysis Process - çœŸæ­£çš„AIåˆ†æè¿‡ç¨‹
        function generateRealThinkingSteps(projectData) {
            const projectName = projectData?.projectName || 'æ‚¨çš„é¡¹ç›®';
            const keyPersons = projectData?.keyPersons || [];
            const keyPersonsNames = keyPersons.map(p => p.name).join('ã€') || 'å…³é”®å‚ä¸è€…';
            
            return [
                { type: 'system', text: '>>> å¯åŠ¨ Angela AI éåŠ³åŠ¡æ”¶å…¥ç®¡é“åˆ†æå¼•æ“...', duration: 600 },
                { type: 'system', text: '>>> åŠ è½½æ ¸å¿ƒåŸç†ï¼šæ„è¯†+èƒ½é‡+èƒ½åŠ›=ç»“æœ [âœ“]', duration: 500 },
                { type: 'system', text: '>>> åˆå§‹åŒ–ä¸ƒå¤§æ”¶å…¥ç±»å‹æ¡†æ¶ [âœ“]', duration: 400 },
                { type: 'process', text: 'def analyze_project_structure():', duration: 300 },
                { type: 'analysis', text: `# æ­£åœ¨åˆ†æé¡¹ç›®ï¼š"${projectName}"`, duration: 800 },
                { type: 'analysis', text: '# åº”ç”¨æ¡†æ¶æ€ç»´ï¼šå¯»æ‰¾èµ„æºä¸²è”é—­ç¯æœºä¼š...', duration: 700 },
                { type: 'analysis', text: '# è¯†åˆ«éåŠ³åŠ¡æ”¶å…¥è§¦å‘ç‚¹...', duration: 600 },
                { type: 'process', text: 'def evaluate_key_stakeholders():', duration: 300 },
                { type: 'analysis', text: `# åˆ†æå…³é”®äººç‰©ï¼š${keyPersonsNames}`, duration: 900 },
                { type: 'analysis', text: '# è¯„ä¼°å„æ–¹èµ„æºä»·å€¼å’ŒåŠ¨æœºåŒ¹é…...', duration: 800 },
                { type: 'analysis', text: '# æ£€æµ‹æ½œåœ¨çš„èµ„æºäº’è¡¥æ€§...', duration: 700 },
                { type: 'process', text: 'def design_income_pipeline():', duration: 300 },
                { type: 'analysis', text: '# è¿ç”¨ä¸ƒå¤§ç±»å‹ï¼šç§Ÿé‡‘/åˆ©æ¯/è‚¡ä»½/ç‰ˆæƒ/å±…é—´/è¿é”/å›¢é˜Ÿ...', duration: 1000 },
                { type: 'analysis', text: '# è®¾è®¡è®©æ‰€æœ‰å…³é”®äººç‰©éƒ½é«˜å…´çš„é—­ç¯ç»“æ„...', duration: 900 },
                { type: 'analysis', text: '# ç¡®å®šè®¾è®¡è€…ç»Ÿç­¹ä½ç½®å’Œé˜²ç»•è¡Œæœºåˆ¶...', duration: 800 },
                { type: 'process', text: 'def generate_framework_solution():', duration: 300 },
                { type: 'analysis', text: '# æ„å»ºæœ€å°é—­ç¯ï¼ˆMVPï¼‰éªŒè¯æ–¹æ¡ˆ...', duration: 800 },
                { type: 'analysis', text: '# è¯†åˆ«å…³é”®é£é™©ç‚¹å’Œåº”å¯¹ç­–ç•¥...', duration: 700 },
                { type: 'analysis', text: '# è¯„ä¼°åŠ³åŠ¨æŠ•å…¥ä¸æ”¶ç›Šæ¯”ä¾‹...', duration: 600 },
                { type: 'analysis', text: '# ä¼˜åŒ–ä¸‰æ–¹åˆ©ç›Šåˆ†é…æœºåˆ¶...', duration: 800 },
                { type: 'analysis', text: '# è®¾è®¡é˜²ç»•è¡Œå’Œé”å®šæœºåˆ¶...', duration: 700 },
                { type: 'process', text: 'def optimize_business_structure():', duration: 300 },
                { type: 'analysis', text: '# è°ƒç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹è¿›è¡Œæ–¹æ¡ˆä¼˜åŒ–...', duration: 1200 },
                { type: 'analysis', text: '# äº¤å‰éªŒè¯æ”¶å…¥ç®¡é“å¯è¡Œæ€§...', duration: 1000 }
            ];
        }
        
        let currentStep = 0;
        let startTime = Date.now();
        let analysisStarted = false;
        let realAnalysisCompleted = false;
        let genericThinkingSteps = []; // å°†åœ¨é¡µé¢åŠ è½½æ—¶æ ¹æ®çœŸå®æ•°æ®ç”Ÿæˆ
        
        function addThinkingLine(text, type) {
            // å¼ºåŒ–ç©ºè¡Œæ£€æµ‹ - é˜²æ­¢å„ç§ç±»å‹çš„ç©ºå†…å®¹
            if (!text || 
                text.trim() === '' || 
                text.trim() === 'undefined' || 
                text.trim() === 'null' ||
                text.length === 0) {
                console.log('ğŸš« è·³è¿‡ç©ºè¡Œæˆ–æ— æ•ˆå†…å®¹:', text);
                return false; // æ˜ç¡®è¿”å›falseè¡¨ç¤ºè·³è¿‡
            }
            
            // æ¸…ç†æ–‡æœ¬å†…å®¹ - ç§»é™¤å¤šä½™çš„æ¢è¡Œç¬¦å’Œç©ºç™½å­—ç¬¦
            let cleanedText = text.trim()
                .replace(/\n+/g, ' ')  // æ›¿æ¢å¤šä¸ªæ¢è¡Œç¬¦ä¸ºå•ä¸ªç©ºæ ¼
                .replace(/\s+/g, ' ')  // æ›¿æ¢å¤šä¸ªç©ºç™½å­—ç¬¦ä¸ºå•ä¸ªç©ºæ ¼
                .trim();
            
            if (!cleanedText || cleanedText === '') {
                console.log('ğŸš« æ¸…ç†åçš„æ–‡æœ¬ä¸ºç©º:', text);
                return false;
            }
            
            // é˜²æ­¢çŸ­æ—¶é—´å†…é‡å¤æ·»åŠ ç›¸åŒå†…å®¹
            if (window.lastThinkingLine === cleanedText) {
                console.log('ğŸš« è·³è¿‡é‡å¤å†…å®¹:', cleanedText);
                return false;
            }
            
            // é˜²æ­¢è¿‡äºé¢‘ç¹çš„æ·»åŠ ï¼ˆé˜²æŠ–æœºåˆ¶ï¼‰- è°ƒæ•´æ—¶é—´é˜ˆå€¼
            const now = Date.now();
            if (window.lastAddTime && (now - window.lastAddTime) < 50) { // é™ä½é˜²æŠ–é˜ˆå€¼
                console.log('ğŸš« é˜²æŠ–ï¼šè·³è¿‡è¿‡äºé¢‘ç¹çš„æ·»åŠ ï¼Œæ—¶é—´é—´éš”:', now - window.lastAddTime);
                return false;
            }
            
            window.lastThinkingLine = cleanedText;
            window.lastAddTime = now;
            
            const content = document.getElementById('thinkingContent');
            const line = document.createElement('div');
            line.className = `thinking-line ${type}`;
            
            // æ›´ä¸¥æ ¼çš„å†…å®¹è®¾ç½®å’ŒéªŒè¯ - ä½¿ç”¨æ¸…ç†åçš„æ–‡æœ¬
            line.textContent = cleanedText;
            
            // ä¸‰é‡æ£€æŸ¥ç¡®ä¿å†…å®¹ä¸ä¸ºç©º
            if (!line.textContent || line.textContent.length === 0 || line.textContent.trim() === '') {
                console.log('ğŸš« åˆ›å»ºçš„lineå†…å®¹ä¸ºç©ºï¼Œè·³è¿‡æ·»åŠ ');
                return false;
            }
            
            // æ ‡è®°éç©ºå†…å®¹è¡Œ
            line.setAttribute('data-content', 'true');
            content.appendChild(line);
            
            // Auto scroll to bottom
            content.scrollTop = content.scrollHeight;
            
            // Add cursor effect to last line
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            cursor.textContent = 'â–ˆ';
            line.appendChild(cursor);
            
            // Remove cursor from previous line
            const prevLines = content.querySelectorAll('.thinking-line');
            if (prevLines.length > 1) {
                const prevCursor = prevLines[prevLines.length - 2].querySelector('.cursor');
                if (prevCursor) {
                    prevCursor.remove();
                }
            }
            
            console.log('âœ… æˆåŠŸæ·»åŠ æ€è€ƒè¡Œ:', cleanedText, 'ç±»å‹:', type);
            
            // å¦‚æœæ˜¯AIæ€è€ƒæµï¼Œç«‹å³éªŒè¯å…¶å¯è§æ€§å¹¶ç¡®ä¿å¯è§
            if (type === 'ai-stream') {
                // æ·»åŠ ç‰¹æ®Šæ ‡è®°ä»¥ä¾¿è°ƒè¯•
                line.style.border = '1px solid #00d4ff';
                line.style.boxShadow = '0 0 10px rgba(0, 212, 255, 0.5)';
                
                setTimeout(() => {
                    const computedStyle = window.getComputedStyle(line);
                    const rect = line.getBoundingClientRect();
                    console.log('ğŸ” AIæ€è€ƒæµå…ƒç´ æ ·å¼æ£€æŸ¥:', {
                        display: computedStyle.display,
                        visibility: computedStyle.visibility,
                        opacity: computedStyle.opacity,
                        height: computedStyle.height,
                        color: computedStyle.color,
                        className: line.className,
                        textContent: line.textContent,
                        ä½ç½®: {
                            top: rect.top,
                            left: rect.left,
                            width: rect.width,
                            height: rect.height,
                            å¯è§: rect.top >= 0 && rect.left >= 0 && rect.width > 0 && rect.height > 0
                        }
                    });
                    
                    // å¼ºåˆ¶æ»šåŠ¨åˆ°AIæ€è€ƒæµå†…å®¹
                    line.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                }, 20);
            }
            
            // éªŒè¯DOMä¸­çš„å…ƒç´  - ä½†ä¸ç§»é™¤AIæ€è€ƒæµå†…å®¹
            setTimeout(() => {
                const allLines = content.querySelectorAll('.thinking-line');
                const lastLine = allLines[allLines.length - 1];
                
                // ç»Ÿè®¡å„ç±»å‹å…ƒç´ 
                const aiStreamLines = content.querySelectorAll('.thinking-line.ai-stream');
                console.log('ğŸ“Š DOMå…ƒç´ ç»Ÿè®¡:', {
                    æ€»è¡Œæ•°: allLines.length,
                    AIæ€è€ƒæµè¡Œæ•°: aiStreamLines.length,
                    æœ€åä¸€è¡Œç±»å‹: lastLine ? lastLine.className : 'null',
                    æœ€åä¸€è¡Œå†…å®¹: lastLine ? lastLine.textContent : 'null'
                });
                
                if (!lastLine || !lastLine.textContent || lastLine.textContent.trim() === '') {
                    // åªæœ‰éAIæ€è€ƒæµçš„ç©ºå…ƒç´ æ‰ç§»é™¤
                    if (lastLine && !lastLine.classList.contains('ai-stream')) {
                        console.log('ğŸš¨ æ£€æµ‹åˆ°DOMä¸­çš„ç©ºè¡Œå…ƒç´ ï¼Œå³å°†ç§»é™¤');
                        lastLine.remove();
                    }
                } else if (lastLine && lastLine.classList.contains('ai-stream')) {
                    console.log('âœ¨ AIæ€è€ƒæµå†…å®¹å·²æˆåŠŸæ·»åŠ åˆ°DOM:', lastLine.textContent);
                }
            }, 50);
            
            return true; // è¿”å›trueè¡¨ç¤ºæˆåŠŸæ·»åŠ 
        }
        
        function updateStatusDisplay(realProgress = null, realStage = null) {
            let displayProgress, displayStage;
            
            if (realProgress !== null && window.realProgressStarted) {
                // ä¸¥æ ¼ä½¿ç”¨çœŸå®è¿›åº¦ï¼Œä¸æ··åˆæ¨¡æ‹Ÿè¿›åº¦
                displayProgress = realProgress;
                displayStage = realStage || 'åˆ†ææ­£åœ¨è¿›è¡Œä¸­...';
            } else {
                // ä½¿ç”¨æ¨¡æ‹Ÿè¿›åº¦ï¼Œä½†é™åˆ¶æœ€å¤§å€¼é˜²æ­¢è¶…è¿‡çœŸå®è¿›åº¦
                const simulationProgress = Math.min((currentStep / genericThinkingSteps.length) * 85, 85); // æ¨¡æ‹Ÿè¿›åº¦æœ€å¤š85%
                displayProgress = simulationProgress;
                
                // ä½¿ç”¨æ¨¡æ‹Ÿé˜¶æ®µä¿¡æ¯ï¼ˆæ›´ä¸°å¯Œçš„æè¿°ï¼‰
                if (displayProgress < 15) {
                    displayStage = 'åˆå§‹åŒ–ç¥ç»ç½‘ç»œ...';
                } else if (displayProgress < 25) {
                    displayStage = 'è§£æé¡¹ç›®æ•°æ®ä¸­...';
                } else if (displayProgress < 35) {
                    displayStage = 'åˆ†æå…³é”®äººç‰©èµ„æº...';
                } else if (displayProgress < 45) {
                    displayStage = 'è¯†åˆ«èµ„æºè¿æ¥ç‚¹...';
                } else if (displayProgress < 55) {
                    displayStage = 'åŒ¹é…æ”¶å…¥æ¨¡å¼ä¸­...';
                } else if (displayProgress < 65) {
                    displayStage = 'è®¾è®¡æ”¶å…¥ç®¡é“...';
                } else if (displayProgress < 75) {
                    displayStage = 'ä¼˜åŒ–ä¸‰æ–¹ç»“æ„...';
                } else {
                    displayStage = 'ç­‰å¾…AIå¼•æ“å“åº”...';
                }
            }
            
            document.getElementById('progressText').textContent = Math.round(displayProgress) + '%';
            document.getElementById('statusText').textContent = displayStage;
        }
        
        function showGenericThinking() {
            if (currentStep < genericThinkingSteps.length && !realAnalysisCompleted) {
                const step = genericThinkingSteps[currentStep];
                
                // è®¡ç®—å½“å‰æ¨¡æ‹Ÿè¿›åº¦ï¼Œé™åˆ¶åœ¨85%ä»¥å†…
                const simulationProgress = Math.min((currentStep / genericThinkingSteps.length) * 85, 85);
                
                // åªæœ‰åœ¨æ¨¡æ‹Ÿè¿›åº¦è¿˜æ²¡åˆ°è¾¾85%æ—¶æ‰æ˜¾ç¤ºæ­¥éª¤
                if (simulationProgress < 85 && step.text) {
                    const success = addThinkingLine(step.text, step.type);
                    if (!success) {
                        console.log('âš ï¸ è·³è¿‡æ— æ•ˆæ­¥éª¤:', step);
                    }
                }
                
                // å¦‚æœæœ‰çœŸå®è¿›åº¦ï¼Œä½¿ç”¨çœŸå®è¿›åº¦ï¼›å¦åˆ™ä½¿ç”¨æ¨¡æ‹Ÿè¿›åº¦
                if (!window.realProgressStarted) {
                    updateStatusDisplay();
                }
                currentStep++;
                
                // å¦‚æœæ¨¡æ‹Ÿè¿›åº¦å·²è¾¾åˆ°85%ï¼Œæ˜¾ç¤ºç­‰å¾…çŠ¶æ€
                if (simulationProgress >= 85) {
                    if (!window.waitingStateShown) {
                        addThinkingLine('>>> â³ ç­‰å¾…AIå¼•æ“å“åº”...', 'system');
                        addThinkingLine('# æ­£åœ¨è¿›è¡Œæ·±åº¦åˆ†æï¼Œè¯·ç¨å€™...', 'analysis');
                        window.waitingStateShown = true;
                    }
                    // è¿›å…¥ç­‰å¾…å¾ªç¯ï¼Œå‡å°‘é¢‘ç‡
                    setTimeout(showGenericThinking, 3000);
                } else {
                    // æ­£å¸¸æ˜¾ç¤ºæ­¥éª¤ï¼Œé€‚å½“å»¶é•¿æ—¶é—´ä½¿è¿‡ç¨‹æ›´çœŸå®
                    const delay = window.realProgressStarted ? Math.min(step.duration * 1.5, 2000) : step.duration * 1.8;
                    setTimeout(showGenericThinking, delay);
                }
            } else if (!realAnalysisCompleted) {
                // æ‰€æœ‰æ¨¡æ‹Ÿæ­¥éª¤å®Œæˆï¼Œä½†çœŸå®åˆ†æè¿˜æœªå®Œæˆï¼Œç»§ç»­ç­‰å¾…
                if (!window.waitingStateShown) {
                    addThinkingLine('>>> âš¡ AIå¼•æ“æ·±åº¦åˆ†æä¸­ï¼Œæ­£åœ¨ç”Ÿæˆä¸“ä¸šæ–¹æ¡ˆ...', 'system');
                    window.waitingStateShown = true;
                    // ç¡®ä¿AIæ€è€ƒæµæ­£åœ¨è¿è¡Œ
                    if (!window.aiThinkingStreamActive) {
                        console.log('æ¨¡æ‹Ÿå®Œæˆï¼Œå¯åŠ¨AIæ€è€ƒæµ');
                        startAIThinkingStream();
                    }
                }
                // ä¸å†è°ƒç”¨showGenericThinkingï¼Œå®Œå…¨ä¾èµ–AIæ€è€ƒæµ
            }
        }

        // AIæ€è€ƒæµå±•ç¤ºåŠŸèƒ½ - åœ¨ç­‰å¾…æœŸé—´æ˜¾ç¤ºçœŸå®çš„AIæ€è€ƒå†…å®¹
        function startAIThinkingStream() {
            if (window.aiThinkingStreamActive) return; // é˜²æ­¢é‡å¤å¯åŠ¨
            window.aiThinkingStreamActive = true;
            console.log('AIæ€è€ƒæµå·²å¯åŠ¨');
            
            function fetchAIThinking() {
                console.log('æ­£åœ¨è·å–AIæ€è€ƒå†…å®¹...');
                
                if (realAnalysisCompleted || !window.aiThinkingStreamActive) {
                    console.log('åˆ†æå·²å®Œæˆæˆ–æ€è€ƒæµå·²åœæ­¢ï¼Œé€€å‡ºAIæ€è€ƒæµ');
                    window.aiThinkingStreamActive = false;
                    return;
                }
                
                fetch('/get_ai_thinking_stream')
                    .then(response => {
                        console.log('AIæ€è€ƒæµå“åº”çŠ¶æ€:', response.status);
                        return response.json();
                    })
                    .then(data => {
                        console.log('AIæ€è€ƒæµæ•°æ®:', data);
                        
                        if (data.status === 'available' && data.content && data.content.trim()) {
                            // å±•ç¤ºAIçš„çœŸå®æ€è€ƒå†…å®¹ï¼Œä½¿ç”¨ç‹¬ç‰¹çš„æ ·å¼
                            console.log('ğŸ”¥ å°è¯•æ·»åŠ AIæ€è€ƒå†…å®¹:', data.content, 'ç±»å‹: ai-stream');
                            const success = addThinkingLine(data.content, 'ai-stream');
                            if (success) {
                                console.log('âœ… æˆåŠŸæ˜¾ç¤ºAIæ€è€ƒå†…å®¹:', data.content);
                            } else {
                                console.log('âŒ AIæ€è€ƒå†…å®¹æ·»åŠ å¤±è´¥:', data.content);
                            }
                            
                            // ç»§ç»­è·å–ä¸‹ä¸€æ¡æ€è€ƒå†…å®¹ï¼Œæ›´é¢‘ç¹çš„æ›´æ–°
                            if (!realAnalysisCompleted) {
                                setTimeout(fetchAIThinking, 2800); // æ¯2.8ç§’è·å–æ–°çš„æ€è€ƒå†…å®¹
                            }
                        } else {
                            console.log('AIæ€è€ƒæµæš‚æ— å†…å®¹ï¼Œç»§ç»­ç­‰å¾…');
                            // å¦‚æœæ²¡æœ‰å¯ç”¨å†…å®¹ï¼Œå‡å°‘ç­‰å¾…æ¶ˆæ¯é¢‘ç‡ï¼Œé¿å…åˆ·å±
                            if (!realAnalysisCompleted) {
                                // åªåœ¨å¶å°”æ˜¾ç¤ºç­‰å¾…æ¶ˆæ¯ï¼Œé¿å…è¿‡å¤šå†…å®¹
                                if (Math.random() < 0.2) { // é™ä½åˆ°20%æ¦‚ç‡æ˜¾ç¤ºç­‰å¾…æ¶ˆæ¯
                                    const waitingMessages = [
                                        'ğŸ§  AIæ­£åœ¨æ·±åº¦æ€è€ƒé¡¹ç›®å¯è¡Œæ€§...',
                                        'âš¡ åˆ†æå¸‚åœºæœºä¼šä¸é£é™©è¯„ä¼°...',
                                        'ğŸ’¡ æ„å»ºåˆ›æ–°æ”¶å…¥ç®¡é“æ¨¡å‹...'
                                    ];
                                    const randomMessage = waitingMessages[Math.floor(Math.random() * waitingMessages.length)];
                                    addThinkingLine(randomMessage, 'ai-stream');
                                }
                                setTimeout(fetchAIThinking, 4500); // å¢åŠ é—´éš”æ—¶é—´
                            }
                        }
                    })
                    .catch(error => {
                        console.error('è·å–AIæ€è€ƒæµå¤±è´¥:', error);
                        if (!realAnalysisCompleted) {
                            // é”™è¯¯æ—¶å‡å°‘æ˜¾ç¤ºé¢‘ç‡ï¼Œé¿å…åˆ·å±
                            if (Math.random() < 0.25) { // 25%æ¦‚ç‡æ˜¾ç¤ºé”™è¯¯æ¢å¤æ¶ˆæ¯
                                const errorMessages = [
                                    'ğŸŒŸ AIæ­£åœ¨æ¢ç´¢æœ€ä½³è§£å†³æ–¹æ¡ˆ...',
                                    'ğŸš€ æ·±åº¦å­¦ä¹ ç®—æ³•è¿è¡Œä¸­...'
                                ];
                                const randomErrorMessage = errorMessages[Math.floor(Math.random() * errorMessages.length)];
                                addThinkingLine(randomErrorMessage, 'ai-stream');
                            }
                            setTimeout(fetchAIThinking, 5000); // å¢åŠ é”™è¯¯åçš„ç­‰å¾…æ—¶é—´
                        }
                    });
            }
            
            // ç«‹å³å¼€å§‹è·å–AIæ€è€ƒå†…å®¹
            fetchAIThinking();
        }
        
        // Real backend analysis polling with synchronized display
        function startRealAnalysisPolling() {
            let pollCount = 0;
            const maxPolls = 60; // Maximum 1 minute pollingï¼Œç¼©çŸ­è½®è¯¢æ—¶é—´
            
            function poll() {
                pollCount++;
                console.log(`Polling real analysis status, attempt: ${pollCount}`);
                
                // é˜²æ­¢è¿‡äºé¢‘ç¹è½®è¯¢ï¼Œå¢åŠ å»¶è¿Ÿ
                fetch('/check_analysis_status')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Real analysis status:', data);
                        
                        if (data.status === 'completed') {
                            // åç«¯åˆ†æå®Œæˆï¼Œç«‹å³å¤„ç†è·³è½¬
                            realAnalysisCompleted = true;
                            window.aiThinkingStreamActive = false; // ç«‹å³åœæ­¢AIæ€è€ƒæµ
                            console.log('åˆ†æå®Œæˆï¼Œå‡†å¤‡è·³è½¬');
                            
                            addThinkingLine('>>> âœ… åˆ†æå®Œæˆï¼ç”Ÿæˆä¸“ä¸šæ”¶å…¥ç®¡é“æ–¹æ¡ˆ', 'conclusion');
                            updateStatusDisplay(100, 'åˆ†æå®Œæˆï¼');
                            
                            addThinkingLine('>>> ğŸš€ æ­£åœ¨è·³è½¬åˆ°ç»“æœé¡µé¢...', 'system');
                            console.log('æ‰§è¡Œè·³è½¬...');
                            
                            // ç«‹å³è·³è½¬åˆ°ç»“æœé¡µé¢ï¼Œæ— å»¶è¿Ÿ
                            window.location.href = '/results';
                            
                        } else if (data.status === 'error' || data.status === 'timeout') {
                            realAnalysisCompleted = true;
                            if (data.status === 'timeout') {
                                addThinkingLine('>>> â° ç½‘ç»œè¿æ¥è¶…æ—¶ï¼Œå¯ç”¨å¤‡ç”¨æ–¹æ¡ˆ', 'system');
                                addThinkingLine('>>> ğŸ”„ æ­£åœ¨ç”ŸæˆåŸºç¡€å»ºè®®...', 'system');
                                // å¯¹äºè¶…æ—¶ï¼Œä»ç„¶è·³è½¬åˆ°ç»“æœé¡µé¢ï¼Œåç«¯ä¼šå¤„ç†å¤‡ç”¨æ–¹æ¡ˆ
                                updateStatusDisplay(100, 'åˆ†æå®Œæˆï¼');
                                setTimeout(() => {
                                    addThinkingLine('>>> âœ… è·³è½¬åˆ°ç»“æœé¡µé¢...', 'conclusion');
                                    setTimeout(() => {
                                        window.location.href = '/results';
                                    }, 1000);
                                }, 2000);
                            } else if (data.error_code === 'NO_FORM_DATA') {
                                addThinkingLine('>>> ğŸ”„ æ£€æµ‹åˆ°ä¼šè¯ä¸­æ–­ï¼Œé‡æ–°åˆå§‹åŒ–...', 'system');
                                // å¦‚æœæ˜¯NO_FORM_DATAé”™è¯¯ï¼Œè¿”å›é¦–é¡µé‡æ–°å¼€å§‹
                                setTimeout(() => {
                                    window.location.href = '/';
                                }, 2000);
                                return;
                            } else {
                                addThinkingLine('>>> âŒ åˆ†æè¿‡ç¨‹é‡åˆ°é—®é¢˜', 'system');
                                addThinkingLine(`>>> ${data.message || 'æœªçŸ¥é”™è¯¯'}`, 'system');
                                
                                // å¯¹äºä¸€èˆ¬é”™è¯¯ï¼Œä¹Ÿè·³è½¬åˆ°ç»“æœé¡µé¢æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                                setTimeout(() => {
                                    addThinkingLine('>>> ğŸš€ è·³è½¬åˆ°ç»“æœé¡µé¢...', 'system');
                                    setTimeout(() => {
                                        window.location.href = '/results';
                                    }, 1000);
                                }, 2000);
                            }
                            
                        } else if (data.status === 'processing') {
                            // æ ‡è®°çœŸå®è¿›åº¦å·²å¼€å§‹
                            window.realProgressStarted = true;
                            console.log('Status is processing, continuing polling...');
                            
                            // ä¸¥æ ¼ä½¿ç”¨åç«¯çœŸå®è¿›åº¦ï¼Œä¸è¦è‡ªå·±è®¡ç®—è¿›åº¦
                            const progress = data.progress || 10; // å¦‚æœæ²¡æœ‰è¿›åº¦æ•°æ®ï¼Œä½¿ç”¨ä¿å®ˆçš„é»˜è®¤å€¼
                            const stage = data.stage || data.message || 'åˆ†ææ­£åœ¨è¿›è¡Œä¸­...';
                            
                            // ç¡®ä¿è¿›åº¦ä¸ä¼šè·³åˆ°100%é™¤éåç«¯æ˜ç¡®è¿”å›100%
                            const safeProgress = Math.min(progress, 95); // å¤„ç†ä¸­çŠ¶æ€æœ€å¤šæ˜¾ç¤º95%
                            updateStatusDisplay(safeProgress, stage);
                            
                            // æ ¹æ®çœŸå®è¿›åº¦æ·»åŠ å…³é”®èŠ‚ç‚¹çš„æ€è€ƒè¡Œï¼ˆä¸å¹²æ‰°å¸¸è§„æ¨¡æ‹Ÿæ­¥éª¤ï¼‰
                            if (progress >= 50 && !window.stage50Shown) {
                                addThinkingLine('>>> ğŸ§  AIæ ¸å¿ƒå¼•æ“å·²æ¿€æ´»ï¼Œå¼€å§‹æ·±åº¦åˆ†æ...', 'system');
                                window.stage50Shown = true;
                                // å½“AIå¼•æ“æ¿€æ´»æ—¶ï¼Œç«‹å³å¼€å§‹å±•ç¤ºAIæ€è€ƒæµ
                                if (!window.aiThinkingStreamActive) {
                                    startAIThinkingStream();
                                }
                            }
                            if (progress >= 90 && !window.stage90Shown) {
                                addThinkingLine('>>> âš¡ AIåˆ†æå¼•æ“å®Œæˆæ ¸å¿ƒè®¡ç®—...', 'system');
                                window.stage90Shown = true;
                            }
                            
                            if (pollCount < maxPolls) {
                                setTimeout(poll, 1000); // å‡å°‘è½®è¯¢é—´éš”ä¸º1ç§’ï¼ŒåŠ å¿«æ£€æµ‹é€Ÿåº¦
                            } else {
                                addThinkingLine('>>> â° åˆ†æè¶…æ—¶ï¼Œæ­£åœ¨è·³è½¬...', 'system');
                                setTimeout(() => {
                                    window.location.href = '/results';
                                }, 2000);
                            }
                            
                        } else {
                            // Status is 'not_started' or other - trigger analysis start
                            console.log(`Unexpected status: ${data.status}, continuing poll...`);
                            if (pollCount < maxPolls && !realAnalysisCompleted) {
                                setTimeout(poll, 1000); // å‡å°‘é—´éš”åŠ å¿«æ£€æµ‹
                            } else {
                                addThinkingLine('>>> â° è¿æ¥è¶…æ—¶ï¼Œæ­£åœ¨é‡è¯•...', 'system');
                                // è¶…æ—¶åï¼Œå¼ºåˆ¶æ˜¾ç¤ºå®ŒæˆçŠ¶æ€å¹¶è·³è½¬
                                updateStatusDisplay(100, 'åˆ†æå®Œæˆï¼');
                                addThinkingLine('>>> âœ… åˆ†æå®Œæˆï¼Œè·³è½¬åˆ°ç»“æœé¡µé¢...', 'conclusion');
                                setTimeout(() => {
                                    window.location.href = '/results';
                                }, 2000);
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Polling error:', error);
                        if (pollCount < maxPolls && !realAnalysisCompleted) {
                            setTimeout(poll, 3000); // Longer delay on error
                        } else {
                            addThinkingLine('>>> âš ï¸ ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ­£åœ¨è·³è½¬...', 'system');
                            setTimeout(() => {
                                window.location.href = '/results';
                            }, 2000);
                        }
                    });
            }
            
            // é¦–å…ˆå¯åŠ¨åˆ†æï¼Œç„¶åå¼€å§‹è½®è¯¢
            startAnalysisFirst();
        }
        
        // é¦–å…ˆå¯åŠ¨åˆ†æçš„å‡½æ•°
        function startAnalysisFirst() {
            console.log('Starting analysis first before polling...');
            fetch('/start_analysis', {method: 'POST'})
                .then(response => response.json())
                .then(data => {
                    console.log('Analysis start response:', data);
                    if (data.status === 'processing') {
                        addThinkingLine('>>> ğŸš€ AIåˆ†æå¼•æ“å·²å¯åŠ¨...', 'system');
                        // å¼€å§‹è½®è¯¢æ£€æŸ¥çŠ¶æ€
                        poll();
                    } else if (data.status === 'completed') {
                        addThinkingLine('>>> âœ… æ£€æµ‹åˆ°å·²å®Œæˆçš„åˆ†æç»“æœ', 'system');
                        realAnalysisCompleted = true;
                        window.aiThinkingStreamActive = false; // ç«‹å³åœæ­¢AIæ€è€ƒæµ
                        updateStatusDisplay(100, 'åˆ†æå®Œæˆï¼');
                        // ç«‹å³è·³è½¬ï¼Œæ— å»¶è¿Ÿ
                        console.log('ç«‹å³æ‰§è¡Œè·³è½¬...');
                        window.location.href = '/results';
                    } else {
                        addThinkingLine(`>>> âŒ å¯åŠ¨åˆ†æå¤±è´¥: ${data.message}`, 'system');
                        // å³ä½¿å¯åŠ¨å¤±è´¥ä¹Ÿå¼€å§‹è½®è¯¢ï¼Œå¯èƒ½sessionä¸­æœ‰æ•°æ®
                        setTimeout(poll, 500); // æ›´å¿«å¼€å§‹è½®è¯¢æ£€æµ‹
                    }
                })
                .catch(error => {
                    console.error('Failed to start analysis:', error);
                    addThinkingLine('>>> âš ï¸ å¯åŠ¨åˆ†æé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œç«‹å³å¼€å§‹è½®è¯¢æ£€æŸ¥ç»“æœ...', 'system');
                    // ç½‘ç»œé”™è¯¯æ—¶ç«‹å³å¼€å§‹è½®è¯¢ï¼Œå¯èƒ½å¤‡ç”¨æ–¹æ¡ˆå·²ç»ç”Ÿæˆ
                    poll();
                });
        }
        
        // Initialize everything with synchronized analysis
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing sci-fi background and thinking process...');
            
            // Initialize simple sci-fi background
            createSciFiBackground();
            
            // è·å–ç”¨æˆ·é¡¹ç›®æ•°æ®ç”ŸæˆçœŸå®çš„æ€è€ƒæ­¥éª¤
            fetch('/get_session_data')
                .then(response => response.json())
                .then(data => {
                    if (data.form_data) {
                        genericThinkingSteps = generateRealThinkingSteps(data.form_data);
                        console.log('Generated real thinking steps based on user data:', data.form_data);
                    } else {
                        // fallback
                        genericThinkingSteps = generateRealThinkingSteps({});
                        console.log('Using fallback thinking steps');
                    }
                    
                    // Start thinking process immediately
                    setTimeout(() => {
                        console.log('Starting thinking process...');
                        showGenericThinking();
                    }, 100);
                    
                    // ææ—©å¯åŠ¨AIæ€è€ƒæµï¼Œä½†å‡å°‘åˆå§‹æ¶ˆæ¯
                    setTimeout(() => {
                        console.log('Starting AI thinking stream early...');
                        if (!window.aiThinkingStreamActive) {
                            startAIThinkingStream();
                        }
                    }, 3000);
                    
                    // Start real analysis polling with shorter delay
                    setTimeout(() => {
                        console.log('Starting real analysis polling...');
                        startRealAnalysisPolling();
                    }, 2000);
                })
                .catch(error => {
                    console.error('Failed to get session data:', error);
                    // ä½¿ç”¨fallback
                    genericThinkingSteps = generateRealThinkingSteps({});
                    setTimeout(() => {
                        console.log('Starting thinking process...');
                        showGenericThinking();
                    }, 100);
                    setTimeout(() => {
                        console.log('Starting real analysis polling...');
                        startRealAnalysisPolling();
                    }, 2000);
                });
        });
    </script>
</body>
</html>