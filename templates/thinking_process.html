<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angela AIÊ≠£Âú®ÊÄùËÄÉ‰∏≠... - Matrix Analysis</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #00ff41;
            font-family: 'Fira Code', 'Courier New', monospace;
            overflow-x: hidden;
            overflow-y: auto;
            min-height: 100vh;
        }
        
        /* Sci-Fi Background Effect */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at center, rgba(0, 255, 65, 0.08) 0%, transparent 50%),
                linear-gradient(45deg, #000000 25%, #001100 25%, #001100 50%, #000000 50%, #000000 75%, #001100 75%),
                linear-gradient(180deg, #000000 0%, #002200 50%, #000500 100%);
            background-size: 300px 300px, 60px 60px, 100% 100%;
            animation: bg-shift 25s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        .matrix-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(0, 255, 65, 0.02) 50%, transparent 100%);
            animation: scan-sweep 12s linear infinite;
        }
        

        
        @keyframes bg-shift {
            0%, 100% {
                background-position: 0px 0px, 0px 0px, 0% 0%;
            }
            50% {
                background-position: 60px 60px, 30px 30px, 0% 0%;
            }
        }
        
        @keyframes scan-sweep {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Main Container */
        .thinking-container {
            position: relative;
            z-index: 100 !important;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: transparent;
            pointer-events: auto;
            padding-top: 40px;
        }
        
        /* Header */
        .ai-header {
            text-align: center;
            margin-bottom: 15px;
            animation: glow-pulse 2s ease-in-out infinite alternate;
            z-index: 200 !important;
            position: relative;
        }
        
        .ai-title {
            font-size: 2.8rem;
            font-weight: 500;
            text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        .ai-subtitle {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .brain-icon {
            font-size: 3rem;
            animation: brain-pulse 1.5s ease-in-out infinite;
            text-shadow: 0 0 30px #00ff41;
            margin-bottom: 8px;
        }
        
        /* Thinking Process Display */
        .thinking-display {
            width: 90%;
            max-width: 900px;
            height: 60vh;
            min-height: 400px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.3);
            backdrop-filter: blur(2px);
            z-index: 15;
            margin-bottom: 40px;
        }
        
        .thinking-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 65, 0.1), transparent);
            animation: scan-line 3s linear infinite;
        }
        
        @keyframes scan-line {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Terminal Header */
        .terminal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #00ff41;
        }
        
        .terminal-buttons {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }
        
        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff5f56;
        }
        
        .terminal-button:nth-child(2) {
            background: #ffbd2e;
        }
        
        .terminal-button:nth-child(3) {
            background: #27ca3f;
        }
        
        .terminal-title {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* Thinking Content */
        .thinking-content {
            height: calc(60vh - 120px);
            min-height: 320px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.4;
            position: relative;
            z-index: 5;
        }
        
        .thinking-line {
            margin-bottom: 8px;
            opacity: 0;
            animation: type-in 0.5s ease-out forwards;
        }
        
        .thinking-line.system {
            color: #00ff41;
        }
        
        .thinking-line.process {
            color: #40ff40;
            margin-left: 20px;
        }
        
        .thinking-line.analysis {
            color: #80ff80;
            margin-left: 40px;
        }
        
        .thinking-line.conclusion {
            color: #00ff41;
            font-weight: 500;
            margin-left: 20px;
        }
        
        .cursor {
            animation: blink 1s infinite;
        }
        
        @keyframes type-in {
            0% {
                opacity: 0;
                transform: translateX(-10px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes blink {
            0%, 50% {
                opacity: 1;
            }
            51%, 100% {
                opacity: 0;
            }
        }
        
        @keyframes glow-pulse {
            0% {
                text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41;
            }
            100% {
                text-shadow: 0 0 30px #00ff41, 0 0 60px #00ff41, 0 0 80px #00ff41;
            }
        }
        
        @keyframes brain-pulse {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.1);
                filter: brightness(1.3);
            }
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 8px 16px;
            border: 1px solid #00ff41;
            border-radius: 25px;
            z-index: 100;
            margin-bottom: 15px;
            max-width: 400px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff41;
            animation: pulse-dot 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% {
                opacity: 0.5;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .matrix-column {
                font-size: 8px;
                line-height: 1.0;
            }
            
            .ai-title {
                font-size: 1.8rem;
            }
            
            .ai-subtitle {
                font-size: 0.9rem;
            }
            
            .brain-icon {
                font-size: 2.5rem;
                margin-bottom: 6px;
            }
            
            .ai-header {
                margin-bottom: 10px;
            }
            
            .thinking-display {
                width: 95%;
                height: 350px;
                padding: 12px;
            }
            
            .thinking-content {
                height: 270px;
                font-size: 11px;
                line-height: 1.3;
            }
            
            .terminal-header {
                margin-bottom: 15px;
            }
            
            .terminal-title {
                font-size: 12px;
            }
            
            .status-bar {
                bottom: 10px;
                padding: 8px 16px;
            }
        }
        
        @media (max-width: 480px) {
            .matrix-column {
                font-size: 6px;
                line-height: 0.9;
            }
            
            .thinking-container {
                padding: 10px;
            }
            
            .ai-title {
                font-size: 1.3rem;
            }
            
            .ai-subtitle {
                font-size: 0.75rem;
            }
            
            .brain-icon {
                font-size: 2rem;
                margin-bottom: 4px;
            }
            
            .ai-header {
                margin-bottom: 8px;
            }
            
            .thinking-display {
                height: 300px;
                padding: 10px;
            }
            
            .thinking-content {
                height: 220px;
                font-size: 10px;
            }
            
            .terminal-title {
                font-size: 10px;
            }
            
            .status-bar {
                padding: 6px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Layer -->
    <div class="matrix-bg" id="matrixBg"></div>
    
    <!-- Content Layer -->
    <div class="thinking-container">
        <!-- Header -->
        <div class="ai-header">
            <div class="brain-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h1 class="ai-title">ANGELA AI</h1>
            <p class="ai-subtitle">Neural Network Analysis In Progress...</p>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">ÂàùÂßãÂåñÁ•ûÁªèÁΩëÁªú...</span>
            </div>
            <div class="status-indicator">
                <span id="progressText">0%</span>
            </div>
        </div>
        
        <!-- Main Thinking Display -->
        <div class="thinking-display">
            <div class="terminal-header">
                <div class="terminal-buttons">
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                </div>
                <div class="terminal-title">angela_ai_core.py - Neural Analysis Terminal</div>
            </div>
            
            <div class="thinking-content" id="thinkingContent">
                <!-- Thinking process will be inserted here dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Simple Sci-Fi Background Effect  
        function createSciFiBackground() {
            const matrixBg = document.getElementById('matrixBg');
            if (!matrixBg) {
                console.error('Background element not found!');
                return;
            }
            
            console.log('Sci-fi background initialized');
        }
            

        
        // Real AI Analysis Process - ÁúüÊ≠£ÁöÑAIÂàÜÊûêËøáÁ®ã
        function generateRealThinkingSteps(projectData) {
            const projectName = projectData?.projectName || 'ÊÇ®ÁöÑÈ°πÁõÆ';
            const keyPersons = projectData?.keyPersons || [];
            const keyPersonsNames = keyPersons.map(p => p.name).join('„ÄÅ') || 'ÂÖ≥ÈîÆÂèÇ‰∏éËÄÖ';
            
            return [
                { type: 'system', text: '>>> ÂêØÂä® Angela AI ÈùûÂä≥Âä°Êî∂ÂÖ•ÁÆ°ÈÅìÂàÜÊûêÂºïÊìé...', duration: 600 },
                { type: 'system', text: '>>> Âä†ËΩΩÊ†∏ÂøÉÂéüÁêÜÔºöÊÑèËØÜ+ËÉΩÈáè+ËÉΩÂäõ=ÁªìÊûú [‚úì]', duration: 500 },
                { type: 'system', text: '>>> ÂàùÂßãÂåñ‰∏ÉÂ§ßÊî∂ÂÖ•Á±ªÂûãÊ°ÜÊû∂ [‚úì]', duration: 400 },
                { type: 'process', text: 'def analyze_project_structure():', duration: 300 },
                { type: 'analysis', text: `# Ê≠£Âú®ÂàÜÊûêÈ°πÁõÆÔºö"${projectName}"`, duration: 800 },
                { type: 'analysis', text: '# Â∫îÁî®Ê°ÜÊû∂ÊÄùÁª¥ÔºöÂØªÊâæËµÑÊ∫ê‰∏≤ËÅîÈó≠ÁéØÊú∫‰ºö...', duration: 700 },
                { type: 'analysis', text: '# ËØÜÂà´ÈùûÂä≥Âä°Êî∂ÂÖ•Ëß¶ÂèëÁÇπ...', duration: 600 },
                { type: 'process', text: 'def evaluate_key_stakeholders():', duration: 300 },
                { type: 'analysis', text: `# ÂàÜÊûêÂÖ≥ÈîÆ‰∫∫Áâ©Ôºö${keyPersonsNames}`, duration: 900 },
                { type: 'analysis', text: '# ËØÑ‰º∞ÂêÑÊñπËµÑÊ∫ê‰ª∑ÂÄºÂíåÂä®Êú∫ÂåπÈÖç...', duration: 800 },
                { type: 'analysis', text: '# Ê£ÄÊµãÊΩúÂú®ÁöÑËµÑÊ∫ê‰∫íË°•ÊÄß...', duration: 700 },
                { type: 'process', text: 'def design_income_pipeline():', duration: 300 },
                { type: 'analysis', text: '# ËøêÁî®‰∏ÉÂ§ßÁ±ªÂûãÔºöÁßüÈáë/Âà©ÊÅØ/ËÇ°‰ªΩ/ÁâàÊùÉ/Â±ÖÈó¥/ËøûÈîÅ/Âõ¢Èòü...', duration: 1000 },
                { type: 'analysis', text: '# ËÆæËÆ°ËÆ©ÊâÄÊúâÂÖ≥ÈîÆ‰∫∫Áâ©ÈÉΩÈ´òÂÖ¥ÁöÑÈó≠ÁéØÁªìÊûÑ...', duration: 900 },
                { type: 'analysis', text: '# Á°ÆÂÆöËÆæËÆ°ËÄÖÁªüÁ≠π‰ΩçÁΩÆÂíåÈò≤ÁªïË°åÊú∫Âà∂...', duration: 800 },
                { type: 'process', text: 'def generate_framework_solution():', duration: 300 },
                { type: 'analysis', text: '# ÊûÑÂª∫ÊúÄÂ∞èÈó≠ÁéØÔºàMVPÔºâÈ™åËØÅÊñπÊ°à...', duration: 800 },
                { type: 'analysis', text: '# ËØÜÂà´ÂÖ≥ÈîÆÈ£éÈô©ÁÇπÂíåÂ∫îÂØπÁ≠ñÁï•...', duration: 700 },
                { type: 'analysis', text: '# ËØÑ‰º∞Âä≥Âä®ÊäïÂÖ•‰∏éÊî∂ÁõäÊØî‰æã...', duration: 600 },
                { type: 'analysis', text: '# ‰ºòÂåñ‰∏âÊñπÂà©ÁõäÂàÜÈÖçÊú∫Âà∂...', duration: 800 },
                { type: 'analysis', text: '# ËÆæËÆ°Èò≤ÁªïË°åÂíåÈîÅÂÆöÊú∫Âà∂...', duration: 700 },
                { type: 'process', text: 'def optimize_business_structure():', duration: 300 },
                { type: 'analysis', text: '# Ë∞ÉÁî®Ê∑±Â∫¶Â≠¶‰π†Ê®°ÂûãËøõË°åÊñπÊ°à‰ºòÂåñ...', duration: 1200 },
                { type: 'analysis', text: '# ‰∫§ÂèâÈ™åËØÅÊî∂ÂÖ•ÁÆ°ÈÅìÂèØË°åÊÄß...', duration: 1000 }
            ];
        }
        
        let currentStep = 0;
        let startTime = Date.now();
        let analysisStarted = false;
        let realAnalysisCompleted = false;
        let genericThinkingSteps = []; // Â∞ÜÂú®È°µÈù¢Âä†ËΩΩÊó∂Ê†πÊçÆÁúüÂÆûÊï∞ÊçÆÁîüÊàê
        
        function addThinkingLine(text, type) {
            const content = document.getElementById('thinkingContent');
            const line = document.createElement('div');
            line.className = `thinking-line ${type}`;
            line.textContent = text;
            content.appendChild(line);
            
            // Auto scroll to bottom
            content.scrollTop = content.scrollHeight;
            
            // Add cursor effect to last line
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            cursor.textContent = '‚ñà';
            line.appendChild(cursor);
            
            // Remove cursor from previous line
            const prevLines = content.querySelectorAll('.thinking-line');
            if (prevLines.length > 1) {
                const prevCursor = prevLines[prevLines.length - 2].querySelector('.cursor');
                if (prevCursor) {
                    prevCursor.remove();
                }
            }
        }
        
        function updateStatusDisplay(realProgress = null, realStage = null) {
            let displayProgress, displayStage;
            
            if (realProgress !== null && window.realProgressStarted) {
                // ‰∏•Ê†º‰ΩøÁî®ÁúüÂÆûËøõÂ∫¶Ôºå‰∏çÊ∑∑ÂêàÊ®°ÊãüËøõÂ∫¶
                displayProgress = realProgress;
                displayStage = realStage || 'ÂàÜÊûêÊ≠£Âú®ËøõË°å‰∏≠...';
            } else {
                // ‰ΩøÁî®Ê®°ÊãüËøõÂ∫¶Ôºå‰ΩÜÈôêÂà∂ÊúÄÂ§ßÂÄºÈò≤Ê≠¢Ë∂ÖËøáÁúüÂÆûËøõÂ∫¶
                const simulationProgress = Math.min((currentStep / genericThinkingSteps.length) * 85, 85); // Ê®°ÊãüËøõÂ∫¶ÊúÄÂ§ö85%
                displayProgress = simulationProgress;
                
                // ‰ΩøÁî®Ê®°ÊãüÈò∂ÊÆµ‰ø°ÊÅØÔºàÊõ¥‰∏∞ÂØåÁöÑÊèèËø∞Ôºâ
                if (displayProgress < 15) {
                    displayStage = 'ÂàùÂßãÂåñÁ•ûÁªèÁΩëÁªú...';
                } else if (displayProgress < 25) {
                    displayStage = 'Ëß£ÊûêÈ°πÁõÆÊï∞ÊçÆ‰∏≠...';
                } else if (displayProgress < 35) {
                    displayStage = 'ÂàÜÊûêÂÖ≥ÈîÆ‰∫∫Áâ©ËµÑÊ∫ê...';
                } else if (displayProgress < 45) {
                    displayStage = 'ËØÜÂà´ËµÑÊ∫êËøûÊé•ÁÇπ...';
                } else if (displayProgress < 55) {
                    displayStage = 'ÂåπÈÖçÊî∂ÂÖ•Ê®°Âºè‰∏≠...';
                } else if (displayProgress < 65) {
                    displayStage = 'ËÆæËÆ°Êî∂ÂÖ•ÁÆ°ÈÅì...';
                } else if (displayProgress < 75) {
                    displayStage = '‰ºòÂåñ‰∏âÊñπÁªìÊûÑ...';
                } else {
                    displayStage = 'Á≠âÂæÖAIÂºïÊìéÂìçÂ∫î...';
                }
            }
            
            document.getElementById('progressText').textContent = Math.round(displayProgress) + '%';
            document.getElementById('statusText').textContent = displayStage;
        }
        
        function showGenericThinking() {
            if (currentStep < genericThinkingSteps.length && !realAnalysisCompleted) {
                const step = genericThinkingSteps[currentStep];
                
                // ËÆ°ÁÆóÂΩìÂâçÊ®°ÊãüËøõÂ∫¶ÔºåÈôêÂà∂Âú®85%‰ª•ÂÜÖ
                const simulationProgress = Math.min((currentStep / genericThinkingSteps.length) * 85, 85);
                
                // Âè™ÊúâÂú®Ê®°ÊãüËøõÂ∫¶ËøòÊ≤°Âà∞Ëææ85%Êó∂ÊâçÊòæÁ§∫Ê≠•È™§
                if (simulationProgress < 85) {
                    addThinkingLine(step.text, step.type);
                }
                
                // Â¶ÇÊûúÊúâÁúüÂÆûËøõÂ∫¶Ôºå‰ΩøÁî®ÁúüÂÆûËøõÂ∫¶ÔºõÂê¶Âàô‰ΩøÁî®Ê®°ÊãüËøõÂ∫¶
                if (!window.realProgressStarted) {
                    updateStatusDisplay();
                }
                currentStep++;
                
                // Â¶ÇÊûúÊ®°ÊãüËøõÂ∫¶Â∑≤ËææÂà∞85%ÔºåÊòæÁ§∫Á≠âÂæÖÁä∂ÊÄÅ
                if (simulationProgress >= 85) {
                    if (!window.waitingStateShown) {
                        addThinkingLine('>>> ‚è≥ Á≠âÂæÖAIÂºïÊìéÂìçÂ∫î...', 'system');
                        addThinkingLine('# Ê≠£Âú®ËøõË°åÊ∑±Â∫¶ÂàÜÊûêÔºåËØ∑Á®çÂÄô...', 'analysis');
                        window.waitingStateShown = true;
                    }
                    // ËøõÂÖ•Á≠âÂæÖÂæ™ÁéØÔºåÂáèÂ∞ëÈ¢ëÁéá
                    setTimeout(showGenericThinking, 3000);
                } else {
                    // Ê≠£Â∏∏ÊòæÁ§∫Ê≠•È™§ÔºåÈÄÇÂΩìÂª∂ÈïøÊó∂Èó¥‰ΩøËøáÁ®ãÊõ¥ÁúüÂÆû
                    const delay = window.realProgressStarted ? Math.min(step.duration * 1.5, 2000) : step.duration * 1.8;
                    setTimeout(showGenericThinking, delay);
                }
            } else if (!realAnalysisCompleted) {
                // ÊâÄÊúâÊ®°ÊãüÊ≠•È™§ÂÆåÊàêÔºå‰ΩÜÁúüÂÆûÂàÜÊûêËøòÊú™ÂÆåÊàêÔºåÁªßÁª≠Á≠âÂæÖ
                if (!window.waitingStateShown) {
                    addThinkingLine('>>> ‚è≥ Á≠âÂæÖAIÂºïÊìéÂìçÂ∫î...', 'system');
                    window.waitingStateShown = true;
                }
                // ÂÆöÊúüÊòæÁ§∫Á≠âÂæÖÊèêÁ§∫
                setTimeout(() => {
                    if (!realAnalysisCompleted) {
                        addThinkingLine('# Ê∑±Â∫¶ÂàÜÊûê‰∏≠ÔºåËØ∑Á®çÂÄô...', 'analysis');
                        setTimeout(showGenericThinking, 4000);
                    }
                }, 3000);
            }
        }
        
        // Real backend analysis polling with synchronized display
        function startRealAnalysisPolling() {
            let pollCount = 0;
            const maxPolls = 60; // Maximum 1 minute pollingÔºåÁº©Áü≠ËΩÆËØ¢Êó∂Èó¥
            
            function poll() {
                pollCount++;
                console.log(`Polling real analysis status, attempt: ${pollCount}`);
                
                fetch('/check_analysis_status')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Real analysis status:', data);
                        
                        if (data.status === 'completed' && data.redirect_url) {
                            // ÂêéÁ´ØÂàÜÊûêÂÆåÊàêÔºåÁ´ãÂç≥Â§ÑÁêÜË∑≥ËΩ¨
                            realAnalysisCompleted = true;
                            console.log('ÂàÜÊûêÂÆåÊàêÔºåÂáÜÂ§áË∑≥ËΩ¨Âà∞:', data.redirect_url);
                            
                            addThinkingLine('>>> ‚úÖ ÂàÜÊûêÂÆåÊàêÔºÅÊ£ÄÊµãÂà∞‰∏ì‰∏öÊî∂ÂÖ•ÁÆ°ÈÅìÊñπÊ°à', 'conclusion');
                            updateStatusDisplay(100, 'ÂàÜÊûêÂÆåÊàêÔºÅ');
                            
                            addThinkingLine('>>> üöÄ Ê≠£Âú®Ë∑≥ËΩ¨Âà∞ÁªìÊûúÈ°µÈù¢...', 'system');
                            console.log('ÊâßË°åË∑≥ËΩ¨...');
                            
                            // Á´ãÂç≥Ë∑≥ËΩ¨ÔºåÊó†Âª∂Ëøü
                            window.location.href = data.redirect_url;
                            
                        } else if (data.status === 'error' || data.status === 'timeout') {
                            realAnalysisCompleted = true;
                            if (data.status === 'timeout') {
                                addThinkingLine('>>> ‚è∞ ÁΩëÁªúËøûÊé•Ë∂ÖÊó∂ÔºåÂêØÁî®Â§áÁî®ÊñπÊ°à', 'system');
                                addThinkingLine('>>> üîÑ Ê≠£Âú®ÁîüÊàêÂü∫Á°ÄÂª∫ËÆÆ...', 'system');
                                // ÂØπ‰∫éË∂ÖÊó∂Ôºå‰ªçÁÑ∂Ë∑≥ËΩ¨Âà∞ÁªìÊûúÈ°µÈù¢ÔºåÂêéÁ´Ø‰ºöÂ§ÑÁêÜÂ§áÁî®ÊñπÊ°à
                                updateStatusDisplay(100, 'ÂàÜÊûêÂÆåÊàêÔºÅ');
                                setTimeout(() => {
                                    addThinkingLine('>>> ‚úÖ Ë∑≥ËΩ¨Âà∞ÁªìÊûúÈ°µÈù¢...', 'conclusion');
                                    setTimeout(() => {
                                        window.location.href = '/results';
                                    }, 1000);
                                }, 2000);
                            } else if (data.error_code === 'NO_FORM_DATA') {
                                addThinkingLine('>>> üîÑ Ê£ÄÊµãÂà∞‰ºöËØù‰∏≠Êñ≠ÔºåÈáçÊñ∞ÂàùÂßãÂåñ...', 'system');
                                // Â¶ÇÊûúÊòØNO_FORM_DATAÈîôËØØÔºåËøîÂõûÈ¶ñÈ°µÈáçÊñ∞ÂºÄÂßã
                                setTimeout(() => {
                                    window.location.href = '/';
                                }, 2000);
                                return;
                            } else {
                                addThinkingLine('>>> ‚ùå ÂàÜÊûêËøáÁ®ãÈÅáÂà∞ÈóÆÈ¢ò', 'system');
                                addThinkingLine(`>>> ${data.message || 'Êú™Áü•ÈîôËØØ'}`, 'system');
                                
                                // ÂØπ‰∫é‰∏ÄËà¨ÈîôËØØÔºå‰πüË∑≥ËΩ¨Âà∞ÁªìÊûúÈ°µÈù¢ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
                                setTimeout(() => {
                                    addThinkingLine('>>> üöÄ Ë∑≥ËΩ¨Âà∞ÁªìÊûúÈ°µÈù¢...', 'system');
                                    setTimeout(() => {
                                        window.location.href = '/results';
                                    }, 1000);
                                }, 2000);
                            }
                            
                        } else if (data.status === 'processing') {
                            // Ê†áËÆ∞ÁúüÂÆûËøõÂ∫¶Â∑≤ÂºÄÂßã
                            window.realProgressStarted = true;
                            
                            // ‰∏•Ê†º‰ΩøÁî®ÂêéÁ´ØÁúüÂÆûËøõÂ∫¶Ôºå‰∏çË¶ÅËá™Â∑±ËÆ°ÁÆóËøõÂ∫¶
                            const progress = data.progress || 10; // Â¶ÇÊûúÊ≤°ÊúâËøõÂ∫¶Êï∞ÊçÆÔºå‰ΩøÁî®‰øùÂÆàÁöÑÈªòËÆ§ÂÄº
                            const stage = data.stage || data.message || 'ÂàÜÊûêÊ≠£Âú®ËøõË°å‰∏≠...';
                            
                            // Á°Æ‰øùËøõÂ∫¶‰∏ç‰ºöË∑≥Âà∞100%Èô§ÈùûÂêéÁ´ØÊòéÁ°ÆËøîÂõû100%
                            const safeProgress = Math.min(progress, 95); // Â§ÑÁêÜ‰∏≠Áä∂ÊÄÅÊúÄÂ§öÊòæÁ§∫95%
                            updateStatusDisplay(safeProgress, stage);
                            
                            // Ê†πÊçÆÁúüÂÆûËøõÂ∫¶Ê∑ªÂä†ÂÖ≥ÈîÆËäÇÁÇπÁöÑÊÄùËÄÉË°åÔºà‰∏çÂπ≤Êâ∞Â∏∏ËßÑÊ®°ÊãüÊ≠•È™§Ôºâ
                            if (progress >= 50 && !window.stage50Shown) {
                                addThinkingLine('>>> üß† AIÊ†∏ÂøÉÂºïÊìéÂ∑≤ÊøÄÊ¥ªÔºåÂºÄÂßãÊ∑±Â∫¶ÂàÜÊûê...', 'system');
                                window.stage50Shown = true;
                            }
                            if (progress >= 90 && !window.stage90Shown) {
                                addThinkingLine('>>> ‚ö° AIÂàÜÊûêÂºïÊìéÂÆåÊàêÊ†∏ÂøÉËÆ°ÁÆó...', 'system');
                                window.stage90Shown = true;
                            }
                            
                            if (pollCount < maxPolls) {
                                setTimeout(poll, 500); // Êõ¥È¢ëÁπÅÁöÑËΩÆËØ¢ÔºåÂáèÂ∞ëÂª∂Ëøü
                            } else {
                                addThinkingLine('>>> ‚è∞ ÂàÜÊûêË∂ÖÊó∂ÔºåÊ≠£Âú®Ë∑≥ËΩ¨...', 'system');
                                setTimeout(() => {
                                    window.location.href = '/results';
                                }, 2000);
                            }
                            
                        } else {
                            // Status is 'not_started' or other - trigger analysis start
                            if (pollCount < maxPolls) {
                                setTimeout(poll, 1000);
                            } else {
                                addThinkingLine('>>> ‚è∞ ËøûÊé•Ë∂ÖÊó∂ÔºåÊ≠£Âú®ÈáçËØï...', 'system');
                                // Ë∂ÖÊó∂ÂêéÔºåÂº∫Âà∂ÊòæÁ§∫ÂÆåÊàêÁä∂ÊÄÅÂπ∂Ë∑≥ËΩ¨
                                updateStatusDisplay(100, 'ÂàÜÊûêÂÆåÊàêÔºÅ');
                                addThinkingLine('>>> ‚úÖ ÂàÜÊûêÂÆåÊàêÔºåË∑≥ËΩ¨Âà∞ÁªìÊûúÈ°µÈù¢...', 'conclusion');
                                setTimeout(() => {
                                    window.location.href = '/results';
                                }, 2000);
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Polling error:', error);
                        if (pollCount < maxPolls) {
                            setTimeout(poll, 3000); // Longer delay on error
                        } else {
                            addThinkingLine('>>> ‚ö†Ô∏è ÁΩëÁªúËøûÊé•ÈóÆÈ¢òÔºåÊ≠£Âú®Ë∑≥ËΩ¨...', 'system');
                            setTimeout(() => {
                                window.location.href = '/results';
                            }, 2000);
                        }
                    });
            }
            
            // Start polling immediately
            poll();
        }
        
        // Initialize everything with synchronized analysis
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing sci-fi background and thinking process...');
            
            // Initialize simple sci-fi background
            createSciFiBackground();
            
            // Ëé∑ÂèñÁî®Êà∑È°πÁõÆÊï∞ÊçÆÁîüÊàêÁúüÂÆûÁöÑÊÄùËÄÉÊ≠•È™§
            fetch('/get_session_data')
                .then(response => response.json())
                .then(data => {
                    if (data.form_data) {
                        genericThinkingSteps = generateRealThinkingSteps(data.form_data);
                        console.log('Generated real thinking steps based on user data:', data.form_data);
                    } else {
                        // fallback
                        genericThinkingSteps = generateRealThinkingSteps({});
                        console.log('Using fallback thinking steps');
                    }
                    
                    // Start thinking process immediately
                    setTimeout(() => {
                        console.log('Starting thinking process...');
                        showGenericThinking();
                    }, 100);
                    
                    // Start real analysis polling with shorter delay
                    setTimeout(() => {
                        console.log('Starting real analysis polling...');
                        startRealAnalysisPolling();
                    }, 2000);
                })
                .catch(error => {
                    console.error('Failed to get session data:', error);
                    // ‰ΩøÁî®fallback
                    genericThinkingSteps = generateRealThinkingSteps({});
                    setTimeout(() => {
                        console.log('Starting thinking process...');
                        showGenericThinking();
                    }, 100);
                    setTimeout(() => {
                        console.log('Starting real analysis polling...');
                        startRealAnalysisPolling();
                    }, 2000);
                });
        });
    </script>
</body>
</html>